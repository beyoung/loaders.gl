(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[8723],{99875:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>Jt,contentTitle:()=>Ut,default:()=>Kt,frontMatter:()=>Ht,metadata:()=>Lt,toc:()=>Nt});var r=n(87462),i=n(67294),s=n(3905),o=n(73935),a=n(33545),l=n(24613),c=n.n(l),u=n(30780),d=n(19521),h=n(49835),p=n(8977),m=n(24009),f=n(77045),A=n(24088),g=n(96935),B=n(66883),C=n(13087),b=n(78843),_=n(22092),y=n(11878),E=n(81547),T=n(37258),S=n(84725),M=n(10752),D=n(87391),x=n(33562),v=n(43855),w=n(98759);var R=n(25719),I=n(45697),G=n.n(I),F=n(63990);const O=d.ZP.div.withConfig({displayName:"debug-option-group__OptionGroup",componentId:"sc-1seyc3q-0"})([""," "," line-height:19px;marign-top:15px;border-top:1px solid rgba(255,255,255,0.2);"],F.Il,F.Zx),P={children:G().node,title:G().string};class H extends i.PureComponent{constructor(e){super(e),this.state={}}render(){const{children:e}=this.props;return i.createElement(O,null,e)}}H.propTypes=P,H.defaultProps={};var U=n(59375),L=n(98505),J=n(45536);const N=d.ZP.div.withConfig({displayName:"debug-panel__Container",componentId:"sc-1umir0j-0"})([""," "," position:absolute;display:flex;flex-direction:column;z-index:20;top:",";left:10px;-moz-user-select:none;-khtml-user-select:none;user-select:none;padding:10px 15px 5px 15px;box-sizing:border-box;border-radius:8px;width:278px;height:",";max-height:540px;overflow-y:auto;overflow-x:hidden;@media (max-width:768px){top:auto;bottom:60px;left:0;border-radius:0;}"],F.Il,F.Zx,(e=>e.renderControlPanel?e.hasBuildingExplore?"253px":"200px":"60px"),(e=>e.renderControlPanel?"calc(100% - 200px)":"calc(100% - 60px)")),Z=d.ZP.h6.withConfig({displayName:"debug-panel__Header",componentId:"sc-1umir0j-1"})(["padding:0;margin:0 0 8px 0;font-weight:500;line-height:15px;text-transform:uppercase;font-size:14px;color:rgba(255,255,255,0.6);"]),V=d.ZP.select.withConfig({displayName:"debug-panel__DropDown",componentId:"sc-1umir0j-2"})([""," "," "," width:167px;left:86px;margin:10px 0;@media (max-width:768px){width:100%;}"],F.Il,F.Zx,F.GK),K=d.ZP.label.withConfig({displayName:"debug-panel__Label",componentId:"sc-1umir0j-3"})(["cursor:pointer;color:rgba(255,255,255,0.6);font-weight:bold;"]),j=d.ZP.h3.withConfig({displayName:"debug-panel__Option",componentId:"sc-1umir0j-4"})([""," "," font-weight:500;width:70px;margin:8px 15px 8px 0;"],F.Il,F.Zx),k=d.ZP.div.withConfig({displayName:"debug-panel__DebugTextureContainer",componentId:"sc-1umir0j-5"})(["padding:5px;margin-left:5px;width:30%;&:hover{transition:all 1s;width:85%;}@media (max-width:768px){display:none;}"]),X={padding:"15px 0",position:"relative"},Q={onDebugOptionsChange:G().func,clearWarnings:G().func,debugTextureImage:G().string,debugOptions:G().object,hasBuildingExplorer:G().bool};class W extends i.PureComponent{_onToggleDebugPanel(){const{expand:e}=this.state;this.setState({expand:!e})}_renderBoundingVolumeColor(){const{debugOptions:{boundingVolumeColorMode:e},onDebugOptionsChange:t}=this.props;return i.createElement(L.eM,null,i.createElement(j,null,"Color"),i.createElement(V,{value:e,onChange:e=>t({boundingVolumeColorMode:parseInt(e.target.value,10)})},Object.keys(J.mp).map((e=>i.createElement("option",{key:e,value:J.mp[e]},e)))))}_renderBoundingVolumeTypes(){const{debugOptions:{boundingVolumeType:e},onDebugOptionsChange:t}=this.props;return i.createElement(L.eM,null,i.createElement(j,null,"Type"),i.createElement(V,{value:e,onChange:e=>t({boundingVolumeType:e.target.value})},Object.keys(J.I4).map((e=>{const t=J.I4[e];return i.createElement("option",{key:e,value:t},e)}))))}_renderBoundingVolume(){const{debugOptions:{boundingVolume:e},onDebugOptionsChange:t}=this.props;return i.createElement(H,null,i.createElement(L.eM,{style:X},i.createElement(K,{htmlFor:"boundingVolume"},"Bounding Volumes"),i.createElement(U.Z,{id:"boundingVolume",value:e,checked:e,onChange:()=>t({boundingVolume:!e})})),e?this._renderBoundingVolumeTypes():null,e?this._renderBoundingVolumeColor():null)}_renderDebugTextureImage(){return i.createElement(k,null,i.createElement("img",{src:this.props.debugTextureImage,width:"100%",alt:""}))}_renderTileOptions(){const{debugOptions:{tileColorMode:e,pickable:t,loadTiles:n,showUVDebugTexture:r,wireframe:s},onDebugOptionsChange:o}=this.props;return i.createElement(H,null,i.createElement(L.eM,{style:X},i.createElement(K,null,"Tiles")),i.createElement(L.eM,null,i.createElement("label",{htmlFor:"loadTiles"},i.createElement(L.XZ,{id:"loadTiles",value:n,checked:n,onChange:()=>o({loadTiles:!n})}),i.createElement(L.bH,null,"Load tiles"))),i.createElement(L.eM,null,i.createElement("label",{htmlFor:"pickable"},i.createElement(L.XZ,{id:"pickable",value:t,checked:t,onChange:()=>o({pickable:!t})}),i.createElement(L.bH,null,"Picking"))),i.createElement(L.eM,null,i.createElement("label",{htmlFor:"uvDebugTexture"},i.createElement(L.XZ,{id:"uvDebugTexture",value:r,checked:r,onChange:()=>o({showUVDebugTexture:!r})}),i.createElement(L.bH,null,"Texture UVs"))),r?this._renderDebugTextureImage():null,i.createElement(L.eM,null,i.createElement("label",{htmlFor:"wireframe"},i.createElement(L.XZ,{id:"wireframe",value:s,checked:s,onChange:()=>o({wireframe:!s})}),i.createElement(L.bH,null,"Wireframe"))),i.createElement(L.eM,null,i.createElement(j,null,"Color"),i.createElement(V,{id:"color",value:e,onChange:e=>o({tileColorMode:parseInt(e.target.value,10)})},Object.keys(J.oZ).map((e=>i.createElement("option",{key:e,value:J.oZ[e]},e))))))}_renderMiniMap(){const{debugOptions:{minimapViewport:e},onDebugOptionsChange:t}=this.props;return i.createElement(L.eM,null,i.createElement("label",{htmlFor:"showFrustumCullingMinimapViewport"},i.createElement(L.XZ,{id:"showFrustumCullingMinimapViewport",value:e,checked:e,onChange:()=>t({minimapViewport:!e})}),i.createElement(L.bH,null,"Different viewports")))}_renderFrustumCullingOption(){const{debugOptions:{minimap:e},onDebugOptionsChange:t}=this.props;return i.createElement(H,null,i.createElement(L.eM,{style:X},i.createElement(K,{htmlFor:"showFrustumCullingMinimap"},"Minimap"),i.createElement(U.Z,{id:"showFrustumCullingMinimap",value:e,checked:e,onChange:()=>t({minimap:!e})})),e?this._renderMiniMap():null)}render(){const{renderControlPanel:e,hasBuildingExplorer:t}=this.props;return i.createElement(N,{className:"debug-panel",renderControlPanel:e,hasBuildingExplore:t},i.createElement(Z,null,"Debug Panel"),this._renderFrustumCullingOption(),this._renderTileOptions(),this._renderBoundingVolume())}}W.propTypes=Q,W.defaultProps={clearWarnings:()=>{},onDebugOptionsChange:()=>{},hasBuildingExplorer:!1};var Y=n(81461);const z=d.ZP.div.withConfig({displayName:"map-info__FrameWrap",componentId:"sc-1gr9cah-0"})(["position:absolute;right:1%;height:calc(75% - 85px);max-height:500px;bottom:22%;z-index:3;-moz-user-select:none;-khtml-user-select:none;user-select:none;background:white;border:8px solid black;border-radius:8px;overflow-y:auto;overflow-x:hidden;iframe{overflow-x:hidden;height:90% !important;width:310px;}@media (max-width:768px){right:0;}"]),q=d.ZP.div.withConfig({displayName:"map-info__ArcGisContainer",componentId:"sc-1gr9cah-1"})(["display:flex;align-items:center;justify-content:center;margin-top:10px;"]),$=e=>({display:e?"block":"none",transition:"linear 0.5s",marginTop:e?"0":"-540px",overflowX:e?"auto":"none",border:"none"}),ee={showFullInfo:G().bool,name:G().string,tileset:G().object,metadata:G().object,token:G().string};class te extends i.PureComponent{constructor(e){super(e),this.state={showFullInfo:!1}}render(){const{metadata:e,token:t,isMinimapShown:n}=this.props,{showFullInfo:r}=this.props,s=null==e?void 0:e.serviceItemId;if(!s)return null;let o="https://www.arcgis.com/home/item.html?id="+s;return t&&(o=o+"&token="+t),i.createElement(z,{isMinimapShown:n},i.createElement("iframe",{id:"tileset-info",title:"tileset-info",style:$(r),src:o}),i.createElement(q,null,i.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://www.arcgis.com/home/item.html?id="+s},"Go to ArcGiS")))}}te.propTypes=ee,te.defaultProps={showFullInfo:!1};const ne=d.ZP.div.withConfig({displayName:"semantic-validator__SemanticValidatorContainer",componentId:"sc-h2578q-0"})([""," left:25%;right:25%;bottom:10px;color:rgba(255,255,255,0.6);font-size:16px;background:#0e111a;z-index:17;line-height:135%;border-radius:8px;min-height:38px;max-height:135px;overflow-y:auto;@media (max-width:768px){bottom:60px;width:100vw;left:0;right:0;border-radius:0;max-height:200px;line-height:100%;}"],F.kC),re=d.ZP.table.withConfig({displayName:"semantic-validator__Table",componentId:"sc-h2578q-1"})(["width:100%;"]),ie=d.ZP.th.withConfig({displayName:"semantic-validator__TableHeader",componentId:"sc-h2578q-2"})(["position:sticky;top:0;text-align:left;background:#0e111a;padding:8px;height:22px;"]),se=d.ZP.h4.withConfig({displayName:"semantic-validator__NoIssuesItem",componentId:"sc-h2578q-3"})(["margin:auto;color:white;font-weight:normal;"]),oe={color:"rgba(255, 255, 255, .3)",margin:"8px 0"},ae={lod:"LOD metric",parentLod:"LOD metric",boundingVolume:"Bounding Volume",geometryVsTextures:"Geometry vs Textures"},le={warnings:G().arrayOf(G().object)};class ce extends i.PureComponent{renderColumns(e){return e.map(((e,t)=>i.createElement("tr",{key:e.title+"-"+t},i.createElement("td",{style:{padding:"0 8px 0 8px",textAlign:"center"}},t+1),i.createElement("td",{style:{padding:"0 8px 0 8px"}},ae[e.type]),i.createElement("td",{style:{color:"rgba(249, 80, 80, .6)",padding:"0 8px 0 8px"}},e.title))))}_clearButtonStyles(){return{display:"flex",position:"absolute",top:"0",right:"0",width:"90px",alignItems:"center",justifyContent:"center",background:"transparent",padding:"4px 16px",margin:"8px",color:"rgba(255,255,255,.6)",fontWeight:"500px",borderRadius:"4px",cursor:"pointer"}}renderWarnings(e){const t=this.renderColumns(e),{clearWarnings:n}=this.props;return i.createElement(re,null,i.createElement("thead",null,i.createElement("tr",{style:oe},i.createElement(ie,null,"\u2116"),i.createElement(ie,null,"Type"),i.createElement(ie,null,"Warning",i.createElement("button",{style:this._clearButtonStyles(),onClick:n},"Clear All")))),i.createElement("tbody",null,t))}render(){const{warnings:e}=this.props;return i.createElement(ne,null,e&&Boolean(e.length)?this.renderWarnings(e):i.createElement(se,null,"No Issues"))}}ce.propTypes=le,ce.defaultProps={warnings:[]};var ue=n(92814),de=n(51436);const he=d.ZP.div.withConfig({displayName:"tool-bar__Container",componentId:"sc-1czljg4-0"})(["display:flex;justify-content:space-around;align-items:center;position:absolute;top:0;margin:10px 10px;width:277px;height:40px;background:#0E111A;border-radius:8px;z-index:100;background:#232323;@media (max-width:769px){top:auto;margin:0;bottom:0;width:100%;height:60px;border-radius:0;}"]),pe=d.ZP.button.withConfig({displayName:"tool-bar__ToolButton",componentId:"sc-1czljg4-1"})(["display:flex;flex-flow:column nowrap;justify-content:center;align-items:center;padding:0;font-size:18px;height:36px;border:none;border-radius:5px;width:100%;background:",";color:",";cursor:pointer;&:hover{color:white;}@media (max-width:769px){font-size:22px;height:56px;border-radius:0;}"],(e=>e.active?"#4F52CC":"transparent"),(e=>e.active?"white":"rgba(255, 255 , 255, .8)")),me=d.ZP.h3.withConfig({displayName:"tool-bar__Title",componentId:"sc-1czljg4-2"})(["font-size:14px;font-weight:500;text-align:center;padding:0;margin:0;@media (min-width:769px){display:none;}"]),fe=d.ZP.div.withConfig({displayName:"tool-bar__TooltipBox",componentId:"sc-1czljg4-3"})(['position:absolute;top:calc(100% + 5px);left:-37px;font-weight:500;font-size:16px;visibility:hidden;color:transparent;background-color:transparent;text-align:center;width:110px;line-height:22px;border-radius:4px;transition:visibility 0.1s,color 0.1s,background-color 0.1s all;&:before{content:"";width:0;height:0;left:55px;top:-6px;position:absolute;border:6px solid transparent;transform:rotate(135deg);transition:border 0.1s all;}@media (any-hover:none){display:none;}']),Ae=d.ZP.div.withConfig({displayName:"tool-bar__TooltipCard",componentId:"sc-1czljg4-4"})(["position:relative;min-width:51px;& ",":hover + ","{visibility:visible;color:#0E111A;justify-content:center;align-items:center;background-color:white;width:120px;border-radius:4px;&:before{border-color:transparent transparent white white;}@media (any-hover:none){display:none;}}@media (max-width:769px){flex:1 0 1px;&:not(:first-child){margin-left:1px;}}"],pe,fe),ge=(0,d.ZP)(fe).withConfig({displayName:"tool-bar__LeftTooltip",componentId:"sc-1czljg4-5"})(["left:0;&:before{left:18px;}"]),Be={onDebugOptionsChange:G().func,debugOptions:G().object};class Ce extends i.PureComponent{_renderMemoryButton(){const{debugOptions:{showMemory:e},onDebugOptionsChange:t}=this.props;return i.createElement(Ae,null,i.createElement(pe,{active:e,onClick:()=>t({showMemory:!e})},i.createElement(ue.G,{icon:de.jOs}),i.createElement(me,null,"Memory")),i.createElement(fe,null,"Memory usage"))}_renderValidatorButton(){const{debugOptions:{semanticValidator:e},onDebugOptionsChange:t}=this.props;return i.createElement(Ae,null,i.createElement(pe,{active:e,onClick:()=>t({semanticValidator:!e})},i.createElement(ue.G,{icon:de.RLE}),i.createElement(me,null,"Vaidator")),i.createElement(fe,null,"Validator"))}_renderDebugButton(){const{debugOptions:{debugPanel:e},onDebugOptionsChange:t}=this.props;return i.createElement(Ae,null,i.createElement(pe,{active:e,onClick:()=>t({debugPanel:!e})},i.createElement(ue.G,{icon:de.QLU}),i.createElement(me,null,"Debug")),i.createElement(fe,null,"Debug panel"))}_renderMapButton(){const{debugOptions:{controlPanel:e},onDebugOptionsChange:t}=this.props;return i.createElement(Ae,null,i.createElement(pe,{active:e,onClick:()=>t({controlPanel:!e})},i.createElement(ue.G,{icon:de.Wx7}),i.createElement(me,null,"Map")),i.createElement(ge,null,"Select map"))}_renderMapInfoButton(){const{debugOptions:{showFullInfo:e},onDebugOptionsChange:t}=this.props;return i.createElement(Ae,null,i.createElement(pe,{active:e,onClick:()=>t({showFullInfo:!e})},i.createElement(ue.G,{icon:de.YHc}),i.createElement(me,null,"Info")),i.createElement(fe,null,"Map info"))}render(){return i.createElement(he,null,this._renderMapButton(),this._renderMapInfoButton(),this._renderMemoryButton(),this._renderValidatorButton(),this._renderDebugButton())}}Ce.propTypes=Be,Ce.defaultProps={onDebugOptionsChange:()=>{}};var be=n(56069),_e=n(79852),ye=n(35600);const Ee=[255,0,128],Te=[128,0,255],Se=[0,128,255];new v.Z;function Me(e,t,n){const r=[e.normal[0],t.normal[0],n.normal[0]],i=[e.normal[1],t.normal[1],n.normal[1]],s=[e.normal[2],t.normal[2],n.normal[2]],o=[e.distance,t.distance,n.distance],a=ye.GH([r,i,s].flat());return[ye.GH([o,i,s].flat())/a,ye.GH([r,o,s].flat())/a,ye.GH([r,i,o].flat())/a]}var De=n(1167),xe=n(18930),ve=n(78918),we=n(80744),Re=n(65217);const Ie=[0],Ge={visible:!1,tiles:[],material:{pbrMetallicRoughness:{baseColorFactor:[1,1,1,1]}},getBoundingVolumeColor:{type:"function",value:e=>[255,255,255,100],compare:!1}};class Fe extends ve.Z{initializeState(){"onTileLoadFail"in this.props&&we.Z.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{}}}updateState(e){let{changeFlags:t}=e;if(t.propsChanged){const{layerMap:e}=this.state;for(const t in e)e[t].needsUpdate=!0}}_generateCubeMesh(e){const t=new De.Z,{header:{obb:{halfSize:n,quaternion:r,center:i}}}=e,{attributes:s}=t,o={...s.POSITION,value:new Float32Array(s.POSITION.value)},a=w.H.WGS84.cartographicToCartesian(i);for(let l=0;l<o.value.length;l+=3){const e=new v.Z(o.value.subarray(l,l+3));e.x*=n[0],e.y*=n[1],e.z*=n[2],e.transformByQuaternion(r),e.add(a),o.value.set(e,l)}return t.attributes={POSITION:o},t}_generateSphereMesh(e){const t=e.header.mbs,n=w.H.WGS84.cartographicToCartesian([t[0],t[1],t[2]]),r=t[3],i=new xe.Z({radius:r,nlat:50,nlong:50}),{attributes:s}=i,o={...s.POSITION,value:new Float32Array(s.POSITION.value)};for(let a=0;a<o.value.length;a+=3){const e=new v.Z(o.value.subarray(a,a+3));e.add(n),o.value.set(e,a)}return i.attributes={POSITION:o},i}_generateMesh(e,t){const n=e.header.obb?this._generateCubeMesh(e):null,r=e.header.mbs?this._generateSphereMesh(e):null;return e.userData.boundingMeshes.cubeMesh=n,e.userData.boundingMeshes.sphereMesh=r,e.userData.boundingMeshes[t]}_getBoundingVolumeLayer(e){const{content:t,viewportIds:n}=e,{material:r,getBoundingVolumeColor:i,boundingVolumeType:s}=this.props,{cartographicOrigin:o,cartographicModelMatrix:a}=t,l=J.BB[s];e.userData.boundingMeshes=e.userData.boundingMeshes||{};const c=e.userData.boundingMeshes[l]||this._generateMesh(e,l);return new Re.Z({id:"bounding-volume-"+e.id,mesh:c,data:Ie,getPosition:[0,0,0],getColor:i(e),viewportIds:n,material:r,modelMatrix:a,coordinateOrigin:o,coordinateSystem:A.Df.METER_OFFSETS})}renderLayers(){const{visible:e,tiles:t}=this.props;if(!e)return null;const{layerMap:n}=this.state;return t.map((e=>{const t=e.id;n[t]=n[t]||{};let{layer:r,needsUpdate:i=!0}=n[t];return e.selected?r?i?(r=this._getBoundingVolumeLayer(e),i=!1):r.props.visible||(r=r.clone({visible:!0})):r=this._getBoundingVolumeLayer(e):r&&r.props.visible&&(r=r.clone({visible:!1})),n[t]={layer:r,needsUpdate:i},r})).filter(Boolean)}}Fe.layerName="BoundingVolumeLayer",Fe.defaultProps=Ge;const Oe={textAlign:"left",fontSize:"14px",color:"white",fontWeight:"400"},Pe={background:"#0E111A",margin:"-10px",color:"rgba(255,255,255,.6)",fontSize:"14px",padding:"10px"},He={data:G().object};class Ue extends i.PureComponent{prepareRows(){const{data:e}=this.props,t=[];for(const n in e){const r=i.createElement("tr",{key:n},i.createElement("th",{style:Oe},n),i.createElement("td",null,this.formatTooltipValue(e[n])));t.push(r)}return t}formatTooltipValue(e){return e.toString().replace(/[{}']+/g,"").trim()||"No Data"}render(){const e=this.prepareRows();return e.length?i.createElement("div",{style:Pe},i.createElement("table",null,i.createElement("tbody",null,e))):null}}Ue.propTypes=He,Ue.defaultProps={data:{}};var Le=n(36625);const Je="No Data",Ne="Oriented Bounding Box",Ze="Minimum Bounding Sphere",Ve={1:"Add",2:"Replace"},Ke=3;function je(e){const t=function(e){if(!e||!e.length)return{count:Je,ids:Je};const t=[];for(const n in e)t.push(e[n].id);return{count:t.length,ids:t.join(", ")}}(e.header.children);return{"Tile Id":e.id,Type:e.type||Je,"Children Count":t.count,"Children Ids":t.ids,"Vertex count":e.content.vertexCount||Je,"Distance to camera":Xe(e._distanceToCamera)+" m"||0}}function ke(e){const t=[];return function(e,t){if(!e.parent)return;switch(Qe(e)){case Ne:!function(e,t){const n=Ye(e.parent.header.obb),r=function(e){const t=new De.Z,n=e.header.obb.halfSize,{attributes:r}=t,i=new Float32Array(r.POSITION.value),s=w.H.WGS84.cartographicToCartesian(e.header.obb.center);let o=[];for(let a=0;a<i.length;a+=3){const t=new v.Z(i[a]*=n[0],i[a+1]*=n[1],i[a+2]*=n[2]).transformByQuaternion(e.header.obb.quaternion).add(s);o=o.concat(t)}return o}(e);if($e(n,r))return;const i="OBB of Tile ("+e.id+") doesn't fit into Parent ("+e.parent.id+") tile OBB";t.push({type:J.NR,title:i})}(e,t);break;case Ze:!function(e,t){const n=We(e.header.mbs),r=We(e.parent.header.mbs);if(n.center.distanceTo(r.center)+n.radius>r.radius){const n="MBS of Tile ("+e.id+") doesn't fit into Parent ("+e.parent.id+") tile MBS";t.push({type:J.NR,title:n})}}(e,t);break;default:console.warn("Validator - Not supported Bounding Volume Type")}}(e,t),function(e,t){const n=.05,r=e.lodMetricValue/e.boundingVolume.radius,i=e.parent.lodMetricValue/e.parent.boundingVolume.radius,s=e.parent.children.map((e=>e.lodMetricValue/e.boundingVolume.radius)),o=s.reduce(((e,t)=>e+t),0)/s.length;if(o<i&&!t.find((t=>t.tileId===e.parent.id&&t.type===J.ls))){const n="Tile ("+e.parent.id+') LOD/Radius ratio "'+i+'" > mean child LOD/Radius ratio "'+o+'"';t.push({type:J.ls,title:n,tileId:e.parent.id})}if(Math.abs(r-o)>n){const n="Tile ("+e.id+') LOD/Radius ratio "'+r+'" has large deviation from mean LOD/Radius ratio of neighbors "'+o+'"';t.push({type:J.L2,title:n,tileId:e.parent.id})}}(e,t),t}function Xe(e){return e?e.toFixed(Ke):null}function Qe(e){return e.header.obb||e.boundingVolume instanceof Le.F7?Ne:Ze}function We(e){return new Le.KM([e[0],e[1],e[2]],e[3])}function Ye(e){const{center:t,halfSize:n,quaternion:r}=e;return(new Le.F7).fromCenterHalfSizeQuaternion(t,n,r)}function ze(e,t){const n=[];for(let r=0;r<3;r++){const i=new e.value.constructor(3),s=e.value.subarray((t+r)*e.size,(t+r)*e.size+e.size);i.set(s),n.push(new v.Z(i))}return n}function qe(e){const t=new v.Z(e[0].x,e[0].y,e[0].z).subtract(e[1]),n=new v.Z(e[1].x,e[1].y,e[1].z).subtract(e[2]),r=t.angle(n);return.5*t.magnitude()*n.magnitude()*Math.sin(r)}function $e(e,t){let n=!0;for(let r=0;r<t.length/3;r+=3){const i=[t[r],t[r+1],t[r+2]],s=w.H.WGS84.cartesianToCartographic(i);if(e.distanceTo(s)>0){n=!1;break}}return n}function et(e){try{const t=tt(e),{positions:n,boundingVolume:r,boundingType:i}=t,s=function(e){const t=[];for(let n=0;n<e.length;n+=3){const r=new v.Z(e[n],e[n+1],e[n+2]);t.push(r)}return t}(n);if(i===Ne){const e=(0,Le.du)(s,new Le.F7).halfSize.reduce(((e,t)=>e*t));return e<r.halfSize.reduce(((e,t)=>e*t))}return(0,Le.tF)(s,new Le.KM).radius<r.radius}catch(t){throw t}}function tt(e){if(!e.content&&!e.content.attributes&&!e.content.attributes.POSITION)throw new Error("Validator - There are no positions in tile");const t=Qe(e),n=e.content.attributes.positions.value;try{const r=function(e,t){switch(t){case Ne:return Ye(e.header.obb);case Ze:return We(e.header.mbs);default:throw new Error("Validator - Not supported Bounding Volume Type")}}(e,t);return{positions:n,boundingType:t,boundingVolume:r}}catch(r){throw r}}var nt=n(52093);const rt=d.ZP.div.withConfig({displayName:"tile-validator__TileValidatorContainer",componentId:"sc-18uw0rb-0"})(["display:flex;flex-direction:column;flex:1 0;"]),it=d.ZP.button.withConfig({displayName:"tile-validator__ValidateButton",componentId:"sc-18uw0rb-1"})(["display:flex;padding:4px 16px;background:#4f52cc;color:white;align-items:center;height:20px;justify-content:center;width:120px;border:none;font-weight:bold;cursor:pointer;margin-bottom:5px;border-radius:4px;"]),st=d.ZP.div.withConfig({displayName:"tile-validator__NormalsValidator",componentId:"sc-18uw0rb-2"})(["display:flex;align-items:center;margin-bottom:10px;flex-flow:column nowrap;"]),ot=d.ZP.div.withConfig({displayName:"tile-validator__ValidatorInfoList",componentId:"sc-18uw0rb-3"})(["display:flex;flex-direction:column;flex-shrink:0;"]),at=d.ZP.input.withConfig({displayName:"tile-validator__GapInput",componentId:"sc-18uw0rb-4"})(["max-width:50px;margin:0 10px;background:#1d2335;color:white;font-weight:bold;text-align:center;border-radius:4px;cursor:",";border:none;padding:5px;"],(e=>e.disabled?"auto":"pointer")),lt=d.ZP.div.withConfig({displayName:"tile-validator__NormalsControl",componentId:"sc-18uw0rb-5"})(["width:100%;display flex;align-items:center;margin:10px 0 10px 0;"]),ct=d.ZP.span.withConfig({displayName:"tile-validator__NoNormalsInfo",componentId:"sc-18uw0rb-6"})(["display:flex;align-self:flex-start;margin:5px;color:#ff0047;"]),ut="warning",dt="ok",ht={tile:G().object,trianglesPercentage:G().number,normalsLength:G().number,showNormals:G().bool,handleShowNormals:G().func,handleChangeTrianglesPercentage:G().func,handleChangeNormalsLength:G().func};class pt extends i.PureComponent{constructor(e){super(e),this.state={tileId:e.tile.id,geometryInfo:null,triangleMessages:null,boundingVolumeInfo:null}}static getDerivedStateFromProps(e,t){return e.tile.id!==t.tileId?{tileId:e.tile.id,geometryInfo:null,triangleMessages:null,boundingVolumeInfo:null}:null}_onValidateTile(e){this._validateGeometryInsideBoundingVolume(e),this._validateGeometryVsTexture(e),this.compareGeometryBoundingVolumeVsTileBoundingVolume(e)}_validateGeometryInsideBoundingVolume(e){try{const t=function(e){try{const t=tt(e),{positions:n,boundingVolume:r}=t;return $e(r,n)}catch(t){throw t}}(e);if(t){const e="Geometry fits into BoundingVolume";this.setState({geometryInfo:{type:dt,title:e}})}else{const e="Geometry doesn't fit into BoundingVolume";this.setState({geometryInfo:{type:ut,title:e}})}}catch(t){this.setState({geometryInfo:{type:ut,title:t}})}}_validateGeometryVsTexture(e){const t=function(e){if(!(e&&e.content&&e.content.attributes))return null;const t=e.content.attributes,{positions:n,texCoords:r}=t;if(!n||!r)return null;const i=function(e){if(!e.content)return 0;const t=e.content.material&&e.content.material.pbrMetallicRoughness&&e.content.material.pbrMetallicRoughness.baseColorTexture&&e.content.material.pbrMetallicRoughness.baseColorTexture.texture.source.image||e.content.texture||null;return t?t.height*t.width:0}(e);if(!i)return null;const s=1/i;let o=Number.MAX_VALUE,a=Number.MAX_VALUE,l=0,c=0,u=0,d=0;const h=n.value.length/n.size;for(let p=0;p<h;p+=3){const e=ze(n,p),t=ze(r,p),i=qe(e),h=qe(t);0===i?l++:o=Math.min(o,i),0===h?c++:a=Math.min(a,h),i<.001&&u++,h<s&&d++}return{triangles:h/3,geometryNullTriangleCount:l,geometrySmallTriangleCount:u,texCoordNullTriangleCount:c,texCoordSmallTriangleCount:d,minGeometryArea:o,minTexCoordArea:a,pixelArea:s}}(e);if(!t)return;const n=[];n.push({key:"trianglesTotal",text:"Triangles total: "+t.triangles}),t.geometryNullTriangleCount?n.push({key:"geometryNullTriangleCount",type:ut,text:"Geometry degenerate triangles: "+t.geometryNullTriangleCount}):n.push({key:"geometryNullTriangleCount",type:dt,text:"Geometry degenerate triangles: "+t.geometryNullTriangleCount}),t.geometrySmallTriangleCount?(n.push({key:"geometrySmallTriangleCount",type:ut,text:"Geometry small triangles (less than 1 squared mm): "+t.geometrySmallTriangleCount}),n.push({key:"minGeometryArea",type:ut,text:"Geometry smallest triangle: "+t.minGeometryArea+" m^2"})):n.push({key:"geometrySmallTriangleCount",type:dt,text:"Geometry small triangles (less than 1 squared mm): "+t.geometrySmallTriangleCount}),t.texCoordNullTriangleCount?n.push({key:"texCoordNullTriangleCount",type:ut,text:"UV0 degenerate triangles: "+t.texCoordNullTriangleCount}):n.push({key:"texCoordNullTriangleCount",type:dt,text:"UV0 degenerate triangles: "+t.texCoordNullTriangleCount}),t.texCoordSmallTriangleCount?(n.push({key:"texCoordSmallTriangleCount",type:ut,text:"UV0 small triangles (occupies less than 1 pixel): "+t.texCoordSmallTriangleCount}),n.push({key:"minTexCoordArea",type:ut,text:"UV0 smallest triangle: "+t.minTexCoordArea}),n.push({key:"pixelArea",type:ut,text:"UV0 pixel area: "+t.pixelArea})):n.push({key:"texCoordSmallTriangleCount",type:dt,text:"UV0 small triangles (less than 1 squared mm): "+t.texCoordSmallTriangleCount}),this.setState({triangleMessages:n})}compareGeometryBoundingVolumeVsTileBoundingVolume(e){try{if(et(e)){const e="Geometry bounding volume is more suitable than tile bounding volume";this.setState({boundingVolumeInfo:{type:ut,title:e}})}else{const e="Tile bounding volume is suitable for geometry";this.setState({boundingVolumeInfo:{type:dt,title:e}})}}catch(t){this.setState({boundingVolumeInfo:{type:ut,title:t}})}}getInfoStyle(e){return{color:e===ut?"#FF0047":"#01DC69",marginTop:"5px"}}getCheckboxStyle(e){return{cursor:e?"pointer":"auto"}}_renderTriangleMetrics(){const{triangleMessages:e}=this.state;return e?e.map((e=>i.createElement("span",{key:e.key,style:this.getInfoStyle(e.type)},e.text))):null}_renderBoundingVolumesMetrics(){const{boundingVolumeInfo:e}=this.state;return e?i.createElement("span",{style:this.getInfoStyle(e.type)},e.title):null}_renderGeometryMetrics(){const{geometryInfo:e}=this.state;return e?i.createElement("span",{style:this.getInfoStyle(e.type)},e.title):null}_renderNormalsValidationControl(){const{tile:e,handleShowNormals:t,showNormals:n,trianglesPercentage:r,normalsLength:s,handleChangeTrianglesPercentage:o,handleChangeNormalsLength:a}=this.props,l=e&&e.content&&e.content.attributes&&e.content.attributes.normals;return i.createElement(st,null,!l&&i.createElement(ct,null,"Tile has no normals"),i.createElement(lt,null,i.createElement("label",{style:this.getCheckboxStyle(l),htmlFor:"normals-checkbox"},i.createElement(L.XZ,{id:"normals-checkbox",type:"checkbox",disabled:!l,checked:n,onChange:()=>t(e)}),"Show Normals")),i.createElement(lt,null,i.createElement("span",null,"Percent"),i.createElement(at,{type:"number",min:"1",max:"100",value:r,disabled:!l,onChange:t=>o(e,Number(t.target.value))}),i.createElement("span",null,"% triangles with normals")),i.createElement(lt,null,i.createElement("span",null,"Normals length"),i.createElement(at,{type:"number",min:"1",value:s,disabled:!l,onChange:t=>a(e,Number(t.target.value))}),i.createElement("span",null,"m")))}render(){const{tile:e}=this.props;return i.createElement(rt,null,this._renderNormalsValidationControl(),i.createElement(it,{onClick:()=>this._onValidateTile(e)},"Validate Tile"),i.createElement(ot,null,this._renderGeometryMetrics(),this._renderBoundingVolumesMetrics(),this._renderTriangleMetrics()))}}pt.propTypes=ht,pt.defaultProps={tile:null,showNormals:!1,handleShowNormals:()=>{},handleChangeTrianglesPercentage:()=>{},handleChangeNormalsLength:()=>{}};const mt=3,ft=new v.Z;function At(e){if(!(e.content&&e.content.attributes&&e.content.attributes.normals&&e.content.attributes.positions))return{};const t=e.content.attributes.normals.value,n=e.content.attributes.positions.value,r=e.content.modelMatrix,i=e.content.cartographicModelMatrix,s=e.content.cartographicOrigin,o=new n.constructor(n.length);for(let a=0;a<o.length;a+=3){const e=n.subarray(a,a+3);ft.set(e[0],e[1],e[2]),ft.transform(r).add(s),w.H.WGS84.cartographicToCartesian(ft,ft),o.set(ft,a)}return{src:{normals:t,positions:o},length:n.length,modelMatrix:r,cartographicModelMatrix:i,cartographicOrigin:s}}function gt(e,t){const n=e.length/mt,r=Math.floor(n*(t/100)),i=Math.floor(n/r);return 1===i?i:i*mt}const Bt={};function Ct(e,t){if(Bt[e.id]=e,!t||e.userData.originalTexture)return;const{texture:n,material:r}=e.content||{};if(r){if(!(r&&r.pbrMetallicRoughness&&r.pbrMetallicRoughness.baseColorTexture))return;e.userData.originalTexture=r.pbrMetallicRoughness.baseColorTexture.texture.source.image,r.pbrMetallicRoughness.baseColorTexture.texture.source.image=t,e.content.material={...e.content.material}}else n&&(e.userData.originalTexture=n,e.content.texture=t)}function bt(e){Bt[e.id]=e;const{content:t,userData:{originalTexture:n}}=e,{texture:r,material:i}=t||{};if(n){if(i){if(!(i&&i.pbrMetallicRoughness&&i.pbrMetallicRoughness.baseColorTexture))return;i.pbrMetallicRoughness.baseColorTexture.texture.source.image=n,e.content.material={...e.content.material}}else r&&(e.content.texture=n);delete e.userData.originalTexture}}var _t=n(61182),yt=n(49045),Et=n(47208);const Tt=[255,0,0],St=[255,255,255],Mt="https://raw.githubusercontent.com/visgl/deck.gl-data/master/images/uv-debug-texture.jpg",Dt={longitude:-120,latitude:34,height:600,width:800,pitch:45,maxPitch:60,bearing:0,minZoom:2,maxZoom:30,zoom:14.5},xt={rScaler:256,gScaler:1,bScaler:1/256,offset:-32768},vt={minimap:!0,minimapViewport:!1,boundingVolume:!1,tileColorMode:J.Bu,boundingVolumeColorMode:J.Vk,boundingVolumeType:J.IO,pickable:!1,loadTiles:!0,semanticValidator:!1,showUVDebugTexture:!1,wireframe:!1,showMemory:!1,controlPanel:!0,debugPanel:!1,showFullInfo:!1},wt={default:{material:{height:"auto",width:"auto"}}},Rt=[new m.Z({id:"main",controller:{inertia:!0},farZMultiplier:2.02}),new m.Z({id:"minimap",x:"79%",y:"79%",width:"20%",height:"20%",clear:!0,controller:{maxZoom:9,minZoom:9,dragRotate:!1,keyboard:!1}})],It={color:"white"},Gt={cursor:"pointer"},Ft=d.ZP.div.withConfig({displayName:"app-debug__StatsWidgetWrapper",componentId:"sc-111hjef-0"})(["display:",";"],(e=>e.showMemory?"inherit":"none")),Ot=d.ZP.div.withConfig({displayName:"app-debug__StatsWidgetContainer",componentId:"sc-111hjef-1"})([""," "," "," color:rgba(255,255,255,.6);z-index:3;top:10px;right:10px;word-break:break-word;padding:24px;border-radius:8px;width:250px;max-height:calc(100% - 10px);line-height:135%;overflow:auto;@media (max-width:768px){top:",";max-height:",";right:0px;border-radius:0px;}"],F.kC,F.Il,F.Zx,(e=>e.renderControlPanel?"85px":"10px"),(e=>e.renderControlPanel?"calc(100% - 145px)":"calc(100% - 70px)"));class Pt extends i.PureComponent{constructor(e){super(e),this._tilesetStatsWidget=null,this._colorMap=null,this._uvDebugTexture=null,this._loadedTilesets=[],this.state={url:null,token:null,mainTileset:null,frameNumber:0,name:be.u,viewState:{main:Dt,minimap:{latitude:Dt.latitude,longitude:Dt.longitude,zoom:9,pitch:0,bearing:0}},selectedMapStyle:J.ih,debugOptions:{...vt},normalsDebugData:[],trianglesPercentage:30,normalsLength:20,tileInfo:null,selectedTile:null,coloredTilesMap:{},warnings:[],flattenedSublayers:[],sublayers:[],sublayersUpdateCounter:0,tilesetsStats:(0,yt.P)(),useTerrainLayer:!1,terrainTiles:{}},this._onSelectTileset=this._onSelectTileset.bind(this),this._setDebugOptions=this._setDebugOptions.bind(this),this._layerFilter=this._layerFilter.bind(this),this.handleClosePanel=this.handleClosePanel.bind(this),this.handleSelectTileColor=this.handleSelectTileColor.bind(this),this.handleClearWarnings=this.handleClearWarnings.bind(this),this.handleShowNormals=this.handleShowNormals.bind(this),this.handleChangeTrianglesPercentage=this.handleChangeTrianglesPercentage.bind(this),this.handleChangeNormalsLength=this.handleChangeNormalsLength.bind(this),this._updateSublayerVisibility=this._updateSublayerVisibility.bind(this),this._onToggleBuildingExplorer=this._onToggleBuildingExplorer.bind(this),this._toggleTerrain=this._toggleTerrain.bind(this)}componentDidMount(){let e;this._memWidget=new x.Z(h.lR.get("Memory Usage"),{framesPerUpdate:1,formatters:{"GPU Memory":"memory","Buffer Memory":"memory","Renderbuffer Memory":"memory","Texture Memory":"memory"},container:this._statsWidgetContainer}),this._tilesetStatsWidget=new x.Z(null,{container:this._statsWidgetContainer});const t=(0,nt.u)();e=t?{url:t}:be.Q[be.u],this.setState({tilesetsStats:(0,yt.P)(t)}),this._onSelectTileset(e),(0,T.z)(Mt,D.S).then((e=>this._uvDebugTexture=e))}_getViewState(){const{viewState:e,debugOptions:t}=this.state;return t.minimap?e:{main:e.main}}_getViews(){const{debugOptions:e}=this.state;return e.minimap?Rt:[Rt[0]]}async _onSelectTileset(e){const t=(0,nt.t)(e.url,e),{tilesetUrl:n,token:r,name:i,metadataUrl:s}=t;this.setState({tilesetUrl:n,name:i,token:r,sublayers:[]}),this.handleClearWarnings();const o=await fetch(s).then((e=>e.json())),a=await this.getFlattenedSublayers(n);this.setState({metadata:o,tileInfo:null,normalsDebugData:[],flattenedSublayers:a}),this._loadedTilesets=[],this.needTransitionToTileset=!0;const l=(0,yt.P)(n);this._tilesetStatsWidget.setStats(l),this.setState({tilesetsStats:l})}async getFlattenedSublayers(e){try{const t=await(0,T.z)(e,S.z),n=(0,_t.$)(t.header.sublayers);this.setState({sublayers:n.sublayers});return null==t?void 0:t.sublayers.filter((e=>"Overview"!==e.name))}catch(t){return[{url:e,visibility:!0}]}}_updateStatWidgets(){this._memWidget.update();const{tilesetsStats:e}=this.state;(0,yt.D)(this._loadedTilesets,e),this._tilesetStatsWidget.update()}_onTileLoad(e){this.removeFeatureIdsFromTile(e),this._updateStatWidgets(),this.validateTile(e),this.state.debugOptions.showUVDebugTexture?Ct(e,this._uvDebugTexture):bt(e)}_onTileUnload(){this._updateStatWidgets()}_onTilesetLoad(e){if(this._loadedTilesets=[...this._loadedTilesets,e],this.needTransitionToTileset){var t,n;const{zoom:r,cartographicCenter:i}=e,[s,o]=i;let a=s,l=o;const c=new Rt[0].ViewportType(this.state.viewState.main),{metadata:u,viewState:{main:{pitch:d,bearing:h}}}=this.state,{zmin:p=0}=(null==u||null==(t=u.layers)||null==(n=t[0])?void 0:n.fullExtent)||{},m=p*Math.tan(d*Math.PI/180),A=c.projectPosition([s,o]);A[0]+=m*Math.sin(h*Math.PI/180)*c.distanceScales.unitsPerMeter[0],A[1]+=m*Math.cos(h*Math.PI/180)*c.distanceScales.unitsPerMeter[1],[a,l]=c.unprojectPosition(A),this.setState({viewState:{main:{...this.state.viewState.main,zoom:r+2.5,longitude:a,latitude:l,transitionDuration:4e3,transitionInterpolator:new f.Z},minimap:{...this.state.viewState.minimap,longitude:a,latitude:l}},debugOptions:{...vt}}),this.needTransitionToTileset=!1}const{debugOptions:{minimapViewport:r,loadTiles:i}}=this.state,s={main:"main",minimap:r?"minimap":"main"};e.setOptions({viewportTraversersMap:s,loadTiles:i})}_onViewStateChange(e){let{interactionState:t,viewState:n,viewId:r}=e,{longitude:i,latitude:s,position:[o,a,l]}=n;const{terrainTiles:c}=this.state,u=(0,Et.a)(i,s,c)||0;let d=null;if(this.currentViewport){const e=this.currentViewport.unprojectPosition(this.currentViewport.cameraPosition);d=(0,Et.a)(e[0],e[1],c)||0}let h=null===d||u>d?u:d;t.isZooming||(l-h>5?h=l-5:h-l>5&&(h=l+5));const p=this.state.viewState;"minimap"===r?this.setState({viewState:{main:{...p.main,longitude:n.longitude,latitude:n.latitude,position:[0,0,h]},minimap:n}}):this.setState({viewState:{main:{...n,position:[0,0,h]},minimap:{...p.minimap,longitude:n.longitude,latitude:n.latitude}}})}_onSelectMapStyle(e){let{selectedMapStyle:t}=e;this.setState({selectedMapStyle:t})}_setDebugOptions(e){const{debugOptions:t}=this.state,n={...t,...e};n.tileColorMode!==_e.Yn.CUSTOM&&this.setState({coloredTilesMap:{},selectedTile:null});const{debugOptions:{showUVDebugTexture:r}}=this.state;n.showUVDebugTexture!==r&&this._loadedTilesets.forEach((e=>{n.showUVDebugTexture?function(e,t){if(t){for(const n of e.tiles)Ct(n,t);for(const e in Bt)Ct(Bt[e],t)}}(e,this._uvDebugTexture):function(e){for(const t in Bt)bt(Bt[t])}()}));const{minimapViewport:i,loadTiles:s}=n,o={main:"main",minimap:i?"minimap":"main"};this._loadedTilesets.forEach((e=>{e.setOptions({viewportTraversersMap:o,loadTiles:s}),e.update()}));const{debugPanel:a}=this.state,{debugPanel:l}=n;a!==l&&l&&(n.buildingExplorer=!1),this.setState({debugOptions:n})}removeFeatureIdsFromTile(e){delete e.content.featureIds}validateTile(e){const{warnings:t}=this.state,n=ke(e);n.length&&this.setState({warnings:[...t,...n]})}getBoundingVolumeColor(e){const{boundingVolumeColorMode:t}=this.state.debugOptions;return[...this._colorMap.getColor(e,{coloredBy:t})||St,100]}getMeshColor(e){const{selectedTile:t,coloredTilesMap:n,debugOptions:r}=this.state,{tileColorMode:i}=r;return this._colorMap.getColor(e,{coloredBy:i,selectedTileId:null==t?void 0:t.id,coloredTilesMap:n})||St}_getAllTilesFromTilesets(e){return e.map((e=>e.tiles)).flat()}_toggleTerrain(){const{useTerrainLayer:e}=this.state;this.setState({useTerrainLayer:!e})}_onTerrainTileLoad(e){const{terrainTiles:t}=this.state,{bbox:{east:n,north:r,south:i,west:s}}=e;this.setState({terrainTiles:{...t,[n+";"+r+";"+i+";"+s]:e}})}_renderTerrainLayer(){return new y.Z({id:"terrain",maxZoom:15,elevationDecoder:xt,elevationData:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",texture:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",onTileLoad:e=>this._onTerrainTileLoad(e),color:[255,255,255]})}_renderMainOnMinimap(){const{debugOptions:{minimapViewport:e}}=this.state;if(!e)return null;let t=[];if(this._loadedTilesets.length){t=function(e){return e.map((e=>{if(!e.selected||!e.viewportIds.includes("main"))return null;const{boundingVolume:t}=e,n=new v.Z;w.H.WGS84.cartesianToCartographic(t.center,n);let r=10;return t.radius?r=t.radius:t.halfAxes&&(r=t.getBoundingSphere().radius),{coordinates:n,radius:r}})).filter(Boolean)}(this._getAllTilesFromTilesets(this._loadedTilesets))}return new b.Z({id:"main-on-minimap",data:t,pickable:!1,opacity:.8,stroked:!0,filled:!0,radiusScale:1,radiusMinPixels:1,radiusMaxPixels:100,lineWidthMinPixels:1,getPosition:e=>e.coordinates,getRadius:e=>e.radius,getFillColor:e=>[255,140,0,100],getLineColor:e=>[0,0,0,120]})}_renderLayers(){const{flattenedSublayers:e,token:t,viewState:n,debugOptions:{boundingVolume:r,boundingVolumeType:i,pickable:s,wireframe:o},normalsDebugData:a,trianglesPercentage:l,normalsLength:c,useTerrainLayer:u}=this.state,d={i3s:{coordinateSystem:A.Df.LNGLAT_OFFSETS}};t&&(d.i3s={...d.i3s,token:t}),this._colorMap=this._colorMap||new _e.ZP;const h=this._getAllTilesFromTilesets(this._loadedTilesets),p=function(e){const t=e.getFrustumPlanes(),n=e.unprojectPosition(Me(t.near,t.top,t.left)),r=e.unprojectPosition(Me(t.near,t.top,t.right)),i=e.unprojectPosition(Me(t.near,t.bottom,t.left)),s=e.unprojectPosition(Me(t.near,t.bottom,t.right)),o=e.unprojectPosition(Me(t.far,t.top,t.left)),a=e.unprojectPosition(Me(t.far,t.top,t.right)),l=e.unprojectPosition(Me(t.far,t.bottom,t.left)),c=e.unprojectPosition(Me(t.far,t.bottom,t.right));return[{source:n,target:r,color:Ee},{source:r,target:s,color:Ee},{source:s,target:i,color:Ee},{source:i,target:n,color:Ee},{source:o,target:a,color:Te},{source:a,target:c,color:Te},{source:c,target:l,color:Te},{source:l,target:o,color:Te},{source:n,target:o,color:Se},{source:i,target:l,color:Se},{source:r,target:a,color:Se},{source:s,target:c,color:Se}]}(new g.Z(n.main)),m=e.filter((e=>e.visibility)).map((e=>new E.Z({id:"tile-layer-"+e.id,data:e.url,loader:M.N,onTilesetLoad:this._onTilesetLoad.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),loadOptions:d,pickable:s,autoHighlight:!0,_subLayerProps:{mesh:{wireframe:o}},_getMeshColor:this.getMeshColor.bind(this)})));if(u){const e=this._renderTerrainLayer();m.push(e)}return[...m,new _.Z({id:"frustum",data:p,getSourcePosition:e=>e.source,getTargetPosition:e=>e.target,getColor:e=>e.color,getWidth:2}),new Fe({id:"bounding-volume-layer",visible:r,tiles:h,getBoundingVolumeColor:this.getBoundingVolumeColor.bind(this),boundingVolumeType:i}),new _.Z({id:"normals-debug",data:a,getSourcePosition:(e,t)=>{let{index:n,data:r}=t;return function(e,t,n){const r=t.src.positions,i=gt(r,n);let s={};e%i!=0&&0!==i||(s=new v.Z([r[3*e],r[3*e+1],r[3*e+2]]));return s}(n,r,l)},getTargetPosition:(e,t)=>{let{index:n,data:r}=t;return function(e,t,n,r){const i=t.src.positions,s=gt(i,n);let o={};if(e%s==0||0===s){const n=t.src.normals,s=new v.Z([i[3*e],i[3*e+1],i[3*e+2]]),a=new v.Z([n[3*e],n[3*e+1],n[3*e+2]]).multiplyByScalar(r);o=s.add(a)}return o}(n,r,l,c)},getColor:()=>Tt,modelMatrix:a.cartographicModelMatrix,coordinateOrigin:a.cartographicOrigin,coordinateSystem:A.Df.METER_OFFSETS,getWidth:1}),this._renderMainOnMinimap()]}_renderStats(){const{debugOptions:{controlPanel:e}}=this.state;return i.createElement(Ot,{renderControlPanel:e,ref:e=>this._statsWidgetContainer=e})}_renderMemory(){const{debugOptions:{showMemory:e}}=this.state;return i.createElement(Ft,{showMemory:e},this._renderStats())}_renderDebugPanel(){const{debugOptions:e,debugOptions:{controlPanel:t},sublayers:n}=this.state;return i.createElement(W,{onDebugOptionsChange:this._setDebugOptions,clearWarnings:this.handleClearWarnings,debugTextureImage:Mt,debugOptions:e,renderControlPanel:t,hasBuildingExplorer:Boolean(n.length)})}_updateSublayerVisibility(e){if("3DObject"===e.layerType){const{flattenedSublayers:t,sublayersUpdateCounter:n}=this.state,r=t.find((t=>t.id===e.id));r&&(r.visibility=e.visibility,this.setState({sublayersUpdateCounter:n+1}),e.visibility||(this._loadedTilesets=this._loadedTilesets.filter((e=>e.basePath!==r.url))))}}_onToggleBuildingExplorer(e){const t={buildingExplorer:e};e&&(t.debugPanel=!e),this._setDebugOptions(t)}_renderControlPanel(){const{name:e,selectedMapStyle:t,sublayers:n,debugOptions:{buildingExplorer:r},useTerrainLayer:s}=this.state;return i.createElement(Y.Z,{debugMode:!0,name:e,onExampleChange:this._onSelectTileset,onMapStyleChange:this._onSelectMapStyle.bind(this),onToggleBuildingExplorer:this._onToggleBuildingExplorer,onUpdateSublayerVisibility:this._updateSublayerVisibility,selectedMapStyle:t,sublayers:n,isBuildingExplorerShown:r,useTerrainLayer:s,toggleTerrain:this._toggleTerrain})}_renderInfo(){const{debugOptions:{showFullInfo:e},token:t,metadata:n,debugOptions:{minimap:r}}=this.state;return i.createElement(te,{showFullInfo:e,metadata:n,token:t,isMinimapShown:r})}_renderToolPanel(){const{debugOptions:e}=this.state;return i.createElement(Ce,{onDebugOptionsChange:this._setDebugOptions,debugOptions:e})}_layerFilter(e){let{layer:t,viewport:n}=e;const{debugOptions:{minimapViewport:r}}=this.state,{id:i}=n,{id:s,props:{viewportIds:o=null}}=t;return("minimap"===i||"frustum"!==s&&"main-on-minimap"!==s)&&((!r||"minimap"!==i||-1===s.indexOf("obb-debug-"))&&(!(o&&!o.includes(i))&&(("minimap"!==i||"normals-debug"!==s)&&("minimap"!==i||-1===s.indexOf("terrain")))))}getTooltip(e){if(!e.object||e.index<0||!e.layer)return null;const t=je(e.object),n=document.createElement("div");return(0,o.render)(i.createElement(Ue,{data:t}),n),{html:n.innerHTML}}handleClick(e){if(!e.object)return void this.handleClosePanel();const t={...je(n=e.object),"Refinement Type":Ve[n.refine]||Je,"Has Texture":Boolean(n.content.texture),"Has Material":Boolean(n.content.material),"Bounding Type":Qe(n),"LOD Metric Type":n.lodMetricType||Je,"LOD Metric Value":Xe(n.lodMetricValue)||Je,"Screen Space Error":Xe(n._screenSpaceError)||Je};var n;this.setState({tileInfo:t,normalsDebugData:[],selectedTile:e.object})}handleClosePanel(){this.setState({tileInfo:null,selectedTile:null,normalsDebugData:[]})}handleSelectTileColor(e,t){const{coloredTilesMap:n}=this.state,r={...n,[e]:(0,_e.aR)(t)};this.setState({coloredTilesMap:r})}handleResetColor(e){const{coloredTilesMap:t}=this.state,n={...t};delete n[e],this.setState({coloredTilesMap:n})}getResetButtonStyle(e){return{display:"flex",padding:"4px 16px",borderRadius:"8px",alignItems:"center",height:"27px",fontWeight:"bold",marginTop:"10px",cursor:e?"auto":"pointer",color:e?"rgba(255,255,255,.6)":"white",background:e?"#0E111A":"#4F52CC"}}handleClearWarnings(){this.setState({warnings:[]})}handleShowNormals(e){const{normalsDebugData:t}=this.state;this.setState({normalsDebugData:t.length?[]:At(e)})}handleChangeTrianglesPercentage(e,t){const{normalsDebugData:n}=this.state;n.length&&this.setState({normalsDebugData:At(e)});const r=this.validateTrianglesPercentage(t);this.setState({trianglesPercentage:r})}handleChangeNormalsLength(e,t){const{normalsDebugData:n}=this.state;n.length&&this.setState({normalsDebugData:At(e)}),this.setState({normalsLength:t})}validateTrianglesPercentage(e){return e<0?1:e>100?100:e}_renderAttributesPanel(){const{tileInfo:e,debugOptions:t,coloredTilesMap:n,normalsDebugData:r,trianglesPercentage:s,normalsLength:o,selectedTile:a}=this.state,l=t.tileColorMode===_e.Yn.CUSTOM,c=e["Tile Id"],d=(0,_e.Y4)(n[c]),h=!n[c],p="Tile: "+a.id;return i.createElement(R.Z,{title:p,handleClosePanel:this.handleClosePanel,attributesObject:e,selectTileColor:this.handleSelectTileColor,isControlPanelShown:t.controlPanel},i.createElement(pt,{tile:a,showNormals:Boolean(r.length),trianglesPercentage:s,normalsLength:o,handleShowNormals:this.handleShowNormals,handleChangeTrianglesPercentage:this.handleChangeTrianglesPercentage,handleChangeNormalsLength:this.handleChangeNormalsLength}),l&&i.createElement("div",{style:Gt},i.createElement("h3",{style:It},"Tile Color Selector"),i.createElement(u.A8,{width:"auto",color:d,onChange:e=>this.handleSelectTileColor(c,e)}),i.createElement(u.NV,{styles:wt,color:d,onChange:e=>this.handleSelectTileColor(c,e)}),i.createElement("button",{disabled:h,style:this.getResetButtonStyle(h),onClick:()=>this.handleResetColor(c)},"Reset")))}_renderSemanticValidator(){const{warnings:e}=this.state;return i.createElement(ce,{warnings:e,clearWarnings:this.handleClearWarnings})}render(){const e=this._renderLayers(),{selectedMapStyle:t,selectedTile:n,tileInfo:r,debugOptions:{debugPanel:s,showFullInfo:o,controlPanel:l,semanticValidator:u},useTerrainLayer:d}=this.state;return i.createElement("div",{style:{position:"relative",height:"100%"}},this._renderToolPanel(),this._renderMemory(),s&&this._renderDebugPanel(),o&&this._renderInfo(),l&&this._renderControlPanel(),n&&r&&this._renderAttributesPanel(),u&&this._renderSemanticValidator(),i.createElement(p.Z,{layers:e,viewState:this._getViewState(),views:this._getViews(),layerFilter:this._layerFilter,onViewStateChange:this._onViewStateChange.bind(this),controller:{type:B.Z,maxPitch:60,inertia:!0,scrollZoom:{speed:.01,smooth:!0}},onAfterRender:()=>this._updateStatWidgets(),getTooltip:e=>this.getTooltip(e),onClick:e=>this.handleClick(e)},!d&&i.createElement(a.D5,{reuseMaps:!0,mapLib:c(),mapStyle:t,preventStyleDiffing:!0}),i.createElement(C.Z,{id:"minimap"},i.createElement(a.D5,{reuseMaps:!0,mapLib:c(),mapStyle:t,preventStyleDiffing:!0}))))}}const Ht={},Ut="I3S Debug",Lt={unversionedId:"i3s-debug",id:"i3s-debug",title:"I3S Debug",description:"",source:"@site/src/examples/i3s-debug.mdx",sourceDirName:".",slug:"/i3s-debug",permalink:"/examples/i3s-debug",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"examplesSidebar",previous:{title:"I3S",permalink:"/examples/i3s"},next:{title:"ArcGIS",permalink:"/examples/i3s-arcgis"}},Jt={},Nt=[],Zt={toc:Nt},Vt="wrapper";function Kt(e){let{components:t,...n}=e;return(0,s.kt)(Vt,(0,r.Z)({},Zt,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"i3s-debug"},"I3S Debug"),(0,s.kt)("div",{style:{height:"100vh"}},(0,s.kt)(Pt,{mdxType:"Demo"})))}Kt.isMDXComponent=!0},25719:(e,t,n)=>{"use strict";n.d(t,{Z:()=>B});var r=n(67294),i=n(19521),s=n(45697),o=n.n(s),a=n(92814),l=n(51436),c=n(63990);const u=i.ZP.div.withConfig({displayName:"attributes-panel__Container",componentId:"sc-1mekzsx-0"})([""," align-items:center;color:rgba(255,255,255,.6);background:#0e111a;flex-flow:column;right:0;top:15px;right:15px;width:320px;height:auto;max-height:75%;z-index:16;word-break:break-word;border-radius:8px;@media (max-width:768px){margin:0;top:",";max-height:",";border-radius:0;width:300px;}"],c.kC,(e=>e.isControlPanelShown?"95px":"10px"),(e=>e.isControlPanelShown?"calc(75% - 95px)":"calc(75% - 10px)")),d=i.ZP.div.withConfig({displayName:"attributes-panel__ContentWrapper",componentId:"sc-1mekzsx-1"})(["overflow-y:auto;width:95%;padding:0 15px;margin-bottom:15px;"]),h=i.ZP.table.withConfig({displayName:"attributes-panel__AttributesTable",componentId:"sc-1mekzsx-2"})(["width:100%;"]),p={width:"50%",textAlign:"left",fontWeight:"500",borderRight:"3px solid rgba(0,0,0,.05)",padding:"5px 0"},m={width:"50%",fontWeight:"400",padding:"5px 0"},f={height:"30px",border:"none",cursor:"pointer",background:"transparent",color:"white",outline:"none",fontSize:"19px",marginRight:"5px"},A={title:o().string,attributesObject:o().object,isControlPanelShown:o().bool,children:o().node,handleClosePanel:o().func},g={marginLeft:"15px",color:"white"};class B extends r.PureComponent{prepareTable(){const{attributesObject:e}=this.props,t=[];for(const n in e){const r=this.formatValue(e[n]),i=this.createTableColumn(n,r);t.push(i)}return r.createElement(h,null,r.createElement("tbody",null,t))}createTableColumn(e,t){return r.createElement("tr",{key:e},r.createElement("th",{style:p},e),r.createElement("td",{style:m},t))}formatValue(e){return String(e).replace(/[{}']+/g,"").trim()||"No Data"}getHeaderStyle(e){return{display:"flex",flexFlow:"row nowrap",justifyContent:e?"space-between":"flex-end",alignItems:"center",minHeight:"40px",width:"100%"}}renderHeader(){const{title:e,handleClosePanel:t}=this.props;return r.createElement("div",{style:this.getHeaderStyle(e)},e&&r.createElement("h3",{style:g},e),r.createElement("button",{style:f,onClick:t},r.createElement(a.G,{icon:l.NBC})))}render(){const{attributesObject:e,isControlPanelShown:t,children:n}=this.props;return r.createElement(u,{isControlPanelShown:t},this.renderHeader(),r.createElement(d,null,e&&this.prepareTable(),n))}}B.propTypes=A,B.defaultProps={title:null,attributesObject:{},isControlPanelShown:!1,children:null,handleClosePanel:()=>{}}},98505:(e,t,n)=>{"use strict";n.d(t,{XZ:()=>u,bH:()=>h,eM:()=>d});var r=n(87462),i=n(67294),s=n(19521);const o=s.ZP.div.withConfig({displayName:"checkbox__CheckboxContainer",componentId:"sc-n0ckdw-0"})(["display:inline-block;vertical-align:middle;cursor:","};"],(e=>e.disabled?"auto":"pointer")),a=s.ZP.svg.withConfig({displayName:"checkbox__Icon",componentId:"sc-n0ckdw-1"})(["fill:none;stroke:white;stroke-width:2px;"]),l=s.ZP.input.attrs({type:"checkbox"}).withConfig({displayName:"checkbox__HiddenCheckbox",componentId:"sc-n0ckdw-2"})(["border:0;clip:rect(0 0 0 0);clippath:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;white-space:nowrap;width:1px;"]),c=s.ZP.div.withConfig({displayName:"checkbox__StyledCheckbox",componentId:"sc-n0ckdw-3"})(["display:inline-block;width:22px;height:22px;margin-right:8px;background:",";border:",";border-radius:4px;transition:all 150ms;",":focus + &{box-shadow:0 0 0 2px #4f52cc;}","{visibility:",";}"],(e=>e.checked?"#4F52CC":"#0E111A"),(e=>e.disabled?"1px solid rgba(255,255,255, .6)":"1px solid #4F52CC"),l,a,(e=>e.checked?"visible":"hidden")),u=e=>{let{checked:t,...n}=e;return i.createElement(o,{disabled:n.disabled},i.createElement(l,(0,r.Z)({checked:t},n)),i.createElement(c,{disabled:n.disabled,checked:t},i.createElement(a,{viewBox:"0 0 24 24"},i.createElement("polyline",{points:"20 6 9 17 4 12"}))))},d=s.ZP.div.withConfig({displayName:"checkbox__CheckboxOption",componentId:"sc-n0ckdw-4"})(["display:flex;flex-direction:row;align-items:center;width:246px;padding-bottom:8px;"]),h=s.ZP.span.withConfig({displayName:"checkbox__CheckboxSpan",componentId:"sc-n0ckdw-5"})(["margin-left:5;cursor:pointer;"])},81461:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var r=n(19521),i=n(67294),s=n(45697),o=n.n(s),a=n(56069),l=n(45536),c=n(63990),u=n(98505),d=n(92814),h=n(51436),p=n(59375);const m=r.ZP.div.withConfig({displayName:"building-explorer__BuildingExplorerContainer",componentId:"sc-10f196y-0"})(["height:",";overflow:auto;align-items:flex-start;position:absolute;top:140px;display:flex;flex-direction:column;background:#0e111a;border-radius:8px;padding-top:4px;@media (max-width:768px){top:63px;width:100%;border-radius:0;}"],(e=>e.isShown?"450px":"40px")),f=r.ZP.div.withConfig({displayName:"building-explorer__BuildingExplorerSublayers",componentId:"sc-10f196y-1"})(["display:flex;flex-direction:column;"]),A=r.ZP.div.withConfig({displayName:"building-explorer__CollapseContainer",componentId:"sc-10f196y-2"})(["margin-right:5px;cursor:pointer;"]),g=r.ZP.div.withConfig({displayName:"building-explorer__CheckboxContainer",componentId:"sc-10f196y-3"})([""," "," margin-left:10px;"],c.Il,c.Zx),B=r.ZP.h3.withConfig({displayName:"building-explorer__Label",componentId:"sc-10f196y-4"})(["margin:0 16px 8px 16px;cursor:pointer;color:white;font-weight:normal;"]),C={sublayers:o().array,onToggleBuildingExplorer:o().func,isShown:o().bool};class b extends i.PureComponent{constructor(e){super(e),this.state={updateCounter:0},this._setChild=this._setChild.bind(this),this._setChildren=this._setChildren.bind(this),this._toggleSublayer=this._toggleSublayer.bind(this),this._renderSublayers=this._renderSublayers.bind(this)}_setChild(e,t){const{onUpdateSublayerVisibility:n}=this.props;e.visibility=t,n(e),this._setChildren(e.sublayers,t)}_setChildren(e,t){if(e)for(const n of e)this._setChild(n,t)}_toggleSublayer(e){const{onUpdateSublayerVisibility:t}=this.props;e.visibility=!e.visibility,t(e),this._setChildren(e.sublayers,e.visibility),this.setState({updateCounter:this.state.updateCounter+1})}_toggleGroup(e){e.expanded=!e.expanded,this.setState({updateCounter:this.state.updateCounter+1})}_renderSublayers(e){return e.map((e=>{const t=e.sublayers||[];let n=h.diR,r="xs";return e.sublayers&&(r="lg",n=e.expanded?h.gc2:h.yOZ),i.createElement(g,{key:e.id},i.createElement(u.eM,null,i.createElement(A,null,i.createElement(d.G,{icon:n,onClick:()=>this._toggleGroup(e),size:r})),i.createElement("label",null,i.createElement(u.XZ,{id:"CheckBox"+e.id,value:e.visibility,checked:e.visibility,onChange:()=>this._toggleSublayer(e)}),i.createElement(u.bH,null,e.name))),e.expanded?this._renderSublayers(t):null)}))}render(){const{sublayers:e,onToggleBuildingExplorer:t,isShown:n}=this.props;return i.createElement(m,{isShown:n},i.createElement(u.eM,{style:{marginRight:"16px",paddingBottom:0}},i.createElement(B,{htmlFor:"BuildingExplorerToggle"},"BuildingExplorer"),i.createElement(p.Z,{id:"BuildingExplorerToggle",value:n,checked:n,onChange:()=>{t&&t(!n)}})),n?i.createElement(f,null,this._renderSublayers(e)):null)}}b.propTypes=C,b.defaultProps={sublayers:[],isShown:!1};const _=r.ZP.div.withConfig({displayName:"control-panel__Container",componentId:"sc-1xdzghl-0"})([""," width:277px;height:132px;margin:10px;line-height:28px;background:#0e111a;border-radius:8px;z-index:15;top:",";@media (max-width:768px){width:100vw;margin:0;top:0;border-radius:0;flex-direction:row;height:80px;}"],c.kC,(e=>e.debugMode?"50px":"0")),y=r.ZP.select.withConfig({displayName:"control-panel__TilesetDropDown",componentId:"sc-1xdzghl-1"})([""," "," "," width:245px;margin:16px 16px 0 16px;@media (max-width:768px){margin:25px 0 25px 15px;width:100%;}"],c.Il,c.Zx,c.GK),E=r.ZP.div.withConfig({displayName:"control-panel__MapContainer",componentId:"sc-1xdzghl-2"})(["display:flex;flex-direction:row;align-items:center;padding:0px;margin:0 16px 8px 16px;width:245px;"]),T=r.ZP.h3.withConfig({displayName:"control-panel__MapName",componentId:"sc-1xdzghl-3"})([""," font-weight:normal;width:70px;margin-bottom:0;@media (max-width:768px){display:none;}"],c.Il),S=r.ZP.h3.withConfig({displayName:"control-panel__ItemName",componentId:"sc-1xdzghl-4"})([""," margin:0;font-weight:normal;@media (max-width:768px){display:none;}"],c.Il),M=r.ZP.select.withConfig({displayName:"control-panel__DropDown",componentId:"sc-1xdzghl-5"})([""," "," "," width:167px;margin-left:8px;left:86px;@media (max-width:768px){width:100%;margin:25px 0 25px 5px;}"],c.Il,c.Zx,c.GK),D={name:o().string,selectedMapStyle:o().string,mapStyles:o().object,debugMode:o().bool,useTerrainLayer:o().bool,sublayers:o().array,isBuildingExplorerShown:o().bool,onExampleChange:o().func,onMapStyleChange:o().func,onToggleBuildingExplorer:o().func,setMemoryVisibility:o().func,toggleTerrain:o().func},x="Custom example";class v extends i.PureComponent{constructor(e){super(e),this._renderMapStyles=this._renderMapStyles.bind(this)}_renderExamples(){const{name:e,onExampleChange:t}=this.props,n=e||x;return i.createElement(y,{value:n,onChange:e=>{const n=e.target.value;this.setState({selected:n}),t(a.Q[n])}},!e&&i.createElement("option",{key:"custom-example",value:"custom-example"},x),Object.keys(a.Q).map((e=>{const t=a.Q[e];return i.createElement("option",{key:e,value:t.name},t.name)})))}_renderMapStyles(){const{mapStyles:e=l.MK,selectedMapStyle:t,onMapStyleChange:n}=this.props;return i.createElement(E,null,i.createElement(T,null,"Base map"),i.createElement(M,{value:t,onChange:e=>n({selectedMapStyle:e.target.value})},Object.keys(e).map((t=>i.createElement("option",{key:t,value:e[t]},t)))))}_renderTerrainControl(){const{useTerrainLayer:e,toggleTerrain:t}=this.props;return i.createElement(E,null,i.createElement(S,null,"Terrain"),i.createElement(p.Z,{value:e,checked:e,onChange:()=>{t({useTerrainLayer:!e})}}))}render(){const{debugMode:e,sublayers:t,onToggleBuildingExplorer:n,onUpdateSublayerVisibility:r,isBuildingExplorerShown:s}=this.props;return i.createElement(_,{debugMode:e},this._renderExamples(),this._renderMapStyles(),this._renderTerrainControl(),null!=t&&t.length?i.createElement(b,{sublayers:t,onToggleBuildingExplorer:n,onUpdateSublayerVisibility:r,isShown:s}):null)}}v.propTypes=D,v.defaultProps={name:"",debugMode:!1,isBuildingExplorerShown:!1,sublayers:[],useTerrainLayer:!1,toggleTerrain:()=>{}}},63990:(e,t,n)=>{"use strict";n.d(t,{GK:()=>r,Il:()=>o,Zx:()=>i,kC:()=>s});const r="\n  position: static;\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n  padding: 4px 16px;\n  height: 28px;\n  cursor: pointer;\n  border-radius: 4px;\n  box-sizing: border-box;\n    option {\n      color: white;\n      background: #0E111A;\n      display: flex;\n      white-space: pre;\n      min-height: 20px;\n      padding: 0px 2px 1px;\n    }\n  &:hover {\n    background: #4F52CC;\n    color: black;\n  }\n",i="\n  font-family: 'Uber Move' sans-serif;\n  font-size: 16px;\n  font-style: normal;\n  font-weight: 500;\n  line-height: 19px;\n  letter-spacing: 0em;\n  text-align: left;\n",s="\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  position: absolute;\n",o="\n  background: #0E111A;\n  color: white;\n"},59375:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(67294),i=n(19521);const s=i.ZP.input.withConfig({displayName:"toggle-switch__Input",componentId:"sc-1l103gi-0"})(["height:0;width:0;opacity:0;z-index:-1;"]),o=i.ZP.label.withConfig({displayName:"toggle-switch__Label",componentId:"sc-1l103gi-1"})(["position:absolute;margin-left:220px;margin-bottom:2px;font-size:6px;width:28px;height:18px;border-radius:8px;cursor:",";","{opacity:0;width:0;height:0;}"],(e=>e.disabled?"not-allowed":"pointer"),s),a=i.ZP.span.withConfig({displayName:"toggle-switch__Slider",componentId:"sc-1l103gi-2"})(["position:absolute;cursor:pointer;top:1px;left:0;right:0;bottom:0;background-color:rgba(250,250,250,0.2);transition:0.4s;border-radius:8px;&::after{color:white;}&::before{position:absolute;top:2px;left:2px;content:'';width:13px;height:13px;background-color:#ffffff;transition:0.4s;border-radius:8px;}",":checked + &{background:#4f52cc;}",":checked + &::before{-webkit-transform:translateX(11px);-ms-transform:translateX(11px);transform:translateX(11px);}"],s,s);function l(e){let{checked:t,onChange:n,name:i,id:l,title:c}=e;return r.createElement(o,{htmlFor:l,title:c},r.createElement(s,{id:l,type:"checkbox",name:i,checked:t,onChange:n,title:c}),r.createElement(a,null))}},45536:(e,t,n)=>{"use strict";n.d(t,{BB:()=>A,Bu:()=>a,I4:()=>f,IO:()=>g,L2:()=>d,MK:()=>i,NR:()=>u,Vk:()=>c,ih:()=>s,ls:()=>h,mp:()=>l,oZ:()=>o});var r=n(79852);const i={Light:"https://basemaps.cartocdn.com/gl/positron-nolabels-gl-style/style.json",Dark:"https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json"},s=i.Dark,o={Original:r.Yn.ORIGINAL,"Random by tile":r.Yn.RANDOM,"By depth":r.Yn.DEPTH,"User selected":r.Yn.CUSTOM},a=r.Yn.ORIGINAL,l={White:r.Yn.ORIGINAL,"By tile":r.Yn.TILE},c=r.Yn.ORIGINAL,u="boundingVolume",d="lod",h="parentLod",p="Bounding Sphere",m="Oriented Bounding Box",f={MBS:p,OBB:m},A={[p]:"sphereMesh",[m]:"cubeMesh"},g=f.MBS},56069:(e,t,n)=>{"use strict";n.d(t,{Q:()=>s,u:()=>i});const r={height:600,width:800,pitch:45,maxPitch:60,bearing:0,minZoom:2,maxZoom:30,zoom:14.5},i="San Francisco v1.7",s={"San Francisco v1.6":{name:"San Francisco v1.6",url:"https://tiles.arcgis.com/tiles/z2tnIkrLQ2BRzr6P/arcgis/rest/services/SanFrancisco_Bldgs/SceneServer/layers/0",viewport:{...r,longitude:-120,latitude:34}},"San Francisco v1.7":{name:"San Francisco v1.7",url:"https://tiles.arcgis.com/tiles/z2tnIkrLQ2BRzr6P/arcgis/rest/services/SanFrancisco_3DObjects_1_7/SceneServer/layers/0",viewport:{...r,longitude:-120,latitude:34}},"New York":{name:"New York",url:"https://tiles.arcgis.com/tiles/P3ePLMYs2RVChkJx/arcgis/rest/services/Buildings_NewYork_17/SceneServer/layers/0",viewport:{...r,longitude:-74,latitude:40}},Building:{name:"Building",url:"https://tiles.arcgis.com/tiles/z2tnIkrLQ2BRzr6P/arcgis/rest/services/Admin_Building_v17/SceneServer/layers/0",viewport:{...r}}}},49045:(e,t,n)=>{"use strict";n.d(t,{D:()=>s,P:()=>i});var r=n(23881);function i(e){return new r.Z({id:e})}function s(e,t){t.reset();for(const n of e)n.stats.forEach((e=>{t.get(e.name).addCount(e.count)}))}},61182:(e,t,n)=>{"use strict";function r(e){return i(e.find((e=>"FullModel"===e.modelName)))}function i(e){var t;const n={...e,sublayers:void 0};if(n.expanded=!1,null!=(t=e.sublayers)&&t.length){const{childNodesCount:t,sublayersCopy:r}=function(e){const t=[];let n=0;for(const r of e){const e=i(r);e&&(t.push(e),n+=e.childNodesCount+1)}return{childNodesCount:n,sublayersCopy:t}}(e.sublayers);n.sublayers=r,n.childNodesCount=t}else if(n.childNodesCount=0,"group"===e.layerType)return null;return n}n.d(t,{$:()=>r})},47208:(e,t,n)=>{"use strict";function r(e,t,n){let r=null;for(const i of Object.values(n)){const{bbox:{east:n,north:s,south:o,west:a}}=i;e>a&&e<n&&t>o&&t<s&&(r=i)}if(!r)return null;const{content:[{attributes:{POSITION:{value:s}}}]}=r;let o=s[2]||0,a=i(e,t,s[0],s[1]);for(let l=3;l<s.length;l+=3){const n=i(e,t,s[l],s[l+1]);n<a&&(o=s[l+2],a=n)}return o}function i(e,t,n,r){const i=n-e,s=r-t;return Math.sqrt(i*i+s*s)}n.d(t,{a:()=>r})},79852:(e,t,n)=>{"use strict";n.d(t,{Y4:()=>c,Yn:()=>r,ZP:()=>a,aR:()=>l});const r={ORIGINAL:0,RANDOM:1,DEPTH:2,CUSTOM:3,TILE:4},i={1:[72,149,239],2:[67,97,238],3:[72,12,168],4:[86,11,173],5:[114,9,183],6:[181,23,158],7:[247,37,133],8:[236,125,16],9:[255,188,10],10:[251,86,7],11:[255,190,11],12:[255,255,0]},s=[255,255,255],o=[0,100,255];class a{constructor(){this.state={randomColorMap:{},colorMap:{}}}getColor(e,t){switch(t.coloredBy){case r.RANDOM:return this._getRandomColor(e.id);case r.DEPTH:return this._getColorByDepth(e.id,e.depth);case r.TILE:return this._getColorByTile(e.id);case r.CUSTOM:return this._getCustomColor(e.id,t);default:return s}}_getColorByTile(e){const{colorMap:t}=this.state;return t[e]||s}_getColorByDepth(e,t){const{colorMap:n}=this.state;return n[e]=i[t]||i[12],n[e]}_getCustomColor(e,t){const{colorMap:n}=this.state;let r=s;return t.coloredTilesMap&&t.coloredTilesMap[e]?r=t.coloredTilesMap[e]:t.selectedTileId===e&&(r=o),n[e]=r,r}_getRandomColor(e){const{colorMap:t,randomColorMap:n}=this.state;const r=[Math.round(255*Math.random()),205,Math.round(255*Math.random())];return n[e]=n[e]||r,t[e]=n[e],t[e]}}function l(e){const{r:t,g:n,b:r}=e.rgb;return[t,n,r]}function c(e){return e?{r:e[0],g:e[1],b:e[2]}:{r:o[0],g:o[1],b:o[2]}}},52093:(e,t,n)=>{"use strict";function r(){return new URL(window.location.href).searchParams.get("url")}function i(e,t){const n=new URL(e);let r=t&&t.token;const i=function(e){const t=e.pathname.match(/layers\/\d/);if(t)return e.href.replace(/\/+$/,"");const n=e.pathname.replace(/\/?$/,"/").concat("layers/0");return""+e.origin+n+e.search}(n),s=i.lastIndexOf("/layers/0");let o=i.substring(0,s);return n.search&&(r=n.searchParams.get("token"),o=""+o+n.search),{...t,tilesetUrl:i,token:r,metadataUrl:o}}n.d(t,{t:()=>i,u:()=>r})},745:(e,t,n)=>{"use strict";n.d(t,{D0:()=>l,Ew:()=>c,Kn:()=>s,Lj:()=>u,Os:()=>h,Ss:()=>o,TW:()=>a,zH:()=>d});const r=e=>"boolean"==typeof e,i=e=>"function"==typeof e,s=e=>null!==e&&"object"==typeof e,o=e=>s(e)&&e.constructor==={}.constructor,a=e=>e&&"function"==typeof e[Symbol.iterator],l=e=>e&&"function"==typeof e[Symbol.asyncIterator],c=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,u=e=>"undefined"!=typeof Blob&&e instanceof Blob,d=e=>e&&"object"==typeof e&&e.isBuffer,h=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||s(e)&&i(e.tee)&&i(e.cancel)&&i(e.getReader))(e)||(e=>s(e)&&i(e.read)&&i(e.pipe)&&r(e.readable))(e)},37258:(e,t,n)=>{"use strict";n.d(t,{z:()=>a});var r=n(745),i=n(35163),s=n(89752),o=n(93865);async function a(e,t,n,a){Array.isArray(t)||(0,i.C)(t)||(void 0,n=t,t=void 0);const l=(0,s.b)(n);let c=e;return"string"==typeof e&&(c=await l(e)),(0,r.Lj)(e)&&(c=await l(e)),await(0,o.Q)(c,t,n)}},93865:(e,t,n)=>{"use strict";n.d(t,{Q:()=>D});var r=n(96040),i=n(57254),s=n(96013),o=n(13842),a=n(9164);async function l(e,t,n,r,i){const s=e.id,l=(0,a.j)(e,n),u=o.Z.getWorkerFarm(n).getWorkerPool({name:s,url:l});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const d=await u.startJob("process-on-worker",c.bind(null,i));d.postMessage("process",{input:t,options:n,context:r});const h=await d.result;return await h.result}async function c(e,t,n,r){switch(n){case"done":t.done(r);break;case"error":t.error(new Error(r.error));break;case"process":const{id:s,input:o,options:a}=r;try{const n=await e(o,a);t.postMessage("done",{id:s,result:n})}catch(i){const e=i instanceof Error?i.message:"unknown error";t.postMessage("error",{id:s,error:e})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}var u=n(35163),d=n(745),h=n(48657),p=n(25735);const m=262144;const f=262144;const A=1048576;var g=n(39579);function B(e){if((t=e)&&"object"==typeof t&&t.isBuffer)return e;var t;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function C(e,t){return g.jU?async function*(e,t){const n=e.getReader();let r;try{for(;;){const e=r||n.read();null!=t&&t._streamReadAhead&&(r=n.read());const{done:i,value:s}=await e;if(i)return;yield B(s)}}catch(i){n.releaseLock()}}(e,t):async function*(e,t){for await(const n of e)yield B(n)}(e)}function b(e,t){if("string"==typeof e)return function*(e,t){const n=(null==t?void 0:t.chunkSize)||m;let r=0;const i=new TextEncoder;for(;r<e.length;){const t=Math.min(e.length-r,n),s=e.slice(r,r+t);r+=t,yield i.encode(s)}}(e,t);if(e instanceof ArrayBuffer)return function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{chunkSize:n=f}=t;let r=0;for(;r<e.byteLength;){const t=Math.min(e.byteLength-r,n),i=new ArrayBuffer(t),s=new Uint8Array(e,r,t);new Uint8Array(i).set(s),r+=t,yield i}}(e,t);if((0,d.Lj)(e))return async function*(e,t){const n=(null==t?void 0:t.chunkSize)||A;let r=0;for(;r<e.size;){const t=r+n,i=await e.slice(r,t).arrayBuffer();r=t,yield i}}(e,t);if((0,d.Os)(e))return C(e,t);if((0,d.Ew)(e)){return C(e.body,t)}throw new Error("makeIterator")}var _=n(78741);const y="Cannot convert supplied data type";async function E(e,t,n){const r=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||r)return function(e,t,n){if(t.text&&"string"==typeof e)return e;if((0,d.zH)(e)&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const r=e.byteLength||e.length;return 0===e.byteOffset&&r===n.byteLength||(n=n.slice(e.byteOffset,e.byteOffset+r)),n}throw new Error(y)}(e,t);if((0,d.Lj)(e)&&(e=await(0,_.L1)(e)),(0,d.Ew)(e)){const n=e;return await(0,_.mm)(n),t.binary?await n.arrayBuffer():await n.text()}if((0,d.Os)(e)&&(e=b(e,n)),(0,d.TW)(e)||(0,d.D0)(e))return(0,p.GZ)(e);throw new Error(y)}var T=n(89752);var S=n(97949),M=n(86539);async function D(e,t,n,a){(0,r.h)(!a||"object"==typeof a),!t||Array.isArray(t)||(0,u.C)(t)||(a=void 0,n=t,t=void 0),e=await e,n=n||{};const{url:c}=(0,S.l)(e),p=function(e,t){if(!t&&e&&!Array.isArray(e))return e;let n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[...n,...e]:e}return n&&n.length?n:null}(t,a),m=await(0,M.A)(e,p,n);return m?(a=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(n)return n;const r={fetch:(0,T.b)(t,e),...e};return Array.isArray(r.loaders)||(r.loaders=null),r}({url:c,parse:D,loaders:p},n=(0,h.GR)(n,m,p,c),a),await async function(e,t,n,a){if((0,i.z)(e),(0,d.Ew)(t)){const e=t,{ok:n,redirected:r,status:i,statusText:s,type:o,url:l}=e,c=Object.fromEntries(e.headers.entries());a.response={headers:c,ok:n,redirected:r,status:i,statusText:s,type:o,url:l}}if(t=await E(t,e,n),e.parseTextSync&&"string"==typeof t)return n.dataType="text",e.parseTextSync(t,n,a,e);if(function(e,t){return!!o.Z.isSupported()&&!!(s.jU||null!=t&&t._nodeWorkers)&&e.worker&&(null==t?void 0:t.worker)}(e,n))return await l(e,t,n,a,D);if(e.parseText&&"string"==typeof t)return await e.parseText(t,n,a,e);if(e.parse)return await e.parse(t,n,a,e);throw(0,r.h)(!e.parseSync),new Error("".concat(e.id," loader - no parser found and worker is disabled"))}(m,e,n,a)):null}},99121:(e,t,n)=>{"use strict";n.d(t,{fh:()=>o,kO:()=>a});var r=n(35163),i=n(48657);const s=()=>{const e=(0,i.rx)();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function o(e){const t=s();e=Array.isArray(e)?e:[e];for(const n of e){const e=(0,r.T)(n);t.find((t=>e===t))||t.unshift(e)}}function a(){return s()}},86539:(e,t,n)=>{"use strict";n.d(t,{A:()=>d});var r=n(59645),i=n(2482),s=n(35163);const o=new(n(56426).Z)({id:"loaders.gl"});var a=n(97949),l=n(99121),c=n(745);const u=/\.([^.]+)$/;async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!p(e))return null;let i=h(e,t,{...n,nothrow:!0},r);if(i)return i;if((0,c.Lj)(e)&&(i=h(e=await e.slice(0,10).arrayBuffer(),t,n,r)),!(i||null!=n&&n.nothrow))throw new Error(m(e));return i}function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!p(e))return null;if(t&&!Array.isArray(t))return(0,s.T)(t);let i=[];t&&(i=i.concat(t)),null!=n&&n.ignoreRegisteredLoaders||i.push(...(0,l.kO)()),function(e){for(const t of e)(0,s.T)(t)}(i);const c=function(e,t,n,r){const{url:i,type:s}=(0,a.l)(e),l=i||(null==r?void 0:r.url);let c=null,d="";null!=n&&n.mimeType&&(c=f(t,null==n?void 0:n.mimeType),d="match forced by supplied MIME type ".concat(null==n?void 0:n.mimeType));var h;c=c||function(e,t){const n=t&&u.exec(t),r=n&&n[1];return r?function(e,t){t=t.toLowerCase();for(const n of e)for(const e of n.extensions)if(e.toLowerCase()===t)return n;return null}(e,r):null}(t,l),d=d||(c?"matched url ".concat(l):""),c=c||f(t,s),d=d||(c?"matched MIME type ".concat(s):""),c=c||function(e,t){if(!t)return null;for(const n of e)if("string"==typeof t){if(A(t,n))return n}else if(ArrayBuffer.isView(t)){if(g(t.buffer,t.byteOffset,n))return n}else if(t instanceof ArrayBuffer){if(g(t,0,n))return n}return null}(t,e),d=d||(c?"matched initial data ".concat(B(e)):""),c=c||f(t,null==n?void 0:n.fallbackMimeType),d=d||(c?"matched fallback MIME type ".concat(s):""),d&&o.log(1,"selectLoader selected ".concat(null===(h=c)||void 0===h?void 0:h.name,": ").concat(d,"."));return c}(e,i,n,r);if(!(c||null!=n&&n.nothrow))throw new Error(m(e));return c}function p(e){return!(e instanceof Response&&204===e.status)}function m(e){const{url:t,type:n}=(0,a.l)(e);let i="No valid loader found (";i+=t?"".concat(r.vB(t),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const s=e?B(e):"";return i+=s?' first bytes: "'.concat(s,'"'):"first bytes: not available",i+=")",i}function f(e,t){for(const n of e){if(n.mimeTypes&&n.mimeTypes.includes(t))return n;if(t==="application/x.".concat(n.id))return n}return null}function A(e,t){if(t.testText)return t.testText(e);return(Array.isArray(t.tests)?t.tests:[t.tests]).some((t=>e.startsWith(t)))}function g(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some((r=>function(e,t,n,r){if(r instanceof ArrayBuffer)return(0,i.Xq)(r,e,r.byteLength);switch(typeof r){case"function":return r(e,n);case"string":return r===C(e,t,r.length);default:return!1}}(e,t,n,r)))}function B(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return C(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){return C(e,0,t)}return""}function C(e,t,n){if(e.byteLength<t+n)return"";const r=new DataView(e);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(t+s));return i}},8551:(e,t,n)=>{"use strict";n.d(t,{d:()=>s});var r=n(96351),i=n(78741);async function s(e,t){if("string"==typeof e){e=(0,r.i3)(e);let n=t;return null!=t&&t.fetch&&"function"!=typeof(null==t?void 0:t.fetch)&&(n=t.fetch),await fetch(e,n)}return await(0,i.L1)(e)}},89752:(e,t,n)=>{"use strict";n.d(t,{b:()=>o});var r=n(745),i=n(8551),s=n(48657);function o(e,t){const n=(0,s.pm)(),o=e||n;return"function"==typeof o.fetch?o.fetch:(0,r.Kn)(o.fetch)?e=>(0,i.d)(e,o):null!=t&&t.fetch?null==t?void 0:t.fetch:i.d}},35163:(e,t,n)=>{"use strict";n.d(t,{C:()=>i,T:()=>s});var r=n(73613);function i(e){var t;if(!e)return!1;Array.isArray(e)&&(e=e[0]);return Array.isArray(null===(t=e)||void 0===t?void 0:t.extensions)}function s(e){var t,n;let s;return(0,r.h)(e,"null loader"),(0,r.h)(i(e),"invalid loader"),Array.isArray(e)&&(s=e[1],e=e[0],e={...e,options:{...e.options,...s}}),(null!==(t=e)&&void 0!==t&&t.parseTextSync||null!==(n=e)&&void 0!==n&&n.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}},48657:(e,t,n)=>{"use strict";n.d(t,{pm:()=>d,rx:()=>u,GR:()=>h});var r=n(745),i=n(81180);const s=new(n(56426).Z)({id:"loaders.gl"});class o{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}var a=n(39579);const l={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){(0,i.Z)(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.console.error.bind(this.console,...t)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:a.jU,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},c={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function u(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state=e._state||{},e._state}const d=()=>{const e=u();return e.globalOptions=e.globalOptions||{...l},e.globalOptions};function h(e,t,n,r){return n=n||[],function(e,t){p(e,null,l,c,t);for(const n of t){const r=e&&e[n.id]||{},i=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};p(r,n.id,i,s,t)}}(e,n=Array.isArray(n)?n:[n]),f(t,e,r)}function p(e,t,n,i,o){const a=t||"Top level",l=t?"".concat(t,"."):"";for(const c in e){const u=!t&&(0,r.Kn)(e[c]);if(!(c in n)&&!("baseUri"===c&&!t)&&!("workerUrl"===c&&t))if(c in i)s.warn("".concat(a," loader option '").concat(l).concat(c,"' no longer supported, use '").concat(i[c],"'"))();else if(!u){const e=m(c,o);s.warn("".concat(a," loader option '").concat(l).concat(c,"' not recognized. ").concat(e))()}}}function m(e,t){const n=e.toLowerCase();let r="";for(const i of t)for(const t in i.options){if(e===t)return"Did you mean '".concat(i.id,".").concat(t,"'?");const s=t.toLowerCase();(n.startsWith(s)||s.startsWith(n))&&(r=r||"Did you mean '".concat(i.id,".").concat(t,"'?"))}return r}function f(e,t,n){const r={...e.options||{}};return function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}(r,n),null===r.log&&(r.log=new o),A(r,d()),A(r,t),r}function A(e,t){for(const n in t)if(n in t){const i=t[n];(0,r.Ss)(i)&&(0,r.Ss)(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n]}}},97949:(e,t,n)=>{"use strict";n.d(t,{C:()=>u,l:()=>c});var r=n(745);const i=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,s=/^([-\w.]+\/[-\w.+]+)/;function o(e){const t=s.exec(e);return t?t[1]:e}function a(e){const t=i.exec(e);return t?t[1]:""}const l=/\?.*/;function c(e){if((0,r.Ew)(e)){const t=d(e.url||"");return{url:t,type:o(e.headers.get("content-type")||"")||a(t)}}return(0,r.Lj)(e)?{url:d(e.name||""),type:e.type||""}:"string"==typeof e?{url:d(e),type:a(e)}:{url:"",type:""}}function u(e){return(0,r.Ew)(e)?e.headers["content-length"]||-1:(0,r.Lj)(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}function d(e){return e.replace(l,"")}},78741:(e,t,n)=>{"use strict";n.d(t,{L1:()=>s,mm:()=>o});var r=n(745),i=n(97949);async function s(e){if((0,r.Ew)(e))return e;const t={},n=(0,i.C)(e);n>=0&&(t["content-length"]=String(n));const{url:s,type:o}=(0,i.l)(e);o&&(t["content-type"]=o);const a=await async function(e){const t=5;if("string"==typeof e)return"data:,".concat(e.slice(0,t));if(e instanceof Blob){const t=e.slice(0,5);return await new Promise((e=>{const n=new FileReader;n.onload=t=>{var n;return e(null==t||null===(n=t.target)||void 0===n?void 0:n.result)},n.readAsDataURL(t)}))}if(e instanceof ArrayBuffer){const n=function(e){let t="";const n=new Uint8Array(e);for(let r=0;r<n.byteLength;r++)t+=String.fromCharCode(n[r]);return btoa(t)}(e.slice(0,t));return"data:base64,".concat(n)}return null}(e);a&&(t["x-first-bytes"]=a),"string"==typeof e&&(e=(new TextEncoder).encode(e));const l=new Response(e,{headers:t});return Object.defineProperty(l,"url",{value:s}),l}async function o(e){if(!e.ok){const t=await async function(e){let t="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): ");try{const n=e.headers.get("Content-Type");let r=e.statusText;n.includes("application/json")&&(r+=" ".concat(await e.text())),t+=r,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch(n){}return t}(e);throw new Error(t)}}},64995:(e,t,n)=>{"use strict";n.d(t,{VJ:()=>T});var r=n(96013);const i="3.4.0-alpha.2",s={draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},o={name:"Draco",id:r.jU?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:i,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:s};var a=n(81180),l=n(61569),c=n(78354),u=n(48347);function d(e,t,n){const r=p(t.metadata),i=[],s=function(e){const t={};for(const n in e){const r=e[n];t[r.name||"undefined"]=r}return t}(t.attributes);for(const o in e){const t=h(o,e[o],s[o]);i.push(t)}if(n){const e=h("indices",n);i.push(e)}return new u.Z(i,r)}function h(e,t,n){const r=n?p(n.metadata):void 0;return(0,c.ou)(e,t,r)}function p(e){const t=new Map;for(const n in e)t.set("".concat(n,".string"),JSON.stringify(e[n]));return t}const m={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},f={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class A{constructor(e){(0,a.Z)(this,"draco",void 0),(0,a.Z)(this,"decoder",void 0),(0,a.Z)(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const r=this.decoder.GetEncodedGeometryType(n),i=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let e;switch(r){case this.draco.TRIANGULAR_MESH:e=this.decoder.DecodeBufferToMesh(n,i);break;case this.draco.POINT_CLOUD:e=this.decoder.DecodeBufferToPointCloud(n,i);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!e.ok()||!i.ptr){const t="DRACO decompression failed: ".concat(e.error_msg());throw new Error(t)}const s=this._getDracoLoaderData(i,r,t),o=this._getMeshData(i,s,t),a=(0,l.v)(o.attributes),c=d(o.attributes,s,o.indices);return{loader:"draco",loaderData:s,header:{vertexCount:i.num_points(),boundingBox:a},...o,schema:c}}finally{this.draco.destroy(n),i&&this.draco.destroy(i)}}_getDracoLoaderData(e,t,n){const r=this._getTopLevelMetadata(e),i=this._getDracoAttributes(e,n);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:r,attributes:i}}_getDracoAttributes(e,t){const n={};for(let r=0;r<e.num_attributes();r++){const i=this.decoder.GetAttribute(e,r),s=this._getAttributeMetadata(e,r);n[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:r,metadata:s};const o=this._getQuantizationTransform(i,t);o&&(n[i.unique_id()].quantization_transform=o);const a=this._getOctahedronTransform(i,t);a&&(n[i.unique_id()].octahedron_transform=a)}return n}_getMeshData(e,t,n){const r=this._getMeshAttributes(t,e,n);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");return e instanceof this.draco.Mesh?"triangle-strip"===n.topology?{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(e),size:1}}:{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(e),size:1}}:{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(e,t,n){const r={};for(const i of Object.values(e.attributes)){const e=this._deduceAttributeName(i,n);i.name=e;const{value:s,size:o}=this._getAttributeValues(t,i);r[e]={value:s,size:o,byteOffset:i.byte_offset,byteStride:i.byte_stride,normalized:i.normalized}}return r}_getTriangleListIndices(e){const t=3*e.num_faces(),n=4*t,r=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(e,n,r),new Uint32Array(this.draco.HEAPF32.buffer,r,t).slice()}finally{this.draco._free(r)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),function(e){const t=e.size(),n=new Int32Array(t);for(let r=0;r<t;r++)n[r]=e.GetValue(r);return n}(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const n=f[t.data_type],r=t.num_components,i=e.num_points()*r,s=i*n.BYTES_PER_ELEMENT,o=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}(this.draco,n);let a;const l=this.draco._malloc(s);try{const r=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,r,o,s,l),a=new n(this.draco.HEAPF32.buffer,l,i).slice()}finally{this.draco._free(l)}return{value:a,size:r}}_deduceAttributeName(e,t){const n=e.unique_id;for(const[s,o]of Object.entries(t.extraAttributes||{}))if(o===n)return s;const r=e.attribute_type;for(const s in m){if(this.draco[s]===r)return m[s]}const i=t.attributeNameEntry||"name";return e.metadata[i]?e.metadata[i].string:"CUSTOM_ATTRIBUTE_".concat(n)}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const n=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(n)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},n=this.metadataQuerier.NumEntries(e);for(let r=0;r<n;r++){const n=this.metadataQuerier.GetEntryName(e,r);t[n]=this._getDracoMetadataField(e,n)}return t}_getDracoMetadataField(e,t){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,n);const r=function(e){const t=e.size(),n=new Int32Array(t);for(let r=0;r<t;r++)n[r]=e.GetValue(r);return n}(n);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:r}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:n=[]}=e,r=[...t,...n];for(const i of r)this.decoder.SkipAttributeTransform(this.draco[i])}_getQuantizationTransform(e,t){const{quantizedAttributes:n=[]}=t,r=e.attribute_type();if(n.map((e=>this.decoder[e])).includes(r)){const t=new this.draco.AttributeQuantizationTransform;try{if(t.InitFromAttribute(e))return{quantization_bits:t.quantization_bits(),range:t.range(),min_values:new Float32Array([1,2,3]).map((e=>t.min_value(e)))}}finally{this.draco.destroy(t)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:n=[]}=t,r=e.attribute_type();if(n.map((e=>this.decoder[e])).includes(r)){const t=new this.draco.AttributeQuantizationTransform;try{if(t.InitFromAttribute(e))return{quantization_bits:t.quantization_bits()}}finally{this.draco.destroy(t)}}return null}}var g=n(96706);const B="https://www.gstatic.com/draco/versioned/decoders/".concat("1.5.5"),C="".concat(B,"/draco_decoder.js"),b="".concat(B,"/draco_wasm_wrapper.js"),_="".concat(B,"/draco_decoder.wasm");"https://raw.githubusercontent.com/google/draco/".concat("1.4.1","/javascript/draco_encoder.js");let y;async function E(e){const t=e.modules||{};return y=t.draco3d?y||t.draco3d.createDecoderModule({}).then((e=>({draco:e}))):y||async function(e){let t,n;if("js"===(e.draco&&e.draco.decoderType))t=await(0,g.Y)(C,"draco",e);else[t,n]=await Promise.all([await(0,g.Y)(b,"draco",e),await(0,g.Y)(_,"draco",e)]);return t=t||globalThis.DracoDecoderModule,await function(e,t){const n={};t&&(n.wasmBinary=t);return new Promise((t=>{e({...n,onModuleLoaded:e=>t({draco:e})})}))}(t,n)}(e),await y}r.jU;const T={...o,parse:async function(e,t){const{draco:n}=await E(t),r=new A(n);try{return r.parseSync(e,null==t?void 0:t.draco)}finally{r.destroy()}}}},5016:(e,t,n)=>{"use strict";n.d(t,{E:()=>Tt});var r={};n.r(r),n.d(r,{decode:()=>Q,name:()=>X});var i={};n.r(i),n.d(i,{name:()=>te,preprocess:()=>ne});var s={};n.r(s),n.d(s,{name:()=>ie,preprocess:()=>se});var o={};n.r(o),n.d(o,{decode:()=>de,encode:()=>he,name:()=>ce,preprocess:()=>ue});var a={};n.r(a),n.d(a,{decode:()=>Se,name:()=>_e});var l={};n.r(l),n.d(l,{decode:()=>Re,encode:()=>Ie,name:()=>we});var c={};n.r(c),n.d(c,{decode:()=>Oe,encode:()=>Pe,name:()=>Fe});var u={};n.r(u),n.d(u,{decode:()=>Le,encode:()=>Je,name:()=>Ue});var d={};n.r(d),n.d(d,{decode:()=>Ke,name:()=>Ve});var h=n(4214),p=n(1975),m=n(87391);function f(e,t,n){if(e.byteLength<=t+n)return"";const r=new DataView(e);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(t+s));return i}function A(e){try{return JSON.parse(e)}catch(t){throw new Error('Failed to parse JSON from data starting with "'.concat(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return f(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer)return f(e,0,t);return""}(e),'"'))}}var g=n(2482);function B(e,t){if(!e)throw new Error(t||"assert failed: gltf")}function C(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const n=t.baseUri||t.uri;if(!n)throw new Error("'baseUri' must be provided to resolve relative url ".concat(e));return n.substr(0,n.lastIndexOf("/")+1)+e}function b(e,t,n){const r=e.bufferViews[n];B(r);const i=t[r.buffer];B(i);const s=(r.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,s,r.byteLength)}var _=n(81180),y=n(46936),E=n(73613);function T(e,t){return(0,E.h)(e>=0),(0,E.h)(t>0),e+(t-1)&~(t-1)}function S(e,t,n){let r;if(e instanceof ArrayBuffer)r=new Uint8Array(e);else{const t=e.byteOffset,n=e.byteLength;r=new Uint8Array(e.buffer||e.arrayBuffer,t,n)}return t.set(r,n),n+T(r.byteLength,4)}const M=["SCALAR","VEC2","VEC3","VEC4"],D=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],x=new Map(D),v={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},w={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},R={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function I(e){return M[e-1]||M[0]}function G(e){const t=x.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function F(e,t){const n=R[e.componentType],r=v[e.type],i=w[e.componentType],s=e.count*r,o=e.count*r*i;return B(o>=0&&o<=t.byteLength),{ArrayType:n,length:s,byteLength:o}}const O={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class P{constructor(e){(0,_.Z)(this,"gltf",void 0),(0,_.Z)(this,"sourceBuffers",void 0),(0,_.Z)(this,"byteLength",void 0),this.gltf=e||{json:{...O},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const t=this.getUsedExtensions().find((t=>t===e)),n=this.json.extensions||{};return t?n[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find((t=>t===e))?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if("object"==typeof t)return t;const n=this.json[e]&&this.json[e][t];if(!n)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(t,"]"));return n}getTypedArrayForBufferView(e){const t=(e=this.getBufferView(e)).buffer,n=this.gltf.buffers[t];B(n);const r=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,r,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,{ArrayType:r,length:i}=F(e,t);return new r(n,t.byteOffset+e.byteOffset,i)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,r=t.byteOffset||0;return new Uint8Array(n,r,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,n){return e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}setObjectExtension(e,t,n){(e.extensions||{})[t]=n}removeObjectExtension(e,t){const n=e.extensions||{},r=n[t];return delete n[t],r}addExtension(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return B(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return B(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((t=>t===e))||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((t=>t===e))||this.json.extensionsRequired.push(e)}removeExtension(e){if(!this.getExtension(e))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:n}=e;this.json.nodes=this.json.nodes||[];const r={mesh:t};return n&&(r.matrix=n),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:n,material:r,mode:i=4}=e,s={primitives:[{attributes:this._addAttributes(t),mode:i}]};if(n){const e=this._addIndices(n);s.primitives[0].indices=e}return Number.isFinite(r)&&(s.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addPointCloud(e){const t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}addImage(e,t){const n=(0,y.I)(e),r=t||(null==n?void 0:n.mimeType),i={bufferView:this.addBufferView(e),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(i),this.json.images.length-1}addBufferView(e){const t=e.byteLength;B(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const n={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=T(t,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(n),this.json.bufferViews.length-1}addAccessor(e,t){const n={bufferView:e,type:I(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{size:3};const n=this.addBufferView(e);let r={min:t.min,max:t.max};r.min&&r.max||(r=this._getAccessorMinMax(e,t.size));const i={size:t.size,componentType:G(e),count:Math.round(e.length/t.size),min:r.min,max:r.max};return this.addAccessor(n,Object.assign(i,t))}addTexture(e){const{imageIndex:t}=e,n={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,t;this.gltf.buffers=[];const n=this.byteLength,r=new ArrayBuffer(n),i=new Uint8Array(r);let s=0;for(const o of this.sourceBuffers||[])s=S(o,i,s);null!==(e=this.json)&&void 0!==e&&null!==(t=e.buffers)&&void 0!==t&&t[0]?this.json.buffers[0].byteLength=n:this.json.buffers=[{byteLength:n}],this.gltf.binary=r,this.sourceBuffers=[r]}_removeStringFromArray(e,t){let n=!0;for(;n;){const r=e.indexOf(t);r>-1?e.splice(r,1):n=!1}}_addAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={};for(const n in e){const r=e[n],i=this._getGltfAttributeName(n),s=this.addBinaryBuffer(r.value,r);t[i]=s}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const n={min:null,max:null};if(e.length<t)return n;n.min=[],n.max=[];const r=e.subarray(0,t);for(const i of r)n.min.push(i),n.max.push(i);for(let i=t;i<e.length;i+=t)for(let r=0;r<t;r++)n.min[0+r]=Math.min(n.min[0+r],e[i+r]),n.max[0+r]=Math.max(n.max[0+r],e[i+r]);return n}}const H="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",U="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",L=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),J=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),N={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Z={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};let V;async function K(){return V||(V=async function(){let e=H;WebAssembly.validate(L)&&(e=U,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;++r){const n=e.charCodeAt(r);t[r]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let n=0;for(let r=0;r<e.length;++r)t[n++]=t[r]<60?J[t[r]]:64*(t[r]-60)+t[++r];return t.buffer.slice(0,n)}(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}()),V}function j(e,t,n,r,i,s,o){const a=e.exports.sbrk,l=r+3&-4,c=a(l*i),u=a(s.length),d=new Uint8Array(e.exports.memory.buffer);d.set(s,u);const h=t(c,r,i,u,s.length);if(0===h&&o&&o(c,l,i),n.set(d.subarray(c,c+r*i)),a(c-a(0)),0!==h)throw new Error("Malformed buffer data: ".concat(h))}const k="EXT_meshopt_compression",X=k;async function Q(e,t){var n;const r=new P(e);if(null==t||null===(n=t.gltf)||void 0===n||!n.decompressMeshes)return;const i=[];for(const s of e.json.bufferViews||[])i.push(W(r,s));await Promise.all(i),r.removeExtension(k)}async function W(e,t){const n=e.getObjectExtension(t,k);if(n){const{byteOffset:r=0,byteLength:i=0,byteStride:s,count:o,mode:a,filter:l="NONE",buffer:c}=n,u=e.gltf.buffers[c],d=new Uint8Array(u.arrayBuffer,u.byteOffset+r,i),h=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);return await async function(e,t,n,r,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NONE";const o=await K();j(o,o.exports[Z[i]],e,t,n,r,o.exports[N[s||"NONE"]])}(h,o,s,d,a,l),h}return null}var Y=n(39579);const z={};function q(e){if(void 0===z[e]){const t=Y.jU?function(e){switch(e){case"image/avif":case"image/webp":return function(e){try{const t=document.createElement("canvas");return 0===t.toDataURL(e).indexOf("data:".concat(e))}catch{return!1}}(e);default:return!0}}(e):$(e);z[e]=t}return z[e]}function $(e){const t=["image/png","image/jpeg","image/gif"],{_parseImageNode:n,_imageFormatsNode:r=t}=globalThis;return Boolean(n)&&r.includes(e)}const ee="EXT_texture_webp",te=ee;function ne(e,t){const n=new P(e);if(!q("image/webp")){if(n.getRequiredExtensions().includes(ee))throw new Error("gltf: Required extension ".concat(ee," not supported by browser"));return}const{json:r}=n;for(const i of r.textures||[]){const e=n.getObjectExtension(i,ee);e&&(i.source=e.source),n.removeObjectExtension(i,ee)}n.removeExtension(ee)}const re="KHR_texture_basisu",ie=re;function se(e,t){const n=new P(e),{json:r}=n;for(const i of r.textures||[]){const e=n.getObjectExtension(i,re);e&&(i.source=e.source),n.removeObjectExtension(i,re)}n.removeExtension(re)}var oe=n(64995);function ae(e){const{buffer:t,size:n,count:r}=function(e){let t=e,n=1,r=0;e&&e.value&&(t=e.value,n=e.size||1);t&&(ArrayBuffer.isView(t)||(t=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return null;if(Array.isArray(e))return new t(e);if(n&&!(e instanceof t))return new t(e);return e}(t,Float32Array)),r=t.length/n);return{buffer:t,size:n,count:r}}(e);return{value:t,size:n,byteOffset:0,count:r,type:I(n),componentType:G(t)}}const le="KHR_draco_mesh_compression",ce=le;function ue(e,t,n){const r=new P(e);for(const i of fe(r))r.getObjectExtension(i,le)}async function de(e,t,n){var r;if(null==t||null===(r=t.gltf)||void 0===r||!r.decompressMeshes)return;const i=new P(e),s=[];for(const o of fe(i))i.getObjectExtension(o,le)&&s.push(pe(i,o,t,n));await Promise.all(s),i.removeExtension(le)}function he(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new P(e);for(const r of n.json.meshes||[])me(r,t),n.addRequiredExtension(le)}async function pe(e,t,n,r){const i=e.getObjectExtension(t,le);if(!i)return;const s=e.getTypedArrayForBufferView(i.bufferView),o=(0,g.qv)(s.buffer,s.byteOffset),{parse:a}=r,l={...n};delete l["3d-tiles"];const c=await a(o,oe.VJ,l,r),u=function(e){const t={};for(const n in e){const r=e[n];if("indices"!==n){const e=ae(r);t[n]=e}}return t}(c.attributes);for(const[d,h]of Object.entries(u))if(d in t.attributes){const n=t.attributes[d],r=e.getAccessor(n);null!=r&&r.min&&null!=r&&r.max&&(h.min=r.min,h.max=r.max)}t.attributes=u,c.indices&&(t.indices=ae(c.indices)),function(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}(t)}function me(e,t){var n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=i.DracoWriter.encodeSync({attributes:e}),a=null==s||null===(n=s.parseSync)||void 0===n?void 0:n.call(s,{attributes:e}),l=i._addFauxAttributes(a.attributes),c=i.addBufferView(o);return{primitives:[{attributes:l,mode:r,extensions:{[le]:{bufferView:c,attributes:l}}}]}}function*fe(e){for(const t of e.json.meshes||[])for(const e of t.primitives)yield e}var Ae=n(43855),ge=n(80540);const Be={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ce={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4};const be="KHR_texture_transform",_e=be,ye=new Ae.Z,Ee=new ge.Z,Te=new ge.Z;async function Se(e,t){if(!new P(e).getExtension(be))return;const n=e.json.materials||[];for(let r=0;r<n.length;r++)Me(r,e)}function Me(e,t){var n,r,i;const s=[],o=null===(n=t.json.materials)||void 0===n?void 0:n[e],a=null==o||null===(r=o.pbrMetallicRoughness)||void 0===r?void 0:r.baseColorTexture;a&&De(t,e,a,s);const l=null==o?void 0:o.emissiveTexture;l&&De(t,e,l,s);const c=null==o?void 0:o.normalTexture;c&&De(t,e,c,s);const u=null==o?void 0:o.occlusionTexture;u&&De(t,e,u,s);const d=null==o||null===(i=o.pbrMetallicRoughness)||void 0===i?void 0:i.metallicRoughnessTexture;d&&De(t,e,d,s)}function De(e,t,n,r){const i=function(e,t){var n;const r=null===(n=e.extensions)||void 0===n?void 0:n[be],{texCoord:i=0}=e,{texCoord:s=i}=r,o=-1!==t.findIndex((e=>{let[t,n]=e;return t===i&&n===s}));if(!o){const n=function(e){const{offset:t=[0,0],rotation:n=0,scale:r=[1,1]}=e,i=(new ge.Z).set(1,0,0,0,1,0,t[0],t[1],1),s=Ee.set(Math.cos(n),Math.sin(n),0,-Math.sin(n),Math.cos(n),0,0,0,1),o=Te.set(r[0],0,0,0,r[1],0,0,0,1);return i.multiplyRight(s).multiplyRight(o)}(r);return i!==s&&(e.texCoord=s),t.push([i,s]),{originalTexCoord:i,texCoord:s,matrix:n}}return null}(n,r);if(!i)return;const s=e.json.meshes||[];for(const o of s)for(const n of o.primitives){const r=n.material;Number.isFinite(r)&&t===r&&xe(e,n,i)}}function xe(e,t,n){const{originalTexCoord:r,texCoord:i,matrix:s}=n,o=t.attributes["TEXCOORD_".concat(r)];if(Number.isFinite(o)){var a;const n=null===(a=e.json.accessors)||void 0===a?void 0:a[o];if(n&&n.bufferView){var l;const o=null===(l=e.json.bufferViews)||void 0===l?void 0:l[n.bufferView];if(o){const{arrayBuffer:a,byteOffset:l}=e.buffers[o.buffer],c=(l||0)+(n.byteOffset||0)+(o.byteOffset||0),{ArrayType:u,length:d}=F(n,o),h=Ce[n.componentType],p=Be[n.type],m=o.byteStride||h*p,f=new Float32Array(d);for(let e=0;e<n.count;e++){const t=new u(a,c+e*m,2);ye.set(t[0],t[1],1),ye.transformByMatrix3(s),f.set([ye[0],ye[1]],e*p)}r===i?function(e,t,n,r){e.componentType=5126,n.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),t.buffer=n.length-1,t.byteLength=r.buffer.byteLength,t.byteOffset=0,delete t.byteStride}(n,o,e.buffers,f):function(e,t,n,r,i){r.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const s=r.json.bufferViews;if(!s)return;s.push({buffer:r.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const o=r.json.accessors;if(!o)return;o.push({bufferView:(null==s?void 0:s.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),n.attributes["TEXCOORD_".concat(e)]=o.length-1}(i,n,t,e,f)}}}}const ve="KHR_lights_punctual",we=ve;async function Re(e){const t=new P(e),{json:n}=t,r=t.getExtension(ve);r&&(t.json.lights=r.lights,t.removeExtension(ve));for(const i of n.nodes||[]){const e=t.getObjectExtension(i,ve);e&&(i.light=e.light),t.removeObjectExtension(i,ve)}}async function Ie(e){const t=new P(e),{json:n}=t;if(n.lights){const e=t.addExtension(ve);B(!e.lights),e.lights=n.lights,delete n.lights}if(t.json.lights){for(const e of t.json.lights){const n=e.node;t.addObjectExtension(n,ve,e)}delete t.json.lights}}const Ge="KHR_materials_unlit",Fe=Ge;async function Oe(e){const t=new P(e),{json:n}=t;for(const r of n.materials||[]){r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),t.removeObjectExtension(r,Ge)}t.removeExtension(Ge)}function Pe(e){const t=new P(e),{json:n}=t;if(t.materials)for(const r of n.materials||[])r.unlit&&(delete r.unlit,t.addObjectExtension(r,Ge,{}),t.addExtension(Ge))}const He="KHR_techniques_webgl",Ue=He;async function Le(e){const t=new P(e),{json:n}=t,r=t.getExtension(He);if(r){const e=function(e,t){const{programs:n=[],shaders:r=[],techniques:i=[]}=e,s=new TextDecoder;return r.forEach((e=>{if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=s.decode(t.getTypedArrayForBufferView(e.bufferView))})),n.forEach((e=>{e.fragmentShader=r[e.fragmentShader],e.vertexShader=r[e.vertexShader]})),i.forEach((e=>{e.program=n[e.program]})),i}(r,t);for(const r of n.materials||[]){const n=t.getObjectExtension(r,He);n&&(r.technique=Object.assign({},n,e[n.technique]),r.technique.values=Ne(r.technique,t)),t.removeObjectExtension(r,He)}t.removeExtension(He)}}async function Je(e,t){}function Ne(e,t){const n=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach((t=>{e.uniforms[t].value&&!(t in n)&&(n[t]=e.uniforms[t].value)})),Object.keys(n).forEach((e=>{"object"==typeof n[e]&&void 0!==n[e].index&&(n[e].texture=t.getTexture(n[e].index))})),n}const Ze="EXT_feature_metadata",Ve=Ze;async function Ke(e){!function(e){var t;const n=e.getExtension(Ze),r=null==n||null===(t=n.schema)||void 0===t?void 0:t.classes,i=null==n?void 0:n.featureTables;(null==n?void 0:n.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.');if(r&&i)for(const s in r){const t=r[s],n=Xe(i,s);n&&je(e,n,t)}}(new P(e))}function je(e,t,n){for(const i in n.properties){var r;const s=n.properties[i],o=null==t||null===(r=t.properties)||void 0===r?void 0:r[i],a=t.count;if(o){const t=ke(e,s,a,o);o.data=t}}}function ke(e,t,n,r){const i=r.bufferView;let s=e.getTypedArrayForBufferView(i);switch(t.type){case"STRING":{const t=r.stringOffsetBufferView;s=function(e,t,n){const r=[],i=new TextDecoder("utf8");let s=0;const o=4;for(let a=0;a<n;a++){const n=t[(a+1)*o]-t[a*o],l=e.subarray(s,n+s),c=i.decode(l);r.push(c),s+=n}return r}(s,e.getTypedArrayForBufferView(t),n);break}}return s}function Xe(e,t){for(const n in e){const r=e[n];if(r.class===t)return r}return null}const Qe=[r,i,s,o,l,c,u,a,d];function We(e,t){var n;const r=(null==t||null===(n=t.gltf)||void 0===n?void 0:n.excludeExtensions)||{};return!(e in r&&!r[e])}const Ye="KHR_binary_glTF";const ze={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},qe={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class $e{constructor(){(0,_.Z)(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),(0,_.Z)(this,"json",void 0)}normalize(e,t){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return void console.warn("glTF: Unknown version ".concat(n.asset.version))}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),function(e){const t=new P(e),{json:n}=t;for(const r of n.images||[]){const e=t.getObjectExtension(r,Ye);e&&Object.assign(r,e),t.removeObjectExtension(r,Ye)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,t.removeExtension(Ye)}(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in ze)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const n=e[t];if(n&&!Array.isArray(n)){e[t]=[];for(const r in n){const i=n[r];i.id=i.id||r;const s=e[t].length;e[t].push(i),this.idToIndexMap[t][r]=s}}}_convertObjectIdsToArrayIndices(e){for(const t in ze)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:e,indices:n,material:r}=t;for(const t in e)e[t]=this._convertIdToIndex(e[t],"accessor");n&&(t.indices=this._convertIdToIndex(n,"accessor")),r&&(t.material=this._convertIdToIndex(r,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map((e=>this._convertIdToIndex(e,"node")))),e.meshes&&(e.meshes=e.meshes.map((e=>this._convertIdToIndex(e,"mesh"))))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map((e=>this._convertIdToIndex(e,"node"))))}_convertIdsToIndices(e,t){e[t]||(console.warn("gltf v1: json doesn't contain attribute ".concat(t)),e[t]=[]);for(const n of e[t])for(const e in n){const t=n[e],r=this._convertIdToIndex(t,e);n[e]=r}}_convertIdToIndex(e,t){const n=qe[t];if(n in this.idToIndexMap){const r=this.idToIndexMap[n][e];if(!Number.isFinite(r))throw new Error("gltf v1: failed to resolve ".concat(t," with id ").concat(e));return r}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){for(const i of e.materials){var t,n,r;i.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const s=(null===(t=i.values)||void 0===t?void 0:t.tex)||(null===(n=i.values)||void 0===n?void 0:n.texture2d_0)||(null===(r=i.values)||void 0===r?void 0:r.diffuseTex),o=e.textures.findIndex((e=>e.id===s));-1!==o&&(i.pbrMetallicRoughness.baseColorTexture={index:o})}}}const et={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},tt={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},nt=10240,rt=10241,it=10242,st=10243,ot=10497,at={magFilter:nt,minFilter:rt,wrapS:it,wrapT:st},lt={[nt]:9729,[rt]:9986,[it]:ot,[st]:ot};class ct{constructor(){(0,_.Z)(this,"baseUri",""),(0,_.Z)(this,"json",{}),(0,_.Z)(this,"buffers",[]),(0,_.Z)(this,"images",[])}postProcess(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{json:n,buffers:r=[],images:i=[],baseUri:s=""}=e;return B(n),this.baseUri=s,this.json=n,this.buffers=r,this.images=i,this._resolveTree(this.json,t),this.json}_resolveTree(e){e.bufferViews&&(e.bufferViews=e.bufferViews.map(((e,t)=>this._resolveBufferView(e,t)))),e.images&&(e.images=e.images.map(((e,t)=>this._resolveImage(e,t)))),e.samplers&&(e.samplers=e.samplers.map(((e,t)=>this._resolveSampler(e,t)))),e.textures&&(e.textures=e.textures.map(((e,t)=>this._resolveTexture(e,t)))),e.accessors&&(e.accessors=e.accessors.map(((e,t)=>this._resolveAccessor(e,t)))),e.materials&&(e.materials=e.materials.map(((e,t)=>this._resolveMaterial(e,t)))),e.meshes&&(e.meshes=e.meshes.map(((e,t)=>this._resolveMesh(e,t)))),e.nodes&&(e.nodes=e.nodes.map(((e,t)=>this._resolveNode(e,t)))),e.skins&&(e.skins=e.skins.map(((e,t)=>this._resolveSkin(e,t)))),e.scenes&&(e.scenes=e.scenes.map(((e,t)=>this._resolveScene(e,t)))),void 0!==e.scene&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,t){if("object"==typeof t)return t;const n=this.json[e]&&this.json[e][t];return n||console.warn("glTF file error: Could not find ".concat(e,"[").concat(t,"]")),n}_resolveScene(e,t){return e.id=e.id||"scene-".concat(t),e.nodes=(e.nodes||[]).map((e=>this.getNode(e))),e}_resolveNode(e,t){return e.id=e.id||"node-".concat(t),e.children&&(e.children=e.children.map((e=>this.getNode(e)))),void 0!==e.mesh?e.mesh=this.getMesh(e.mesh):void 0!==e.meshes&&e.meshes.length&&(e.mesh=e.meshes.reduce(((e,t)=>{const n=this.getMesh(t);return e.id=n.id,e.primitives=e.primitives.concat(n.primitives),e}),{primitives:[]})),void 0!==e.camera&&(e.camera=this.getCamera(e.camera)),void 0!==e.skin&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,t){return e.id=e.id||"skin-".concat(t),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,t){return e.id=e.id||"mesh-".concat(t),e.primitives&&(e.primitives=e.primitives.map((e=>{const t=(e={...e}).attributes;e.attributes={};for(const n in t)e.attributes[n]=this.getAccessor(t[n]);return void 0!==e.indices&&(e.indices=this.getAccessor(e.indices)),void 0!==e.material&&(e.material=this.getMaterial(e.material)),e}))),e}_resolveMaterial(e,t){if(e.id=e.id||"material-".concat(t),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const t=e.pbrMetallicRoughness;t.baseColorTexture&&(t.baseColorTexture={...t.baseColorTexture},t.baseColorTexture.texture=this.getTexture(t.baseColorTexture.index)),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture={...t.metallicRoughnessTexture},t.metallicRoughnessTexture.texture=this.getTexture(t.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,t){var n,r;if(e.id=e.id||"accessor-".concat(t),void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=(n=e.componentType,tt[n]),e.components=(r=e.type,et[r]),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const t=e.bufferView.buffer,{ArrayType:n,byteLength:r}=F(e,e.bufferView),i=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+t.byteOffset;let s=t.arrayBuffer.slice(i,i+r);e.bufferView.byteStride&&(s=this._getValueFromInterleavedBuffer(t,i,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new n(s)}return e}_getValueFromInterleavedBuffer(e,t,n,r,i){const s=new Uint8Array(i*r);for(let o=0;o<i;o++){const i=t+o*n;s.set(new Uint8Array(e.arrayBuffer.slice(i,i+r)),o*r)}return s.buffer}_resolveTexture(e,t){return e.id=e.id||"texture-".concat(t),e.sampler="sampler"in e?this.getSampler(e.sampler):lt,e.source=this.getImage(e.source),e}_resolveSampler(e,t){e.id=e.id||"sampler-".concat(t),e.parameters={};for(const n in e){const t=this._enumSamplerParameter(n);void 0!==t&&(e.parameters[t]=e[n])}return e}_enumSamplerParameter(e){return at[e]}_resolveImage(e,t){e.id=e.id||"image-".concat(t),void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView));const n=this.images[t];return n&&(e.image=n),e}_resolveBufferView(e,t){const n=e.buffer,r={id:"bufferView-".concat(t),...e,buffer:this.buffers[n]},i=this.buffers[n].arrayBuffer;let s=this.buffers[n].byteOffset||0;return"byteOffset"in e&&(s+=e.byteOffset),r.data=new Uint8Array(i,s,e.byteLength),r}_resolveCamera(e,t){return e.id=e.id||"camera-".concat(t),e.perspective,e.orthographic,e}}const ut=1735152710,dt=12,ht=8,pt=1313821514,mt=5130562,ft=0,At=1,gt=0,Bt=!0;function Ct(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=new DataView(t),s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}(i,n+0),o=i.getUint32(n+4,Bt),a=i.getUint32(n+8,Bt);switch(Object.assign(e,{header:{byteOffset:n,byteLength:a,hasBinChunk:!1},type:s,version:o,json:{},binChunks:[]}),n+=dt,e.version){case 1:return function(e,t,n){(0,E.h)(e.header.byteLength>dt+ht);const r=t.getUint32(n+0,Bt),i=t.getUint32(n+4,Bt);return n+=ht,(0,E.h)(i===gt),bt(e,t,n,r),n+=r,n+=_t(e,t,n,e.header.byteLength),n}(e,i,n);case 2:return function(e,t,n,r){return(0,E.h)(e.header.byteLength>dt+ht),function(e,t,n,r){for(;n+8<=e.header.byteLength;){const i=t.getUint32(n+0,Bt),s=t.getUint32(n+4,Bt);switch(n+=ht,s){case pt:bt(e,t,n,i);break;case mt:_t(e,t,n,i);break;case ft:r.strict||bt(e,t,n,i);break;case At:r.strict||_t(e,t,n,i)}n+=T(i,4)}}(e,t,n,r),n+e.header.byteLength}(e,i,n,r={});default:throw new Error("Invalid GLB version ".concat(e.version,". Only supports v1 and v2."))}}function bt(e,t,n,r){const i=new Uint8Array(t.buffer,n,r),s=new TextDecoder("utf8").decode(i);return e.json=JSON.parse(s),T(r,4)}function _t(e,t,n,r){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:n,byteLength:r,arrayBuffer:t.buffer}),T(r,4)}async function yt(e,t){var n,r,i,s;let o=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;!function(e,t,n,r){r.uri&&(e.baseUri=r.uri);if(t instanceof ArrayBuffer&&!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new DataView(e),{magic:i=ut}=n,s=r.getUint32(t,!1);return s===i||s===ut}(t,n,r)){t=(new TextDecoder).decode(t)}if("string"==typeof t)e.json=A(t);else if(t instanceof ArrayBuffer){const i={};n=Ct(i,t,n,r.glb),B("glTF"===i.type,"Invalid GLB magic string ".concat(i.type)),e._glb=i,e.json=i.json}else B(!1,"GLTF: must be ArrayBuffer or string");const i=e.json.buffers||[];if(e.buffers=new Array(i.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:t}=e._glb;e.buffers[0]={arrayBuffer:t[0].arrayBuffer,byteOffset:t[0].byteOffset,byteLength:t[0].byteLength}}const s=e.json.images||[];e.images=new Array(s.length).fill({})}(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(new $e).normalize(e,t)}(e,{normalize:null==o||null===(n=o.gltf)||void 0===n?void 0:n.normalize}),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=Qe.filter((e=>We(e.name,t)));for(const s of r){var i;null===(i=s.preprocess)||void 0===i||i.call(s,e,t,n)}}(e,o,a);const l=[];if(null!=o&&null!==(r=o.gltf)&&void 0!==r&&r.loadBuffers&&e.json.buffers&&await async function(e,t,n){const r=e.json.buffers||[];for(let o=0;o<r.length;++o){const a=r[o];if(a.uri){var i,s;const{fetch:r}=n;B(r);const l=C(a.uri,t),c=await(null==n||null===(i=n.fetch)||void 0===i?void 0:i.call(n,l)),u=await(null==c||null===(s=c.arrayBuffer)||void 0===s?void 0:s.call(c));e.buffers[o]={arrayBuffer:u,byteOffset:0,byteLength:u.byteLength},delete a.uri}else null===e.buffers[o]&&(e.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}(e,o,a),null!=o&&null!==(i=o.gltf)&&void 0!==i&&i.loadImages){const t=async function(e,t,n){const r=function(e){const t=new Set,n=e.json.textures||[];for(const r of n)void 0!==r.source&&t.add(r.source);return Array.from(t).sort()}(e),i=e.json.images||[],s=[];for(const o of r)s.push(Et(e,i[o],o,t,n));return await Promise.all(s)}(e,o,a);l.push(t)}const c=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=Qe.filter((e=>We(e.name,t)));for(const s of r){var i;await(null===(i=s.decode)||void 0===i?void 0:i.call(s,e,t,n))}}(e,o,a);return l.push(c),await Promise.all(l),null!=o&&null!==(s=o.gltf)&&void 0!==s&&s.postProcess?function(e,t){return(new ct).postProcess(e,t)}(e,o):e}async function Et(e,t,n,r,i){const{fetch:s,parse:o}=i;let a;if(t.uri&&!t.hasOwnProperty("bufferView")){const e=C(t.uri,r),n=await s(e);a=await n.arrayBuffer(),t.bufferView={data:a}}if(Number.isFinite(t.bufferView)){const n=b(e.json,e.buffers,t.bufferView);a=(0,g.qv)(n.buffer,n.byteOffset,n.byteLength)}B(a,"glTF image has no data");let l=await o(a,[m.S,h.Ge],{mimeType:t.mimeType,basis:r.basis||{format:(0,p.h)()}},i);l&&l[0]&&(l={compressed:!0,mipmaps:!1,width:l[0].width,height:l[0].height,data:l[0]}),e.images=e.images||[],e.images[n]=l}const Tt={name:"glTF",id:"gltf",module:"gltf",version:"3.4.0-alpha.2",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;t={...Tt.options,...t},t.gltf={...Tt.options.gltf,...t.gltf};const{byteOffset:r=0}=t;return await yt({},e,r,t,n)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}}},66878:(e,t,n)=>{"use strict";n.d(t,{M3:()=>d,jD:()=>p,Fw:()=>h});var r=n(37258),i=n(85115);async function s(e,t){const{attributeName:n,attributeType:r}=t;return n?{[n]:r?o(r,e):null}:{}}function o(e,t){switch(e){case i.T4:return function(e){const t=0,n=8,r=4,i=[];try{const s=new DataView(e,t,r).getUint32(t,!0),o=new Uint32Array(e,n,s);let a=n+s*r;for(const t of o){const n=new TextDecoder("utf-8"),r=new Uint8Array(e,a,t);i.push(n.decode(r)),a+=t}}catch(s){console.error("Parse string attribute error: ",s.message)}return i}(t);case i.xf:return a(t);case i.LU:return function(e){return new Float64Array(e,8)}(t);case i.OA:return function(e){return new Int16Array(e,4)}(t);default:return a(t)}}function a(e){return new Uint32Array(e,4)}var l=n(73861);const c="",u="rejected",d={name:"I3S Attribute",id:"i3s-attribute",module:"i3s",version:"3.4.0-alpha.2",mimeTypes:["application/binary"],parse:async function(e,t){return e=s(e,t)},extensions:["bin"],options:{},binary:!0};async function h(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{attributeStorageInfo:i,attributeUrls:s,tilesetFields:o}=function(e){var t,n,r,i,s;const o=null===(t=e.tileset)||void 0===t||null===(n=t.tileset)||void 0===n?void 0:n.attributeStorageInfo,a=null===(r=e.header)||void 0===r?void 0:r.attributeUrls,l=(null===(i=e.tileset)||void 0===i||null===(s=i.tileset)||void 0===s?void 0:s.fields)||[];return{attributeStorageInfo:o,attributeUrls:a,tilesetFields:l}}(e);if(!i||!s||t<0)return null;let a=[];const c=[];for(let m=0;m<i.length;m++){var u;const e=(0,l.DA)(s[m],null===(u=n.i3s)||void 0===u?void 0:u.token),t=i[m].name,o=p(i[m]),a={...n,attributeName:t,attributeType:o},h=(0,r.z)(e,d,a);c.push(h)}try{a=await Promise.allSettled(c)}catch(h){}return a.length?function(e,t,n,r){const i=function(e){const t=e.find((e=>e.name.includes("OBJECTID")));return null==t?void 0:t.name}(t),s=e.find((e=>e.value[i]));if(!s)return null;const o=s.value[i].indexOf(n);if(o<0)return null;return function(e,t,n,r){const i={};for(let s=0;s<n.length;s++){const o=n[s].name,a=m(o,r),l=f(e,s,o);i[o]=A(l,t,a)}return i}(e,o,t,r)}(a,i,t,o):null}function p(e){return e.hasOwnProperty("objectIds")?"Oid32":e.hasOwnProperty("attributeValues")?e.attributeValues.valueType:""}function m(e,t){var n;const r=t.find((t=>t.name===e||t.alias===e));return(null==r||null===(n=r.domain)||void 0===n?void 0:n.codedValues)||[]}function f(e,t,n){const r=e[t];return r.status===u?null:r.value[n]}function A(e,t,n){let r=c;if(e&&t in e&&(r=String(e[t]).replace(/\u0000|NaN/g,"").trim()),n.length){const e=n.find((e=>e.code===Number(r)));r=(null==e?void 0:e.name)||c}return r}},84725:(e,t,n)=>{"use strict";n.d(t,{z:()=>s});const r="3DObject";function i(e,t){let n=[];for(let o=0;o<e.length;o++){var s;const a=e[o],{id:l,layerType:c,visibility:u=!0,...d}=a;if(c===r){const e="".concat(t,"/sublayers/").concat(l);n.push({url:e,id:l,layerType:c,visibility:u,...d})}null!=a&&null!==(s=a.sublayers)&&void 0!==s&&s.length&&(n=[...n,...i(a.sublayers,t)])}return n}const s={name:"I3S Building Scene Layer",id:"i3s-building-scene-layer",module:"i3s",version:"3.4.0-alpha.2",mimeTypes:["application/json"],parse:async function(e,t,n){if(null==n||!n.url)throw new Error("Url is not provided");return async function(e,t){const n=JSON.parse((new TextDecoder).decode(e)),{sublayers:r}=n;return{header:n,sublayers:i(r,t)}}(e,n.url)},extensions:["json"],options:{}}},10752:(e,t,n)=>{"use strict";n.d(t,{N:()=>L});var r=n(93865),i=n(96013),s=n(37258),o=n(43855),a=n(85451),l=n(98759),c=n(87391),u=n(64995),d=n(46348),h=n(4214),p=n(40685),m=n(73861),f=n(85115),A=n(66878);function g(e,t){var n;if(null==t||null===(n=t.i3s)||void 0===n||!n.colorsByAttribute)return[255,255,255,255];const{minValue:r,maxValue:i,minColor:s,maxColor:o}=t.i3s.colorsByAttribute,a=(e-r)/(i-r),l=[255,255,255,255];for(let c=0;c<s.length;c++)l[c]=Math.round((o[c]-s[c])*a+s[c]);return l}async function B(e,t,n,r){var i;let{attributeUrls:o}=t,{attributeStorageInfo:a}=n;const l=a.findIndex((t=>{let{name:n}=t;return e===n}));if(-1===l)return null;const c=(0,m.DA)(o[l],null==r||null===(i=r.i3s)||void 0===i?void 0:i.token),u=(0,A.jD)(a[l]);return await(0,s.z)(c,A.M3,{attributeName:e,attributeType:u})}const C=new o.Z([0,0,0]);const b="i3s-attribute-type";async function _(e,t,n,i,A){const _={attributes:{},indices:null,featureIds:[],vertexCount:0,modelMatrix:new a.Z,coordinateSystem:0,byteLength:0,texture:null};if(t.textureUrl){var T;const e=(0,m.DA)(t.textureUrl,null==i||null===(T=i.i3s)||void 0===T?void 0:T.token),n=function(e){switch(e){case"ktx-etc2":case"dds":return d.Dq;case"ktx2":return h.Ge;default:return c.S}}(t.textureFormat),o=await fetch(e,null==i?void 0:i.fetch),a=await o.arrayBuffer();if(null!=i&&i.i3s.decodeTextures){if(n===c.S){const e={...t.textureLoaderOptions,image:{type:"data"}};try{_.texture=await A.parse(a,e)}catch(M){_.texture=await(0,r.Q)(a,n,e)}}else if(n===d.Dq||n===h.Ge){let e=await(0,s.z)(a,n,t.textureLoaderOptions);n===h.Ge&&(e=e[0]),_.texture={compressed:!0,mipmaps:!1,width:e[0].width,height:e[0].height,data:e}}}else _.texture=a}return _.material=function(e,t){let n;e?n={...e,pbrMetallicRoughness:e.pbrMetallicRoughness?{...e.pbrMetallicRoughness}:{baseColorFactor:[255,255,255,255]}}:(n={pbrMetallicRoughness:{}},t?n.pbrMetallicRoughness.baseColorTexture={texCoord:0}:n.pbrMetallicRoughness.baseColorFactor=[255,255,255,255]);n.alphaCutoff=n.alphaCutoff||.25,n.alphaMode&&(n.alphaMode=n.alphaMode.toUpperCase());n.emissiveFactor&&(n.emissiveFactor=S(n.emissiveFactor));n.pbrMetallicRoughness&&n.pbrMetallicRoughness.baseColorFactor&&(n.pbrMetallicRoughness.baseColorFactor=S(n.pbrMetallicRoughness.baseColorFactor));t&&function(e,t){const n={source:{image:t}};e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture?e.pbrMetallicRoughness.baseColorTexture={...e.pbrMetallicRoughness.baseColorTexture,texture:n}:e.emissiveTexture?e.emissiveTexture={...e.emissiveTexture,texture:n}:e.pbrMetallicRoughness&&e.pbrMetallicRoughness.metallicRoughnessTexture?e.pbrMetallicRoughness.metallicRoughnessTexture={...e.pbrMetallicRoughness.metallicRoughnessTexture,texture:n}:e.normalTexture?e.normalTexture={...e.normalTexture,texture:n}:e.occlusionTexture&&(e.occlusionTexture={...e.occlusionTexture,texture:n})}(n,t);return n}(t.materialDefinition,_.texture),_.material&&(_.texture=null),await async function(e,t,n,i,s){var c;const d=e.byteLength;let h,m,A,_=0,T=0;if(n.isDracoGeometry){var S;const t=await(0,r.Q)(e,u.VJ,{draco:{attributeNameEntry:b}});m=t.header.vertexCount,A=null===(S=t.indices)||void 0===S?void 0:S.value;const{POSITION:n,NORMAL:i,COLOR_0:s,TEXCOORD_0:o,"feature-index":a,"uv-region":l}=t.attributes;h={position:n,normal:i,color:s,uv0:o,uvRegion:l,id:a},function(e,t){for(const n in t.loaderData.attributes){const r=t.loaderData.attributes[n];switch(r.name){case"POSITION":e.position.metadata=r.metadata;break;case"feature-index":e.id.metadata=r.metadata}}}(h,t);const c=function(e){var t,n;return null==e||null===(t=e.metadata)||void 0===t||null===(n=t["i3s-feature-ids"])||void 0===n?void 0:n.intArray}(a);c&&function(e,t){const n=e.id.value,r=new Float32Array(n.length);for(let i=0;i<n.length;i++)r[i]=t[n[i]];e.id.value=r}(h,c)}else{const{vertexAttributes:t,ordering:n,featureAttributes:r,featureAttributeOrder:s}=i.store.defaultGeometrySchema,o=function(e,t){let n=0,r=0,i=0;for(const{property:s,type:o}of t.store.defaultGeometrySchema.header){const t=(0,f.Jo)(o);switch(s){case p.s.vertexCount:r=new t(e,0,4)[0],n+=(0,f.Qm)(o);break;case p.s.featureCount:i=new t(e,4,4)[0],n+=(0,f.Qm)(o)}}return{vertexCount:r,featureCount:i,byteOffset:n}}(e,i);_=o.byteOffset,m=o.vertexCount,T=o.featureCount;const{attributes:a,byteOffset:l}=E(e,_,t,m,n),{attributes:c}=E(e,l,r,T,s);!function(e){const{id:t,faceRange:n}=e;if(!t||!n)return;const r=t.value,i=n.value,s=i[i.length-1]+1,o=new Uint32Array(3*s);let a=0,l=0;for(let c=1;c<i.length;c+=2){const e=Number(r[a]),t=l+3*(i[c]-i[c-1]+1);o.fill(e,l,t),a++,l=t}e.id.value=o}(c),h=function(e,t){return{...e,...t}}(a,c)}if(null!=s&&null!==(c=s.i3s)&&void 0!==c&&c.coordinateSystem&&s.i3s.coordinateSystem!==f.Df.METER_OFFSETS)t.modelMatrix=function(e){var t,n;const r=e.metadata,i=(null==r||null===(t=r["i3s-scale_x"])||void 0===t?void 0:t.double)||1,s=(null==r||null===(n=r["i3s-scale_y"])||void 0===n?void 0:n.double)||1,o=new a.Z;return o[0]=i,o[5]=s,o}(h.position),t.coordinateSystem=f.Df.LNGLAT_OFFSETS;else{const e=function(e,t){const n=t.mbs,r=e.value,i=e.metadata,s=new a.Z,c=new o.Z(n[0],n[1],n[2]),u=new o.Z;return l.H.WGS84.cartographicToCartesian(c,u),l.H.WGS84.eastNorthUpToFixedFrame(u,s),e.value=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=new Float64Array(e.length),i=t["i3s-scale_x"]&&t["i3s-scale_x"].double||1,s=t["i3s-scale_y"]&&t["i3s-scale_y"].double||1;for(let o=0;o<r.length;o+=3)r[o]=e[o]*i+n.x,r[o+1]=e[o+1]*s+n.y,r[o+2]=e[o+2]+n.z;for(let o=0;o<r.length;o+=3)l.H.WGS84.cartographicToCartesian(r.subarray(o,o+3),C),r[o]=C.x,r[o+1]=C.y,r[o+2]=C.z;return r}(r,i,c),s}(h.position,n);t.modelMatrix=e.invert(),t.coordinateSystem=f.Df.METER_OFFSETS}h.color=await async function(e,t,n,r,i){var s;if(null==i||null===(s=i.i3s)||void 0===s||!s.colorsByAttribute)return e;const o=r.fields.find((e=>{var t,n;let{name:r}=e;return r===(null==i||null===(t=i.i3s)||void 0===t||null===(n=t.colorsByAttribute)||void 0===n?void 0:n.attributeName)}));if(!o||!["esriFieldTypeDouble","esriFieldTypeInteger","esriFieldTypeSmallInteger"].includes(o.type))return e;const a=await B(o.name,n,r,i);if(!a)return e;const l=r.fields.find((e=>{let{type:t}=e;return"esriFieldTypeOID"===t}));if(!l)return e;const c=await B(l.name,n,r,i);if(!c)return e;const u={};for(let d=0;d<c[l.name].length;d++)u[c[l.name][d]]=g(a[o.name][d],i);for(let d=0;d<t.value.length;d++){const n=u[t.value[d]];n&&e.value.set(n,4*d)}return e}(h.color,h.id,n,i,s),t.attributes={positions:h.position,normals:h.normal,colors:y(h.color),texCoords:h.uv0,uvRegions:y(h.uvRegion||h.region)},t.indices=A||null,h.id&&h.id.value&&(t.featureIds=h.id.value);for(const r in t.attributes)t.attributes[r]||delete t.attributes[r];return t.vertexCount=m,t.byteLength=d,t}(e,_,t,n,i)}function y(e){return e?(e.normalized=!0,e):e}function E(e,t,n,r,i){const s={};for(const o of i)if(n[o]){const{valueType:i,valuesPerElement:a}=n[o];if(t+r*a*(0,f.Qm)(i)<=e.byteLength){const n=e.slice(t);let l;if("UInt64"===i)l=T(n,r*a,(0,f.Qm)(i));else{l=new((0,f.Jo)(i))(n,0,r*a)}if(s[o]={value:l,type:f.PX[i],size:a},"color"===o)s.color.normalized=!0;t+=r*a*(0,f.Qm)(i)}else if("uv0"!==o)break}return{attributes:s,byteOffset:t}}function T(e,t,n){const r=[],i=new DataView(e);let s=0;for(let o=0;o<t;o++){const e=i.getUint32(s,!0)+2**32*i.getUint32(s+4,!0);r.push(e),s+=n}return new Uint32Array(r)}function S(e){const t=[...e];for(let n=0;n<e.length;n++)t[n]=e[n]/255;return t}const M={name:"I3S Content (Indexed Scene Layers)",id:i.jU?"i3s-content":"i3s-content-nodejs",module:"i3s",worker:!0,version:"3.4.0-alpha.2",mimeTypes:["application/octet-stream"],parse:async function(e,t,n){const{tile:r,_tileOptions:i,tileset:s,_tilesetOptions:o}=(null==t?void 0:t.i3s)||{},a=i||r,l=o||s;if(!a||!l)return null;return await _(e,a,l,t,n)},extensions:["bin"],options:{"i3s-content":{}}};var D=n(36625),x=n(33406),v=n(81180),w=n(1975),R=n(91872);async function I(e){return JSON.parse((new TextDecoder).decode(e))}const G={name:"I3S Node Page",id:"i3s-node-page",module:"i3s",version:"3.4.0-alpha.2",mimeTypes:["application/json"],parse:async function(e){return e=I(e)},extensions:["json"],options:{}};class F{constructor(e,t){var n,r;(0,v.Z)(this,"tileset",void 0),(0,v.Z)(this,"nodePages",[]),(0,v.Z)(this,"pendingNodePages",[]),(0,v.Z)(this,"nodesPerPage",void 0),(0,v.Z)(this,"options",void 0),(0,v.Z)(this,"lodSelectionMetricType",void 0),(0,v.Z)(this,"textureDefinitionsSelectedFormats",[]),(0,v.Z)(this,"nodesInNodePages",void 0),(0,v.Z)(this,"textureLoaderOptions",{}),this.tileset={...e},this.nodesPerPage=(null===(n=e.nodePages)||void 0===n?void 0:n.nodesPerPage)||64,this.lodSelectionMetricType=null===(r=e.nodePages)||void 0===r?void 0:r.lodSelectionMetricType,this.options=t,this.nodesInNodePages=0,this.initSelectedFormatsForTextureDefinitions(e)}async getNodeById(e){const t=Math.floor(e/this.nodesPerPage);if(!this.nodePages[t]&&!this.pendingNodePages[t]){var n;const e=(0,m.DA)("".concat(this.tileset.url,"/nodepages/").concat(t),null===(n=this.options.i3s)||void 0===n?void 0:n.token);this.pendingNodePages[t]={status:"Pending",promise:(0,s.z)(e,G,this.options)},this.nodePages[t]=await this.pendingNodePages[t].promise,this.nodesInNodePages+=this.nodePages[t].nodes.length,this.pendingNodePages[t].status="Done"}"Pending"===this.pendingNodePages[t].status&&(this.nodePages[t]=await this.pendingNodePages[t].promise);const r=e%this.nodesPerPage;return this.nodePages[t].nodes[r]}async formTileFromNodePages(e){const t=await this.getNodeById(e),n=[],r=[];for(const h of t.children||[])r.push(this.getNodeById(h));const i=await Promise.all(r);for(const h of i)n.push({id:h.index.toString(),obb:h.obb});let s,o,a,l="jpg",c=[],u=!1;if(t&&t.mesh){const{url:e,isDracoGeometry:n}=t.mesh.geometry&&this.getContentUrl(t.mesh.geometry)||{isDracoGeometry:!1};s=e,u=n;const{textureData:r,materialDefinition:i}=this.getInformationFromMaterial(t.mesh.material);a=i,l=r.format||l,r.name&&(o="".concat(this.tileset.url,"/nodes/").concat(t.mesh.material.resource,"/textures/").concat(r.name)),this.tileset.attributeStorageInfo&&(c=(0,m.OX)(this.tileset,t.mesh.attribute.resource))}const d=this.getLodSelection(t);return O({id:e.toString(),lodSelection:d,obb:t.obb,contentUrl:s,textureUrl:o,attributeUrls:c,materialDefinition:a,textureFormat:l,textureLoaderOptions:this.textureLoaderOptions,children:n,isDracoGeometry:u})}getContentUrl(e){let t=null;const n=this.tileset.geometryDefinitions[e.definition];let r=-1;if(this.options.i3s&&this.options.i3s.useDracoGeometry&&(r=n.geometryBuffers.findIndex((e=>e.compressedAttributes&&"draco"===e.compressedAttributes.encoding))),-1===r&&(r=n.geometryBuffers.findIndex((e=>!e.compressedAttributes))),-1!==r){const i=Boolean(n.geometryBuffers[r].compressedAttributes);t={url:"".concat(this.tileset.url,"/nodes/").concat(e.resource,"/geometries/").concat(r),isDracoGeometry:i}}return t}getLodSelection(e){const t=[];return"maxScreenThresholdSQ"===this.lodSelectionMetricType&&t.push({metricType:"maxScreenThreshold",maxError:Math.sqrt(e.lodThreshold/(.25*Math.PI))}),t.push({metricType:this.lodSelectionMetricType,maxError:e.lodThreshold}),t}getInformationFromMaterial(e){const t={textureData:{name:null}};if(e){var n;const s=null===(n=this.tileset.materialDefinitions)||void 0===n?void 0:n[e.definition];if(s){var r,i;t.materialDefinition=s;const e=null==s||null===(r=s.pbrMetallicRoughness)||void 0===r||null===(i=r.baseColorTexture)||void 0===i?void 0:i.textureSetDefinitionId;"number"==typeof e&&(t.textureData=this.textureDefinitionsSelectedFormats[e]||t.textureData)}}return t}initSelectedFormatsForTextureDefinitions(e){this.textureDefinitionsSelectedFormats=[];const t=this.getSupportedTextureFormats(),n=e.textureSetDefinitions||[];for(const r of n){const e=r&&r.formats||[];let n=null;for(const r of t){const t=e.find((e=>e.format===r));if(t){n=t;break}}n&&"ktx2"===n.format&&(this.textureLoaderOptions.basis={format:(0,w.h)(),containerFormat:"ktx2",module:"encoder"}),this.textureDefinitionsSelectedFormats.push(n)}}getSupportedTextureFormats(){const e=[];if(!this.options.i3s||this.options.i3s.useCompressedTextures){const t=(0,R.U)();t.has("etc2")&&e.push("ktx-etc2"),t.has("dxt")&&e.push("dds"),e.push("ktx2")}return e.push("jpg"),e.push("png"),e}}function O(e){var t,n;const r={};let i=[0,0,0,1];if(e.mbs)i=e.mbs,r.sphere=[...l.H.WGS84.cartographicToCartesian(e.mbs.slice(0,3)),e.mbs[3]];else if(e.obb){r.box=[...l.H.WGS84.cartographicToCartesian(e.obb.center),...e.obb.halfSize,...e.obb.quaternion];const t=(new D.F7).fromCenterHalfSizeQuaternion(r.box.slice(0,3),e.obb.halfSize,e.obb.quaternion).getBoundingSphere();r.sphere=[...t.center,t.radius],i=[...e.obb.center,t.radius]}const s=null===(t=e.lodSelection)||void 0===t?void 0:t[0].metricType,o=null===(n=e.lodSelection)||void 0===n?void 0:n[0].maxError,a=e.transform,c=x.R7.MESH,u=x.F$.REPLACE;return{...e,mbs:i,boundingVolume:r,lodMetricType:s,lodMetricValue:o,transformMatrix:a,type:c,refine:u}}const P=/layers\/[0-9]+$/,H=/nodes\/([0-9-]+|root)$/,U="PointCloud",L={name:"I3S (Indexed Scene Layers)",id:"i3s",module:"i3s",version:"3.4.0-alpha.2",mimeTypes:["application/octet-stream"],parse:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const i=n.url;t.i3s=t.i3s||{};if("504b0304"===function(e){if(e instanceof ArrayBuffer)return[...new Uint8Array(e,0,4)].map((e=>e.toString(16).padStart(2,"0"))).join("");return null}(e))throw new Error("Files with .slpk extention currently are not supported by I3SLoader");let o,a;o="auto"===t.i3s.isTileset?P.test(i):t.i3s.isTileset;a="auto"===t.isTileHeader?H.test(i):t.i3s.isTileHeader;e=o?await async function(e,t,n){const r=JSON.parse((new TextDecoder).decode(e));if((null==r?void 0:r.layerType)===U)throw new Error("Point Cloud layers currently are not supported by I3SLoader");return r.loader=L,await async function(e,t,n){if(e.url=n.url,e.nodePages)e.nodePagesTile=new F(e,t),e.root=e.nodePagesTile.formTileFromNodePages(0);else{var r;const n=(0,m.DA)("".concat(e.url,"/nodes/root"),null===(r=t.i3s)||void 0===r?void 0:r.token);e.root=await(0,s.z)(n,e.loader,{...t,i3s:{...t.i3s,loadContent:!1,isTileHeader:!0,isTileset:!1}})}e.basePath=e.url,e.type=x.i3.I3S,e.lodMetricType=e.root.lodMetricType,e.lodMetricValue=e.root.lodMetricValue}(r,t,n),r}(e,t,n):a?await async function(e,t){return e=JSON.parse((new TextDecoder).decode(e)),function(e,t){const n=t.url||"";let r,i,s;return e.geometryData&&(r="".concat(n,"/").concat(e.geometryData[0].href)),e.textureData&&(i="".concat(n,"/").concat(e.textureData[0].href)),e.attributeData&&(s=(0,m.gT)(n,e)),O({...e,url:n,contentUrl:r,textureUrl:i,attributeUrls:s,isDracoGeometry:!1})}(e,t)}(e,n):await async function(e,t){return await(0,r.Q)(e,M,t)}(e,t);return e},extensions:["bin"],options:{i3s:{token:null,isTileset:"auto",isTileHeader:"auto",tile:null,tileset:null,_tileOptions:null,_tilesetOptions:null,useDracoGeometry:!0,useCompressedTextures:!0,decodeTextures:!0,coordinateSystem:f.Df.METER_OFFSETS,colorsByAttribute:null}}}},85115:(e,t,n)=>{"use strict";n.d(t,{Df:()=>h,Jo:()=>s,LU:()=>u,OA:()=>d,PX:()=>o,Qm:()=>a,T4:()=>l,xf:()=>c});var r=n(39757),i=n(40685);function s(e){switch(e){case i.h.UInt8:return Uint8Array;case i.h.UInt16:return Uint16Array;case i.h.UInt32:return Uint32Array;case i.h.Float32:return Float32Array;case i.h.UInt64:return Float64Array;default:throw new Error("parse i3s tile content: unknown type of data: ".concat(e))}}const o={UInt8:r.Z.UNSIGNED_BYTE,UInt16:r.Z.UNSIGNED_SHORT,Float32:r.Z.FLOAT,UInt32:r.Z.UNSIGNED_INT,UInt64:r.Z.DOUBLE};function a(e){switch(e){case i.h.UInt8:return 1;case i.h.UInt16:case i.h.Int16:return 2;case i.h.UInt32:case i.h.Int32:case i.h.Float32:return 4;case i.h.UInt64:case i.h.Int64:case i.h.Float64:return 8;default:throw new Error("parse i3s tile content: unknown size of data: ".concat(e))}}const l="String",c="Oid32",u="Float64",d="Int16";let h;!function(e){e[e.DEFAULT=-1]="DEFAULT",e[e.LNGLAT=1]="LNGLAT",e[e.METER_OFFSETS=2]="METER_OFFSETS",e[e.LNGLAT_OFFSETS=3]="LNGLAT_OFFSETS",e[e.CARTESIAN=0]="CARTESIAN"}(h||(h={}))},73861:(e,t,n)=>{"use strict";function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t?"".concat(e,"?token=").concat(t):e}function i(e,t){const{attributeData:n=[]}=t,r=[];for(let i=0;i<n.length;i++){const t=n[i].href.replace("./","");r.push("".concat(e,"/").concat(t))}return r}function s(e,t){const n=[],{attributeStorageInfo:r,url:i}=e;for(let s=0;s<r.length;s++){const e=r[s].key;n.push("".concat(i,"/nodes/").concat(t,"/attributes/").concat(e,"/0"))}return n}n.d(t,{DA:()=>r,OX:()=>s,gT:()=>i})},40685:(e,t,n)=>{"use strict";let r,i;n.d(t,{h:()=>r,s:()=>i}),function(e){e.UInt8="UInt8",e.UInt16="UInt16",e.UInt32="UInt32",e.UInt64="UInt64",e.Int16="Int16",e.Int32="Int32",e.Int64="Int64",e.Float32="Float32",e.Float64="Float64"}(r||(r={})),function(e){e.vertexCount="vertexCount",e.featureCount="featureCount"}(i||(i={}))},87391:(e,t,n)=>{"use strict";n.d(t,{S:()=>s});var r=n(77552),i=n(46936);const s={id:"image",module:"images",name:"Images",version:"3.4.0-alpha.2",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:r.Z,tests:[e=>Boolean((0,i.I)(new DataView(e)))],options:{image:{type:"auto",decode:!0}}}},46936:(e,t,n)=>{"use strict";function r(e){return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=(i=t,[...i].map((e=>e.charCodeAt(0))));var i;for(let s=0;s<r.length;++s)if(r[s]!==e[s+n])return!1;return!0}(e,"ftyp",4)?0==(96&e[8])?null:function(e){switch((t=e,n=8,r=12,String.fromCharCode(...t.slice(n,r))).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}var t,n,r}(e):null}n.d(t,{I:()=>o});const i=!1,s=!0;function o(e){const t=a(e);return function(e){const t=a(e),n=t.byteLength>=24&&2303741511===t.getUint32(0,i);if(!n)return null;return{mimeType:"image/png",width:t.getUint32(16,i),height:t.getUint32(20,i)}}(t)||function(e){const t=a(e),n=t.byteLength>=3&&65496===t.getUint16(0,i)&&255===t.getUint8(2);if(!n)return null;const{tableMarkers:r,sofMarkers:s}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)e.add(n);const t=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:e,sofMarkers:t}}();let o=2;for(;o+9<t.byteLength;){const e=t.getUint16(o,i);if(s.has(e))return{mimeType:"image/jpeg",height:t.getUint16(o+5,i),width:t.getUint16(o+7,i)};if(!r.has(e))return null;o+=2,o+=t.getUint16(o,i)}return null}(t)||function(e){const t=a(e),n=t.byteLength>=10&&1195984440===t.getUint32(0,i);if(!n)return null;return{mimeType:"image/gif",width:t.getUint16(6,s),height:t.getUint16(8,s)}}(t)||function(e){const t=a(e),n=t.byteLength>=14&&16973===t.getUint16(0,i)&&t.getUint32(2,s)===t.byteLength;if(!n)return null;return{mimeType:"image/bmp",width:t.getUint32(18,s),height:t.getUint32(22,s)}}(t)||function(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),n=r(t);if(!n)return null;return{mimeType:n.mimeType,width:0,height:0}}(t)}function a(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}},72944:(e,t,n)=>{"use strict";function r(e){const t=o(e);if(!t)throw new Error("Not an image");return t}function i(e){return s(e)}function s(e){switch(r(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function o(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}n.d(t,{Ad:()=>i,n$:()=>s})},77552:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var r=n(73613),i=n(39579);const{_parseImageNode:s}=globalThis,o="undefined"!=typeof Image,a="undefined"!=typeof ImageBitmap,l=Boolean(s),c=!!i.jU||l;var u=n(72944);const d=/^data:image\/svg\+xml/,h=/\.svg((\?|#).*)?$/;function p(e){return e&&(d.test(e)||h.test(e))}function m(e,t){if(p(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function f(e,t,n){const r=function(e,t){if(p(t)){let t=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(n){throw new Error(n.message)}return"data:image/svg+xml;base64,".concat(btoa(t))}return m(e,t)}(e,n),i=self.URL||self.webkitURL,s="string"!=typeof r&&i.createObjectURL(r);try{return await async function(e,t){const n=new Image;if(n.src=e,t.image&&t.image.decode&&n.decode)return await n.decode(),n;return await new Promise(((t,r)=>{try{n.onload=()=>t(n),n.onerror=t=>r(new Error("Could not load image ".concat(e,": ").concat(t)))}catch(i){r(i)}}))}(s||r,t)}finally{s&&i.revokeObjectURL(s)}}const A={};let g=!0;async function B(e,t,n){let r;if(p(n)){r=await f(e,t,n)}else r=m(e,n);const i=t&&t.imagebitmap;return await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!function(e){for(const t in e||A)return!1;return!0}(t)&&g||(t=null);if(t)try{return await createImageBitmap(e,t)}catch(n){console.warn(n),g=!1}return await createImageBitmap(e)}(r,i)}var C=n(46936);async function b(e,t,n){const i=((t=t||{}).image||{}).type||"auto",{url:s}=n||{};let l;switch(function(e){switch(e){case"auto":case"data":return function(){if(a)return"imagebitmap";if(o)return"image";if(c)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return a||o||c;case"imagebitmap":return a;case"image":return o;case"data":return c;default:throw new Error("@loaders.gl/images: image ".concat(e," not supported in this environment"))}}(e),e}}(i)){case"imagebitmap":l=await B(e,t,s);break;case"image":l=await f(e,t,s);break;case"data":l=await async function(e,t){const{mimeType:n}=(0,C.I)(e)||{},i=globalThis._parseImageNode;return(0,r.h)(i),await i(e,n)}(e);break;default:(0,r.h)(!1)}return"data"===i&&(l=(0,u.n$)(l)),l}},2482:(e,t,n)=>{"use strict";function r(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;const r=new Uint8Array(e),i=new Uint8Array(t);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function i(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.map((e=>e instanceof ArrayBuffer?new Uint8Array(e):e)),i=r.reduce(((e,t)=>e+t.byteLength),0),s=new Uint8Array(i);let o=0;for(const a of r)s.set(a,o),o+=a.byteLength;return s.buffer}function s(e,t,n){const r=void 0!==n?new Uint8Array(e).subarray(t,t+n):new Uint8Array(e).subarray(t);return new Uint8Array(r).buffer}n.d(t,{JY:()=>i,Xq:()=>r,qv:()=>s})},73613:(e,t,n)=>{"use strict";function r(e,t){if(!e)throw new Error(t||"loader assertion failed.")}n.d(t,{h:()=>r})},39579:(e,t,n)=>{"use strict";n.d(t,{jU:()=>r});"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,void 0!==n.g&&n.g,"undefined"!=typeof document&&document;const r=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),i="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);i&&parseFloat(i[1])},25735:(e,t,n)=>{"use strict";n.d(t,{Ed:()=>i,GZ:()=>s});var r=n(2482);async function i(e,t){for(;;){const{done:n,value:r}=await e.next();if(n)return void e.return();if(t(r))return}}async function s(e){const t=[];for await(const n of e)t.push(n);return(0,r.JY)(...t)}},96351:(e,t,n)=>{"use strict";n.d(t,{i3:()=>s});let r="";const i={};function s(e){for(const t in i)if(e.startsWith(t)){const n=i[t];e=e.replace(t,n)}return e.startsWith("http://")||e.startsWith("https://")||(e="".concat(r).concat(e)),e}},59645:(e,t,n)=>{"use strict";function r(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function i(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}n.d(t,{XX:()=>i,vB:()=>r})},32023:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(81180),i=n(23881);const s={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class o{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,r.Z)(this,"props",void 0),(0,r.Z)(this,"stats",void 0),(0,r.Z)(this,"activeRequestCount",0),(0,r.Z)(this,"requestQueue",[]),(0,r.Z)(this,"requestMap",new Map),(0,r.Z)(this,"deferredUpdate",null),this.props={...s,...e},this.stats=new i.Z({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}scheduleRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const n={handle:e,priority:0,getPriority:t},r=new Promise((e=>(n.resolve=e,n)));return this.requestQueue.push(n),this.requestMap.set(e,r),this._issueNewRequests(),r}_issueRequest(e){const{handle:t,resolve:n}=e;let r=!1;const i=()=>{r||(r=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:i}):Promise.resolve({done:i})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout((()=>this._issueNewRequestsAsync()),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==e){this._updateAllRequests();for(let t=0;t<e;++t){const e=this.requestQueue.shift();e&&this._issueRequest(e)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const n=e[t];this._updateRequest(n)||(e.splice(t,1),this.requestMap.delete(n.handle),t--)}e.sort(((e,t)=>e.priority-t.priority))}_updateRequest(e){return e.priority=e.getPriority(e.handle),!(e.priority<0)||(e.resolve(null),!1)}}},57175:(e,t,n)=>{"use strict";function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];const n=e>>11&31,r=e>>5&63,i=31&e;return t[0]=n<<3,t[1]=r<<2,t[2]=i<<3,t}n.d(t,{m:()=>r})},86430:(e,t,n)=>{"use strict";n.d(t,{hP:()=>c});var r=n(37069),i=n(43855),s=n(14034);new r.Z,new i.Z,new r.Z,new r.Z,new Uint8Array(1);function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;return(0,s.uZ)(e,0,t)/t*2-1}function a(e){return e<0?-1:1}function l(e,t,n,r){if(function(e,t){if(!e)throw new Error("math.gl assertion failed. ".concat(t))}(r),e<0||e>n||t<0||t>n)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(n));if(r.x=o(e,n),r.y=o(t,n),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const e=r.x;r.x=(1-Math.abs(r.y))*a(e),r.y=(1-Math.abs(e))*a(r.y)}return r.normalize()}function c(e,t,n){return l(e,t,255,n)}},18101:(e,t,n)=>{"use strict";n.d(t,{GL:()=>i,I6:()=>r});const r={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},i={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...r}},48710:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(18101);const i={[r.I6.DOUBLE]:Float64Array,[r.I6.FLOAT]:Float32Array,[r.I6.UNSIGNED_SHORT]:Uint16Array,[r.I6.UNSIGNED_INT]:Uint32Array,[r.I6.UNSIGNED_BYTE]:Uint8Array,[r.I6.BYTE]:Int8Array,[r.I6.SHORT]:Int16Array,[r.I6.INT]:Int32Array},s={DOUBLE:r.I6.DOUBLE,FLOAT:r.I6.FLOAT,UNSIGNED_SHORT:r.I6.UNSIGNED_SHORT,UNSIGNED_INT:r.I6.UNSIGNED_INT,UNSIGNED_BYTE:r.I6.UNSIGNED_BYTE,BYTE:r.I6.BYTE,SHORT:r.I6.SHORT,INT:r.I6.INT},o="Failed to convert GL type";class a{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in i){if(i[t]===e)return t}throw new Error(o)}static fromName(e){const t=s[e];if(!t)throw new Error(o);return t}static getArrayType(e){switch(e){case r.I6.UNSIGNED_SHORT_5_6_5:case r.I6.UNSIGNED_SHORT_4_4_4_4:case r.I6.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=i[e];if(!t)throw new Error(o);return t}}static getByteSize(e){return a.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return Boolean(a.getArrayType(e))}static createTypedArray(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;void 0===r&&(r=(t.byteLength-n)/a.getByteSize(e));return new(a.getArrayType(e))(t,n,r)}}},78354:(e,t,n)=>{"use strict";n.d(t,{ou:()=>l,qB:()=>a});var r=n(48347),i=n(72101),s=n(75228),o=n(4613);function a(e,t){const n=function(e){const t=[];for(const n in e){const r=e[n];t.push(l(n,r))}return t}(e);return new r.Z(n,t)}function l(e,t,n){const r=(0,o.Y)(t.value),a=n||function(e){const t=new Map;"byteOffset"in e&&t.set("byteOffset",e.byteOffset.toString(10));"byteStride"in e&&t.set("byteStride",e.byteStride.toString(10));"normalized"in e&&t.set("normalized",e.normalized.toString());return t}(t);return new i.Z(e,new s.t7(t.size,new i.Z("value",r)),!1,a)}},61569:(e,t,n)=>{"use strict";function r(e){let t=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0;const a=e.POSITION?e.POSITION.value:[],l=a&&a.length;for(let c=0;c<l;c+=3){const e=a[c],l=a[c+1],u=a[c+2];t=e<t?e:t,n=l<n?l:n,r=u<r?u:r,i=e>i?e:i,s=l>s?l:s,o=u>o?u:o}return[[t,n,r],[i,s,o]]}n.d(t,{v:()=>r})},4613:(e,t,n)=>{"use strict";n.d(t,{Y:()=>i});var r=n(75228);function i(e){switch(e.constructor){case Int8Array:return new r.tJ;case Uint8Array:return new r.bz;case Int16Array:return new r.k6;case Uint16Array:return new r.s3;case Int32Array:return new r.Vq;case Uint32Array:return new r.cf;case Float32Array:return new r.yA;case Float64Array:return new r.Dh;default:throw new Error("array type not supported")}}},72101:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(81180);class i{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Map;(0,r.Z)(this,"name",void 0),(0,r.Z)(this,"type",void 0),(0,r.Z)(this,"nullable",void 0),(0,r.Z)(this,"metadata",void 0),this.name=e,this.type=t,this.nullable=n,this.metadata=i}get typeId(){return this.type&&this.type.typeId}clone(){return new i(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}},48347:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(81180);class i{constructor(e,t){(0,r.Z)(this,"fields",void 0),(0,r.Z)(this,"metadata",void 0),function(e,t){if(!e)throw new Error(t||"loader assertion failed.")}(Array.isArray(e)),function(e){const t={};for(const n of e)t[n.name]&&console.warn("Schema: duplicated field name",n.name,n),t[n.name]=!0}(e),this.fields=e,this.metadata=t||new Map}compareTo(e){if(this.metadata!==e.metadata)return!1;if(this.fields.length!==e.fields.length)return!1;for(let t=0;t<this.fields.length;++t)if(!this.fields[t].compareTo(e.fields[t]))return!1;return!0}select(){const e=Object.create(null);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e[i]=!0;const s=this.fields.filter((t=>e[t.name]));return new i(s,this.metadata)}selectAt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.map((e=>this.fields[e])).filter(Boolean);return new i(r,this.metadata)}assign(e){let t,n=this.metadata;if(e instanceof i){const r=e;t=r.fields,n=s(s(new Map,this.metadata),r.metadata)}else t=e;const r=Object.create(null);for(const i of this.fields)r[i.name]=i;for(const i of t)r[i.name]=i;const o=Object.values(r);return new i(o,n)}}function s(e,t){return new Map([...e||new Map,...t||new Map])}},75228:(e,t,n)=>{"use strict";n.d(t,{t7:()=>w,yA:()=>M,Dh:()=>D,k6:()=>B,Vq:()=>C,tJ:()=>g,s3:()=>_,cf:()=>y,bz:()=>b});var r=n(81180);let i,s,o,a,l,c,u,d,h;!function(e){e[e.NONE=0]="NONE",e[e.Null=1]="Null",e[e.Int=2]="Int",e[e.Float=3]="Float",e[e.Binary=4]="Binary",e[e.Utf8=5]="Utf8",e[e.Bool=6]="Bool",e[e.Decimal=7]="Decimal",e[e.Date=8]="Date",e[e.Time=9]="Time",e[e.Timestamp=10]="Timestamp",e[e.Interval=11]="Interval",e[e.List=12]="List",e[e.Struct=13]="Struct",e[e.Union=14]="Union",e[e.FixedSizeBinary=15]="FixedSizeBinary",e[e.FixedSizeList=16]="FixedSizeList",e[e.Map=17]="Map",e[e.Dictionary=-1]="Dictionary",e[e.Int8=-2]="Int8",e[e.Int16=-3]="Int16",e[e.Int32=-4]="Int32",e[e.Int64=-5]="Int64",e[e.Uint8=-6]="Uint8",e[e.Uint16=-7]="Uint16",e[e.Uint32=-8]="Uint32",e[e.Uint64=-9]="Uint64",e[e.Float16=-10]="Float16",e[e.Float32=-11]="Float32",e[e.Float64=-12]="Float64",e[e.DateDay=-13]="DateDay",e[e.DateMillisecond=-14]="DateMillisecond",e[e.TimestampSecond=-15]="TimestampSecond",e[e.TimestampMillisecond=-16]="TimestampMillisecond",e[e.TimestampMicrosecond=-17]="TimestampMicrosecond",e[e.TimestampNanosecond=-18]="TimestampNanosecond",e[e.TimeSecond=-19]="TimeSecond",e[e.TimeMillisecond=-20]="TimeMillisecond",e[e.TimeMicrosecond=-21]="TimeMicrosecond",e[e.TimeNanosecond=-22]="TimeNanosecond",e[e.DenseUnion=-23]="DenseUnion",e[e.SparseUnion=-24]="SparseUnion",e[e.IntervalDayTime=-25]="IntervalDayTime",e[e.IntervalYearMonth=-26]="IntervalYearMonth"}(i||(i={}));class p{static isNull(e){return e&&e.typeId===i.Null}static isInt(e){return e&&e.typeId===i.Int}static isFloat(e){return e&&e.typeId===i.Float}static isBinary(e){return e&&e.typeId===i.Binary}static isUtf8(e){return e&&e.typeId===i.Utf8}static isBool(e){return e&&e.typeId===i.Bool}static isDecimal(e){return e&&e.typeId===i.Decimal}static isDate(e){return e&&e.typeId===i.Date}static isTime(e){return e&&e.typeId===i.Time}static isTimestamp(e){return e&&e.typeId===i.Timestamp}static isInterval(e){return e&&e.typeId===i.Interval}static isList(e){return e&&e.typeId===i.List}static isStruct(e){return e&&e.typeId===i.Struct}static isUnion(e){return e&&e.typeId===i.Union}static isFixedSizeBinary(e){return e&&e.typeId===i.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===i.FixedSizeList}static isMap(e){return e&&e.typeId===i.Map}static isDictionary(e){return e&&e.typeId===i.Dictionary}get typeId(){return i.NONE}compareTo(e){return this===e}}class m extends(null){get typeId(){return Type.Null}get[Symbol.toStringTag](){return"Null"}toString(){return"Null"}}class f extends(null){get typeId(){return Type.Bool}get[Symbol.toStringTag](){return"Bool"}toString(){return"Bool"}}s=Symbol.toStringTag;class A extends p{constructor(e,t){super(),(0,r.Z)(this,"isSigned",void 0),(0,r.Z)(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=t}get typeId(){return i.Int}get[s](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class g extends A{constructor(){super(!0,8)}}class B extends A{constructor(){super(!0,16)}}class C extends A{constructor(){super(!0,32)}}class b extends A{constructor(){super(!1,8)}}class _ extends A{constructor(){super(!1,16)}}class y extends A{constructor(){super(!1,32)}}const E=32,T=64;o=Symbol.toStringTag;class S extends p{constructor(e){super(),(0,r.Z)(this,"precision",void 0),this.precision=e}get typeId(){return i.Float}get[o](){return"Float"}toString(){return"Float".concat(this.precision)}}class M extends S{constructor(){super(E)}}class D extends S{constructor(){super(T)}}class x extends(null){constructor(){super()}get typeId(){return Type.Binary}toString(){return"Binary"}get[Symbol.toStringTag](){return"Binary"}}class v extends(null){get typeId(){return Type.Utf8}get[Symbol.toStringTag](){return"Utf8"}toString(){return"Utf8"}}a=Symbol.toStringTag;l=Symbol.toStringTag;c=Symbol.toStringTag;u=Symbol.toStringTag;d=Symbol.toStringTag;class w extends p{constructor(e,t){super(),(0,r.Z)(this,"listSize",void 0),(0,r.Z)(this,"children",void 0),this.listSize=e,this.children=[t]}get typeId(){return i.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[d](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}h=Symbol.toStringTag},41682:(e,t,n)=>{"use strict";n.d(t,{x:()=>r});const r={name:"Terrain",id:"terrain",module:"terrain",version:"3.4.0-alpha.2",worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:null,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:null}}}},4214:(e,t,n)=>{"use strict";n.d(t,{Ge:()=>a});var r=n(96013),i=n(41699),s=n(1975);const o={name:"Basis",id:r.jU?"basis":"basis-nodejs",module:"textures",version:i.q,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},a={...o,parse:s.Z}},46348:(e,t,n)=>{"use strict";n.d(t,{Dq:()=>T});var r=n(41699),i=n(17038),s=n(73613),o=n(31330),a=n(2434);const l={MAGIC_NUMBER:542327876,HEADER_LENGTH:31,MAGIC_NUMBER_INDEX:0,HEADER_SIZE_INDEX:1,HEADER_FLAGS_INDEX:2,HEADER_HEIGHT_INDEX:3,HEADER_WIDTH_INDEX:4,MIPMAPCOUNT_INDEX:7,HEADER_PF_FLAGS_INDEX:20,HEADER_PF_FOURCC_INDEX:21,DDSD_MIPMAPCOUNT:131072,DDPF_FOURCC:4},c={DXT1:o.p.COMPRESSED_RGB_S3TC_DXT1_EXT,DXT3:o.p.COMPRESSED_RGBA_S3TC_DXT3_EXT,DXT5:o.p.COMPRESSED_RGBA_S3TC_DXT5_EXT,"ATC ":o.p.COMPRESSED_RGB_ATC_WEBGL,ATCA:o.p.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL,ATCI:o.p.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL},u={DXT1:h,DXT3:p,DXT5:p,"ATC ":h,ATCA:p,ATCI:p};function d(e){const t=new Int32Array(e,0,l.HEADER_LENGTH),n=t[l.HEADER_PF_FOURCC_INDEX];(0,s.h)(Boolean(t[l.HEADER_PF_FLAGS_INDEX]&l.DDPF_FOURCC),"DDS: Unsupported format, must contain a FourCC code");const r=(i=n,String.fromCharCode(255&i,i>>8&255,i>>16&255,i>>24&255));var i;const o=c[r],d=u[r];(0,s.h)(o&&d,"DDS: Unknown pixel format ".concat(n));let h=1;t[l.HEADER_FLAGS_INDEX]&l.DDSD_MIPMAPCOUNT&&(h=Math.max(1,t[l.MIPMAPCOUNT_INDEX]));const p=t[l.HEADER_WIDTH_INDEX],m=t[l.HEADER_HEIGHT_INDEX],f=t[l.HEADER_SIZE_INDEX]+4,A=new Uint8Array(e,f);return(0,a.J)(A,{mipMapLevels:h,width:p,height:m,sizeFunction:d,internalFormat:o})}function h(e,t){return(e+3>>2)*(t+3>>2)*8}function p(e,t){return(e+3>>2)*(t+3>>2)*16}const m={MAGIC_NUMBER:55727696,MAGIC_NUMBER_EXTRA:1347834371,HEADER_LENGTH:13,HEADER_SIZE:52,MAGIC_NUMBER_INDEX:0,PIXEL_FORMAT_INDEX:2,COLOUR_SPACE_INDEX:4,HEIGHT_INDEX:6,WIDTH_INDEX:7,MIPMAPCOUNT_INDEX:11,METADATA_SIZE_INDEX:12},f={0:[o.p.COMPRESSED_RGB_PVRTC_2BPPV1_IMG],1:[o.p.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG],2:[o.p.COMPRESSED_RGB_PVRTC_4BPPV1_IMG],3:[o.p.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG],6:[o.p.COMPRESSED_RGB_ETC1_WEBGL],7:[o.p.COMPRESSED_RGB_S3TC_DXT1_EXT],9:[o.p.COMPRESSED_RGBA_S3TC_DXT3_EXT],11:[o.p.COMPRESSED_RGBA_S3TC_DXT5_EXT],22:[o.p.COMPRESSED_RGB8_ETC2],23:[o.p.COMPRESSED_RGBA8_ETC2_EAC],24:[o.p.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2],25:[o.p.COMPRESSED_R11_EAC],26:[o.p.COMPRESSED_RG11_EAC],27:[o.p.COMPRESSED_RGBA_ASTC_4X4_KHR,o.p.COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR],28:[o.p.COMPRESSED_RGBA_ASTC_5X4_KHR,o.p.COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR],29:[o.p.COMPRESSED_RGBA_ASTC_5X5_KHR,o.p.COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR],30:[o.p.COMPRESSED_RGBA_ASTC_6X5_KHR,o.p.COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR],31:[o.p.COMPRESSED_RGBA_ASTC_6X6_KHR,o.p.COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR],32:[o.p.COMPRESSED_RGBA_ASTC_8X5_KHR,o.p.COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR],33:[o.p.COMPRESSED_RGBA_ASTC_8X6_KHR,o.p.COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR],34:[o.p.COMPRESSED_RGBA_ASTC_8X8_KHR,o.p.COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR],35:[o.p.COMPRESSED_RGBA_ASTC_10X5_KHR,o.p.COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR],36:[o.p.COMPRESSED_RGBA_ASTC_10X6_KHR,o.p.COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR],37:[o.p.COMPRESSED_RGBA_ASTC_10X8_KHR,o.p.COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR],38:[o.p.COMPRESSED_RGBA_ASTC_10X10_KHR,o.p.COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR],39:[o.p.COMPRESSED_RGBA_ASTC_12X10_KHR,o.p.COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR],40:[o.p.COMPRESSED_RGBA_ASTC_12X12_KHR,o.p.COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR]},A={0:g,1:g,2:B,3:B,6:C,7:C,9:b,11:b,22:C,23:b,24:C,25:C,26:b,27:b,28:function(e,t){return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16},29:function(e,t){return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16},30:function(e,t){return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16},31:function(e,t){return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16},32:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16},33:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16},34:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16},35:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16},36:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16},37:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16},38:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16},39:function(e,t){return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16},40:function(e,t){return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16}};function g(e,t){return(e=Math.max(e,16))*(t=Math.max(t,8))/4}function B(e,t){return(e=Math.max(e,8))*(t=Math.max(t,8))/2}function C(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8}function b(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16}function _(e){if((0,i.j)(e))return(0,i.P)(e);if(function(e){return new Uint32Array(e,0,l.HEADER_LENGTH)[l.MAGIC_NUMBER_INDEX]===l.MAGIC_NUMBER}(e))return d(e);if(function(e){const t=new Uint32Array(e,0,m.HEADER_LENGTH)[m.MAGIC_NUMBER_INDEX];return t===m.MAGIC_NUMBER||t===m.MAGIC_NUMBER_EXTRA}(e))return function(e){const t=new Uint32Array(e,0,m.HEADER_LENGTH),n=t[m.PIXEL_FORMAT_INDEX],r=t[m.COLOUR_SPACE_INDEX],i=f[n]||[],s=i.length>1&&r?i[1]:i[0],o=A[n],l=t[m.MIPMAPCOUNT_INDEX],c=t[m.WIDTH_INDEX],u=t[m.HEIGHT_INDEX],d=m.HEADER_SIZE+t[m.METADATA_SIZE_INDEX],h=new Uint8Array(e,d);return(0,a.J)(h,{mipMapLevels:l,width:c,height:u,sizeFunction:o,internalFormat:s})}(e);throw new Error("Texture container format not recognized")}var y=n(1975);const E={name:"Texture Containers",id:"compressed-texture",module:"textures",version:r.q,worker:!0,extensions:["ktx","ktx2","dds","pvr"],mimeTypes:["image/ktx2","image/ktx","image/vnd-ms.dds","image/x-dds","application/octet-stream"],binary:!0,options:{"compressed-texture":{libraryPath:"libs/",useBasis:!1}}},T={...E,parse:async(e,t)=>t["compressed-texture"].useBasis?(t.basis={format:{alpha:"BC3",noAlpha:"BC1"},...t.basis,containerFormat:"ktx2",module:"encoder"},(await(0,y.Z)(e,t))[0]):_(e)}},31330:(e,t,n)=>{"use strict";n.d(t,{p:()=>r});const r={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919}},1975:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f,h:()=>_});var r=n(96706);const i="3.4.0-alpha.2",s="https://unpkg.com/@loaders.gl/textures@".concat(i,"/dist/libs/basis_encoder.wasm"),o="https://unpkg.com/@loaders.gl/textures@".concat(i,"/dist/libs/basis_encoder.js");let a,l;async function c(e){const t=e.modules||{};return t.basis?t.basis:(a=a||async function(e){let t=null,n=null;return[t,n]=await Promise.all([await(0,r.Y)("basis_transcoder.js","textures",e),await(0,r.Y)("basis_transcoder.wasm","textures",e)]),t=t||globalThis.BASIS,await function(e,t){const n={};t&&(n.wasmBinary=t);return new Promise((t=>{e(n).then((e=>{const{BasisFile:n,initializeBasis:r}=e;r(),t({BasisFile:n})}))}))}(t,n)}(e),await a)}async function u(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(l=l||async function(e){let t=null,n=null;return[t,n]=await Promise.all([await(0,r.Y)(o,"textures",e),await(0,r.Y)(s,"textures",e)]),t=t||globalThis.BASIS,await function(e,t){const n={};t&&(n.wasmBinary=t);return new Promise((t=>{e(n).then((e=>{const{BasisFile:n,KTX2File:r,initializeBasis:i,BasisEncoder:s}=e;i(),t({BasisFile:n,KTX2File:r,BasisEncoder:s})}))}))}(t,n)}(e),await l)}var d=n(31330),h=n(91872),p=n(17038);const m={etc1:{basisFormat:0,compressed:!0,format:d.p.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:d.p.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:d.p.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:d.p.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:d.p.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:d.p.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function f(e,t){if("auto"===t.basis.containerFormat){if((0,p.j)(e)){return B((await u(t)).KTX2File,e,t)}const{BasisFile:n}=await c(t);return A(n,e,t)}if("encoder"===t.basis.module){const n=await u(t);return"ktx2"===t.basis.containerFormat?B(n.KTX2File,e,t):A(n.BasisFile,e,t)}{const{BasisFile:n}=await c(t);return A(n,e,t)}}function A(e,t,n){const r=new e(new Uint8Array(t));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const e=r.getNumImages(),t=[];for(let i=0;i<e;i++){const e=r.getNumLevels(i),s=[];for(let t=0;t<e;t++)s.push(g(r,i,t,n));t.push(s)}return t}finally{r.close(),r.delete()}}function g(e,t,n,r){const i=e.getImageWidth(t,n),s=e.getImageHeight(t,n),o=e.getHasAlpha(),{compressed:a,format:l,basisFormat:c}=b(r,o),u=e.getImageTranscodedSizeInBytes(t,n,c),d=new Uint8Array(u);if(!e.transcodeImage(d,t,n,c,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:s,data:d,compressed:a,format:l,hasAlpha:o}}function B(e,t,n){const r=new e(new Uint8Array(t));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const e=r.getLevels(),t=[];for(let i=0;i<e;i++){t.push(C(r,i,n));break}return[t]}finally{r.close(),r.delete()}}function C(e,t,n){const{alphaFlag:r,height:i,width:s}=e.getImageLevelInfo(t,0,0),{compressed:o,format:a,basisFormat:l}=b(n,r),c=e.getImageTranscodedSizeInBytes(t,0,0,l),u=new Uint8Array(c);if(!e.transcodeImage(u,t,0,0,l,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:i,data:u,compressed:o,levelSize:c,hasAlpha:r,format:a}}function b(e,t){let n=e&&e.basis&&e.basis.format;return"auto"===n&&(n=_()),"object"==typeof n&&(n=t?n.alpha:n.noAlpha),n=n.toLowerCase(),m[n]}function _(){const e=(0,h.U)();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}},17038:(e,t,n)=>{"use strict";n.d(t,{j:()=>l,P:()=>c});var r=n(31029),i=n(2434),s=n(31330);const o={131:s.p.COMPRESSED_RGB_S3TC_DXT1_EXT,132:s.p.COMPRESSED_SRGB_S3TC_DXT1_EXT,133:s.p.COMPRESSED_RGBA_S3TC_DXT1_EXT,134:s.p.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,135:s.p.COMPRESSED_RGBA_S3TC_DXT3_EXT,136:s.p.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,137:s.p.COMPRESSED_RGBA_S3TC_DXT5_EXT,138:s.p.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,139:s.p.COMPRESSED_RED_RGTC1_EXT,140:s.p.COMPRESSED_SIGNED_RED_RGTC1_EXT,141:s.p.COMPRESSED_RED_GREEN_RGTC2_EXT,142:s.p.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT,147:s.p.COMPRESSED_RGB8_ETC2,148:s.p.COMPRESSED_SRGB8_ETC2,149:s.p.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,150:s.p.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,151:s.p.COMPRESSED_RGBA8_ETC2_EAC,152:s.p.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,153:s.p.COMPRESSED_R11_EAC,154:s.p.COMPRESSED_SIGNED_R11_EAC,155:s.p.COMPRESSED_RG11_EAC,156:s.p.COMPRESSED_SIGNED_RG11_EAC,157:s.p.COMPRESSED_RGBA_ASTC_4x4_KHR,158:s.p.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,159:s.p.COMPRESSED_RGBA_ASTC_5x4_KHR,160:s.p.COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR,161:s.p.COMPRESSED_RGBA_ASTC_5x5_KHR,162:s.p.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,163:s.p.COMPRESSED_RGBA_ASTC_6x5_KHR,164:s.p.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,165:s.p.COMPRESSED_RGBA_ASTC_6x6_KHR,166:s.p.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,167:s.p.COMPRESSED_RGBA_ASTC_8x5_KHR,168:s.p.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,169:s.p.COMPRESSED_RGBA_ASTC_8x6_KHR,170:s.p.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,171:s.p.COMPRESSED_RGBA_ASTC_8x8_KHR,172:s.p.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,173:s.p.COMPRESSED_RGBA_ASTC_10x5_KHR,174:s.p.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,175:s.p.COMPRESSED_RGBA_ASTC_10x6_KHR,176:s.p.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,177:s.p.COMPRESSED_RGBA_ASTC_10x8_KHR,178:s.p.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,179:s.p.COMPRESSED_RGBA_ASTC_10x10_KHR,180:s.p.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,181:s.p.COMPRESSED_RGBA_ASTC_12x10_KHR,182:s.p.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,183:s.p.COMPRESSED_RGBA_ASTC_12x12_KHR,184:s.p.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR,1000054e3:s.p.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,1000054001:s.p.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,1000066e3:s.p.COMPRESSED_RGBA_ASTC_4x4_KHR,1000066001:s.p.COMPRESSED_RGBA_ASTC_5x4_KHR,1000066002:s.p.COMPRESSED_RGBA_ASTC_5x5_KHR,1000066003:s.p.COMPRESSED_RGBA_ASTC_6x5_KHR,1000066004:s.p.COMPRESSED_RGBA_ASTC_6x6_KHR,1000066005:s.p.COMPRESSED_RGBA_ASTC_8x5_KHR,1000066006:s.p.COMPRESSED_RGBA_ASTC_8x6_KHR,1000066007:s.p.COMPRESSED_RGBA_ASTC_8x8_KHR,1000066008:s.p.COMPRESSED_RGBA_ASTC_10x5_KHR,1000066009:s.p.COMPRESSED_RGBA_ASTC_10x6_KHR,1000066010:s.p.COMPRESSED_RGBA_ASTC_10x8_KHR,1000066011:s.p.COMPRESSED_RGBA_ASTC_10x10_KHR,1000066012:s.p.COMPRESSED_RGBA_ASTC_12x10_KHR,1000066013:s.p.COMPRESSED_RGBA_ASTC_12x12_KHR};const a=[171,75,84,88,32,50,48,187,13,10,26,10];function l(e){const t=new Uint8Array(e);return!(t.byteLength<a.length||t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||t[4]!==a[4]||t[5]!==a[5]||t[6]!==a[6]||t[7]!==a[7]||t[8]!==a[8]||t[9]!==a[9]||t[10]!==a[10]||t[11]!==a[11])}function c(e){const t=new Uint8Array(e),n=(0,r.ij)(t),s=Math.max(1,n.levels.length),a=n.pixelWidth,l=n.pixelHeight,c=(u=n.vkFormat,o[u]);var u;return(0,i.J)(n.levels,{mipMapLevels:s,width:a,height:l,sizeFunction:e=>e.uncompressedByteLength,internalFormat:c})}},2434:(e,t,n)=>{"use strict";function r(e,t){const n=new Array(t.mipMapLevels);let r=t.width,o=t.height,a=0;for(let l=0;l<t.mipMapLevels;++l){const c=s(t,r,o,e,l),u=i(e,l,a,c);n[l]={compressed:!0,format:t.internalFormat,data:u,width:r,height:o,levelSize:c},r=Math.max(1,r>>1),o=Math.max(1,o>>1),a+=c}return n}function i(e,t,n,r){return Array.isArray(e)?e[t].levelData:new Uint8Array(e.buffer,e.byteOffset+n,r)}function s(e,t,n,r,i){return Array.isArray(r)?e.sizeFunction(r[i]):e.sizeFunction(t,n)}n.d(t,{J:()=>r})},91872:(e,t,n)=>{"use strict";n.d(t,{U:()=>o});const r=["","WEBKIT_","MOZ_"],i={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let s=null;function o(e){if(!s){e=e||function(){try{return document.createElement("canvas").getContext("webgl")}catch(e){return null}}()||void 0,s=new Set;for(const t of r)for(const n in i)if(e&&e.getExtension("".concat(t).concat(n))){const e=i[n];s.add(e)}}return s}},41699:(e,t,n)=>{"use strict";n.d(t,{q:()=>r});const r="3.4.0-alpha.2"},33406:(e,t,n)=>{"use strict";n.d(t,{F$:()=>i,Qb:()=>r,R7:()=>s,ci:()=>a,fB:()=>l,i3:()=>o});const r={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},i={ADD:1,REPLACE:2},s={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},o={I3S:"I3S",TILES3D:"TILES3D"},a={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},l={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0}},53280:(e,t,n)=>{"use strict";n.d(t,{u:()=>Ce});var r=n(81180),i=n(85451),s=n(43855),o=n(98759),a=n(23881),l=n(73613),c=n(59645),u=n(32023);class d{constructor(e,t,n){(0,r.Z)(this,"item",void 0),(0,r.Z)(this,"previous",void 0),(0,r.Z)(this,"next",void 0),this.item=e,this.previous=t,this.next=n}}class h{constructor(){(0,r.Z)(this,"head",null),(0,r.Z)(this,"tail",null),(0,r.Z)(this,"_length",0)}get length(){return this._length}add(e){const t=new d(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const n=e.next;e.next=t,this.tail===e?this.tail=t:n.previous=t,t.next=n,t.previous=e,++this._length}}function p(e){return null!=e}class m{constructor(){(0,r.Z)(this,"_list",void 0),(0,r.Z)(this,"_sentinel",void 0),(0,r.Z)(this,"_trimTiles",void 0),this._list=new h,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;p(t)&&this._list.splice(this._sentinel,t)}add(e,t,n){p(t._cacheNode)||(t._cacheNode=this._list.add(t),n&&n(e,t))}unloadTile(e,t,n){const r=t._cacheNode;p(r)&&(this._list.remove(r),t._cacheNode=void 0,n&&n(e,t))}unloadTiles(e,t){const n=this._trimTiles;this._trimTiles=!1;const r=this._list,i=1024*e.maximumMemoryUsage*1024,s=this._sentinel;let o=r.head;for(;o!==s&&(e.gpuMemoryUsageInBytes>i||n);){const n=o.item;o=o.next,this.unloadTile(e,n,t)}}trim(){this._trimTiles=!0}}var f=n(36625);const A=new s.Z,g=new s.Z,B=new f.Mh([new f.JO,new f.JO,new f.JO,new f.JO,new f.JO,new f.JO]);function C(e,t){const{cameraDirection:n,cameraUp:r,height:i}=e,{metersPerUnit:a}=e.distanceScales,l=_(e,e.center),c=o.H.WGS84.eastNorthUpToFixedFrame(l),u=e.unprojectPosition(e.cameraPosition),d=o.H.WGS84.cartographicToCartesian(u,new s.Z),h=new s.Z(c.transformAsVector(new s.Z(n).scale(a))).normalize(),p=new s.Z(c.transformAsVector(new s.Z(r).scale(a))).normalize();!function(e){const t=e.getFrustumPlanes(),n=b(t.near,e.cameraPosition),r=_(e,n),i=_(e,e.cameraPosition,g);let s=0;B.planes[s++].fromPointNormal(r,A.copy(r).subtract(i));for(const o in t){if("near"===o)continue;const i=_(e,b(t[o],n,g),g);B.planes[s++].fromPointNormal(i,A.copy(r).subtract(i))}}(e);const m=e.constructor,{longitude:f,latitude:C,width:y,bearing:E,zoom:T}=e;return{camera:{position:d,direction:h,up:p},viewport:e,topDownViewport:new m({longitude:f,latitude:C,height:i,width:y,bearing:E,zoom:T,pitch:0}),height:i,cullingVolume:B,frameNumber:t,sseDenominator:1.15}}function b(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Z;const r=e.normal.dot(t);return n.copy(e.normal).scale(e.distance-r).add(t),n}function _(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Z;const r=e.unprojectPosition(t);return o.H.WGS84.cartographicToCartesian(r,n)}const y=6356752.314245179,E=new s.Z;function T(e,t){if(e instanceof f.F7){const{halfAxes:n}=e,r=function(e){e.getColumn(0,E);const t=e.getColumn(1),n=e.getColumn(2),r=E.add(t).add(n);return r.len()}(n);return Math.log2(y/(r+t[2]))}if(e instanceof f.KM){const{radius:n}=e;return Math.log2(y/(n+t[2]))}if(e.width&&e.height){const{width:t,height:n}=e;return(Math.log2(6378137/t)+Math.log2(6378137/n))/2}return 1}function S(e,t,n){const r=o.H.WGS84.cartographicToCartesian([e.xmax,e.ymax,e.zmax],new s.Z),i=Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2)+Math.pow(r[2]-n[2],2));return Math.log2(y/(i+t[2]))}var M=n(37258),D=n(33406),x=n(14034),v=n(79108),w=n(80540);function R(e){return null!=e}const I=new s.Z,G=new s.Z,F=new s.Z,O=new s.Z;function P(e,t,n){if((0,l.h)(e,"3D Tile: boundingVolume must be defined"),e.box)return function(e,t,n){const r=new s.Z(e[0],e[1],e[2]);t.transform(r,r);let i=[];if(10===e.length){const t=e.slice(3,6),n=new v.Z;n.fromArray(e,6);const r=new s.Z([1,0,0]),o=new s.Z([0,1,0]),a=new s.Z([0,0,1]);r.transformByQuaternion(n),r.scale(t[0]),o.transformByQuaternion(n),o.scale(t[1]),a.transformByQuaternion(n),a.scale(t[2]),i=[...r.toArray(),...o.toArray(),...a.toArray()]}else i=[...e.slice(3,6),...e.slice(6,9),...e.slice(9,12)];const o=t.transformAsVector(i.slice(0,3)),a=t.transformAsVector(i.slice(3,6)),l=t.transformAsVector(i.slice(6,9)),c=new w.Z([o[0],o[1],o[2],a[0],a[1],a[2],l[0],l[1],l[2]]);if(R(n))return n.center=r,n.halfAxes=c,n;return new f.F7(r,c)}(e.box,t,n);if(e.region){const[t,n,r,a,l,c]=e.region,u=o.H.WGS84.cartographicToCartesian([(0,x.RW)(t),(0,x.RW)(a),l],F),d=o.H.WGS84.cartographicToCartesian([(0,x.RW)(r),(0,x.RW)(n),c],O),h=(new s.Z).addVectors(u,d).multiplyScalar(.5),p=(new s.Z).subVectors(u,d).len()/2;return U([h[0],h[1],h[2],p],new i.Z)}if(e.sphere)return U(e.sphere,t,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function H(e,t){if(e.box)return function(e){const t=L(),{halfAxes:n}=e,r=new s.Z(n.getColumn(0)),i=new s.Z(n.getColumn(1)),o=new s.Z(n.getColumn(2));for(let s=0;s<2;s++){for(let n=0;n<2;n++){for(let n=0;n<2;n++)I.copy(e.center),I.add(r),I.add(i),I.add(o),J(t,I),o.negate();i.negate()}r.negate()}return t}(t);if(e.region){const[t,n,r,i,s,o]=e.region;return[[(0,x.RW)(t),(0,x.RW)(n),s],[(0,x.RW)(r),(0,x.RW)(i),o]]}if(e.sphere)return function(e){const t=L(),{center:n,radius:r}=e,i=o.H.WGS84.scaleToGeodeticSurface(n,I);let a;a=i?o.H.WGS84.geodeticSurfaceNormal(i):new s.Z(0,0,1);let l=new s.Z(a[2],-a[1],0);l.len()>0?l.normalize():l=new s.Z(0,1,0);const c=l.clone().cross(a);for(const s of[l,c,a]){G.copy(s).scale(r);for(let e=0;e<2;e++)I.copy(n),I.add(G),J(t,I),G.negate()}return t}(t);throw new Error("Unkown boundingVolume type")}function U(e,t,n){const r=new s.Z(e[0],e[1],e[2]);t.transform(r,r);const i=t.getScale(G),o=Math.max(Math.max(i[0],i[1]),i[2]),a=e[3]*o;return R(n)?(n.center=r,n.radius=a,n):new f.KM(r,a)}function L(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function J(e,t){o.H.WGS84.cartesianToCartographic(t,I),e[0][0]=Math.min(e[0][0],I[0]),e[0][1]=Math.min(e[0][1],I[1]),e[0][2]=Math.min(e[0][2],I[2]),e[1][0]=Math.max(e[1][0],I[0]),e[1][1]=Math.max(e[1][1],I[1]),e[1][2]=Math.max(e[1][2],I[2])}new s.Z,new s.Z,new i.Z,new s.Z,new s.Z,new s.Z;function N(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){const n=e.dynamicScreenSpaceErrorComputedDensity,r=e.dynamicScreenSpaceErrorFactor,i=function(e,t){const n=e*t;return 1-Math.exp(-n*n)}(t,n)*r;return i}return 0}const Z=new s.Z,V=new s.Z,K=new s.Z,j=new s.Z,k=new s.Z,X=new i.Z,Q=new i.Z;function W(e,t){const{topDownViewport:n}=t,r=e.header.mbs[1],i=e.header.mbs[0],s=e.header.mbs[2],a=e.header.mbs[3],l=[...e.boundingVolume.center],c=n.unprojectPosition(n.cameraPosition);o.H.WGS84.cartographicToCartesian(c,Z),V.copy(Z).subtract(l).normalize(),o.H.WGS84.eastNorthUpToFixedFrame(l,X),Q.copy(X).invert(),K.copy(Z).transform(Q);const u=Math.sqrt(K[0]*K[0]+K[1]*K[1]),d=u*u/K[2];j.copy([K[0],K[1],d]);const h=j.transform(X).subtract(l).normalize(),p=V.cross(h).normalize().scale(a).add(l),m=o.H.WGS84.cartesianToCartographic(p),f=n.project([i,r,s]),A=n.project(m);return k.copy(f).subtract(A).magnitude()}class Y{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;(0,r.Z)(this,"_map",new Map),(0,r.Z)(this,"_array",void 0),(0,r.Z)(this,"_length",void 0),this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return(0,l.h)(e<this._array.length),this._array[e]}set(e,t){(0,l.h)(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){(0,l.h)(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){(0,l.h)(e>=0),this.length=e}trim(e){null==e&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const z={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class q{traversalFinished(e){return!0}constructor(e){(0,r.Z)(this,"options",void 0),(0,r.Z)(this,"root",void 0),(0,r.Z)(this,"requestedTiles",void 0),(0,r.Z)(this,"selectedTiles",void 0),(0,r.Z)(this,"emptyTiles",void 0),(0,r.Z)(this,"lastUpdate",(new Date).getTime()),(0,r.Z)(this,"updateDebounceTime",1e3),(0,r.Z)(this,"_traversalStack",void 0),(0,r.Z)(this,"_emptyTraversalStack",void 0),(0,r.Z)(this,"_frameNumber",void 0),this.options={...z,...e},this._traversalStack=new Y,this._emptyTraversalStack=new Y,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={}}traverse(e,t,n){this.root=e,this.options={...this.options,...n},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const n=this._traversalStack;for(e._selectionDepth=1,n.push(e);n.length>0;){const e=n.pop();let r=!1;this.canTraverse(e,t)&&(this.updateChildTiles(e,t),r=this.updateAndPushChildren(e,t,n,e.hasRenderContent?e._selectionDepth+1:e._selectionDepth));const i=e.parent,s=Boolean(!i||i._shouldRefine),o=!r;e.hasRenderContent?e.refine===D.F$.ADD?(this.loadTile(e,t),this.selectTile(e,t)):e.refine===D.F$.REPLACE&&(this.loadTile(e,t),o&&this.selectTile(e,t)):(this.emptyTiles[e.id]=e,this.loadTile(e,t),o&&this.selectTile(e,t)),this.touchTile(e,t),e._shouldRefine=r&&s}const r=(new Date).getTime();(this.traversalFinished(t)||r-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=r,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const n=e.children;for(const r of n)this.updateTile(r,t);return!0}updateAndPushChildren(e,t,n,r){const{loadSiblings:i,skipLevelOfDetail:s}=this.options,o=e.children;o.sort(this.compareDistanceToCamera.bind(this));const a=e.refine===D.F$.REPLACE&&e.hasRenderContent&&!s;let l=!1,c=!0;for(const u of o)if(u._selectionDepth=r,u.isVisibleAndInRequestVolume?(n.find(u)&&n.delete(u),n.push(u),l=!0):(a||i)&&(this.loadTile(u,t),this.touchTile(u,t)),a){let e;if(e=!!u._inRequestVolume&&(u.hasRenderContent?u.contentAvailable:this.executeEmptyTraversal(u,t)),c=c&&e,!c)return!1}return l||(c=!1),c}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return!!e.hasChildren&&(e.hasTilesetContent?!e.contentExpired:!(!r&&!e.isVisibleAndInRequestVolume)&&this.shouldRefine(e,t,n))}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t,n){let r=e._screenSpaceError;return n&&(r=e.getScreenSpaceError(t,!0)),r>this.options.maximumScreenSpaceError}updateTileVisibility(e,t){const n=[];if(this.options.viewportTraversersMap)for(const r in this.options.viewportTraversersMap){this.options.viewportTraversersMap[r]===t.viewport.id&&n.push(r)}else n.push(t.viewport.id);e.updateVisibility(t,n)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let n=!1;for(const r of e.children)r.updateVisibility(t),n=n||r.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(e,t){let n=!0;const r=this._emptyTraversalStack;for(r.push(e);r.length>0&&n;){const e=r.pop();this.updateTile(e,t),e.isVisibleAndInRequestVolume||this.loadTile(e,t),this.touchTile(e,t);if(!e.hasRenderContent&&this.canTraverse(e,t,!1,!0)){const t=e.children;for(const e of t)r.find(e)&&r.delete(e),r.push(e)}else e.contentAvailable||(n=!1)}return n}}const $=new s.Z;class ee{constructor(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";(0,r.Z)(this,"tileset",void 0),(0,r.Z)(this,"header",void 0),(0,r.Z)(this,"id",void 0),(0,r.Z)(this,"url",void 0),(0,r.Z)(this,"parent",void 0),(0,r.Z)(this,"refine",void 0),(0,r.Z)(this,"type",void 0),(0,r.Z)(this,"contentUrl",void 0),(0,r.Z)(this,"lodMetricType",void 0),(0,r.Z)(this,"lodMetricValue",void 0),(0,r.Z)(this,"boundingVolume",void 0),(0,r.Z)(this,"content",void 0),(0,r.Z)(this,"contentState",void 0),(0,r.Z)(this,"gpuMemoryUsageInBytes",void 0),(0,r.Z)(this,"children",void 0),(0,r.Z)(this,"depth",void 0),(0,r.Z)(this,"viewportIds",void 0),(0,r.Z)(this,"transform",void 0),(0,r.Z)(this,"extensions",void 0),(0,r.Z)(this,"implicitTiling",void 0),(0,r.Z)(this,"userData",void 0),(0,r.Z)(this,"computedTransform",void 0),(0,r.Z)(this,"hasEmptyContent",void 0),(0,r.Z)(this,"hasTilesetContent",void 0),(0,r.Z)(this,"traverser",void 0),(0,r.Z)(this,"_cacheNode",void 0),(0,r.Z)(this,"_frameNumber",void 0),(0,r.Z)(this,"_lodJudge",void 0),(0,r.Z)(this,"_expireDate",void 0),(0,r.Z)(this,"_expiredContent",void 0),(0,r.Z)(this,"_shouldRefine",void 0),(0,r.Z)(this,"_boundingBox",void 0),(0,r.Z)(this,"_distanceToCamera",void 0),(0,r.Z)(this,"_centerZDepth",void 0),(0,r.Z)(this,"_screenSpaceError",void 0),(0,r.Z)(this,"_visibilityPlaneMask",void 0),(0,r.Z)(this,"_visible",void 0),(0,r.Z)(this,"_inRequestVolume",void 0),(0,r.Z)(this,"_stackLength",void 0),(0,r.Z)(this,"_selectionDepth",void 0),(0,r.Z)(this,"_touchedFrame",void 0),(0,r.Z)(this,"_visitedFrame",void 0),(0,r.Z)(this,"_selectedFrame",void 0),(0,r.Z)(this,"_requestedFrame",void 0),(0,r.Z)(this,"_priority",void 0),(0,r.Z)(this,"_contentBoundingVolume",void 0),(0,r.Z)(this,"_viewerRequestVolume",void 0),(0,r.Z)(this,"_initialTransform",void 0),this.header=t,this.tileset=e,this.id=s||t.id,this.url=t.url,this.parent=n,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this.lodMetricType="geometricError",this.lodMetricValue=0,this.boundingVolume=null,this.content=null,this.contentState=D.Qb.UNLOADED,this.gpuMemoryUsageInBytes=0,this.children=[],this.hasEmptyContent=!1,this.hasTilesetContent=!1,this.depth=0,this.viewportIds=[],this.userData={},this.extensions=null,this._priority=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._screenSpaceError=0,this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this.traverser=new q({}),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._initialTransform=new i.Z,this.transform=new i.Z,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,this.implicitTiling=null,Object.seal(this)}destroy(){this.header=null}isDestroyed(){return null===this.header}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===D.Qb.READY||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===D.Qb.UNLOADED}get contentExpired(){return this.contentState===D.Qb.EXPIRED}get contentFailed(){return this.contentState===D.Qb.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=H(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case D.i3.I3S:return W(this,e);case D.i3.TILES3D:return function(e,t,n){const r=e.tileset,i=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,s=n?i:e.lodMetricValue;if(0===s)return 0;const o=Math.max(e._distanceToCamera,1e-7),{height:a,sseDenominator:l}=t,{viewDistanceScale:c}=r.options;let u=s*a*(c||1)/(o*l);return u-=N(r,o),u}(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,n=this.refine===D.F$.ADD||t;if(n&&!this.isVisible&&void 0!==this._visible)return-1;if(this.tileset._frameNumber-this._touchedFrame>=1)return-1;if(this.contentState===D.Qb.UNLOADED)return-1;const r=this.parent,i=r&&(!n||0===this._screenSpaceError||r.hasTilesetContent)?r._screenSpaceError:this._screenSpaceError,s=e.root?e.root._screenSpaceError:0;return Math.max(s-i,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=D.Qb.LOADING;const e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!e)return this.contentState=D.Qb.UNLOADED,!1;try{const e=this.tileset.getTileUrl(this.contentUrl),t=this.tileset.loader,n={...this.tileset.loadOptions,[t.id]:{...this.tileset.loadOptions[t.id],isTileset:"json"===this.type,...this._getLoaderSpecificOptions(t.id)}};return this.content=await(0,M.z)(e,t,n),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=D.Qb.READY,this._onContentLoaded(),!0}catch(t){throw this.contentState=D.Qb.FAILED,t}finally{e.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=D.Qb.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const n=this.parent,r=n?n._visibilityPlaneMask:f.Mh.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const e=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(e)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,r),this._visible=this._visibilityPlaneMask!==f.Mh.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:n}=e,{boundingVolume:r}=this;return n.computeVisibilityWithPlaneMask(r,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){let{camera:t}=e;const n=this.boundingVolume;return $.subVectors(n.center,t.position),t.direction.dot($)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=D.Qb.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new i.Z(e.transform):new i.Z;const t=this.parent,n=this.tileset,r=t&&t.computedTransform?t.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new i.Z(r).multiplyRight(this.transform);const s=t&&t._initialTransform?t._initialTransform.clone():new i.Z;this._initialTransform=new i.Z(s).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=D.Qb.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=f.Mh.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||D.F$.REPLACE}_isTileset(){return-1!==this.contentUrl.indexOf(".json")}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0}this._isTileset()&&(this.hasTilesetContent=!0)}_updateBoundingVolume(e){this.boundingVolume=P(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=P(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=P(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new i.Z).clone().multiplyRight(this.transform);!e.equals(this.computedTransform)&&(this.computedTransform=e,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){return"i3s"===e?{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1}:{assetGltfUpAxis:(t=this.tileset.tileset).asset&&t.asset.gltfUpAxis||"Y"};var t}}class te extends q{compareDistanceToCamera(e,t){return 0===t._distanceToCamera&&0===e._distanceToCamera?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const n=e.children.length>0;if(e.hasTilesetContent&&n){const n=e.children[0];return this.updateTileVisibility(n,t),void(e._visible=n._visible)}if(this.meetsScreenSpaceErrorEarly(e,t))return void(e._visible=!1);const r=e.refine===D.F$.REPLACE,i=e._optimChildrenWithinParent===D.fB.USE_OPTIMIZATION;r&&i&&n&&!this.anyChildrenVisible(e,t)&&(e._visible=!1)}meetsScreenSpaceErrorEarly(e,t){const{parent:n}=e;return!(!n||n.hasTilesetContent||n.refine!==D.F$.ADD)&&!this.shouldRefine(e,t,!0)}}class ne{constructor(){(0,r.Z)(this,"frameNumberMap",new Map)}register(e,t){const n=this.frameNumberMap.get(e)||new Map,r=n.get(t)||0;n.set(t,r+1),this.frameNumberMap.set(e,n)}deregister(e,t){const n=this.frameNumberMap.get(e);if(!n)return;const r=n.get(t)||1;n.set(t,r-1)}isZero(e,t){var n;return 0===((null===(n=this.frameNumberMap.get(e))||void 0===n?void 0:n.get(t))||0)}}const re="REQUESTED",ie="COMPLETED",se="ERROR";class oe{constructor(){(0,r.Z)(this,"_statusMap",void 0),(0,r.Z)(this,"pendingTilesRegister",new ne),this._statusMap={}}add(e,t,n,r){if(!this._statusMap[t]){const{frameNumber:i,viewport:{id:s}}=r;this._statusMap[t]={request:e,callback:n,key:t,frameState:r,status:re},this.pendingTilesRegister.register(s,i),e().then((e=>{this._statusMap[t].status=ie;const{frameNumber:n,viewport:{id:i}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(i,n),this._statusMap[t].callback(e,r)})).catch((e=>{this._statusMap[t].status=se;const{frameNumber:r,viewport:{id:i}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(i,r),n(e)}))}}update(e,t){if(this._statusMap[e]){const{frameNumber:n,viewport:{id:r}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(r,n);const{frameNumber:i,viewport:{id:s}}=t;this.pendingTilesRegister.register(s,i),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class ae extends q{constructor(e){super(e),(0,r.Z)(this,"_tileManager",void 0),this._tileManager=new oe}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,t){return e._lodJudge=function(e,t){if(0===e.lodMetricValue||isNaN(e.lodMetricValue))return"DIG";const n=2*W(e,t);return n<2?"OUT":!e.header.children||n<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}(e,t),"DIG"===e._lodJudge}updateChildTiles(e,t){const n=e.header.children||[],r=e.children,i=e.tileset;for(const s of n){const n="".concat(s.id,"-").concat(t.viewport.id),o=r&&r.find((e=>e.id===n));if(o)o&&this.updateTile(o,t);else{let r=()=>this._loadTile(s.id,i);this._tileManager.find(n)?this._tileManager.update(n,t):(i.tileset.nodePages&&(r=()=>i.tileset.nodePagesTile.formTileFromNodePages(s.id)),this._tileManager.add(r,n,(t=>this._onTileLoad(t,e,n)),t))}}return!1}async _loadTile(e,t){const{loader:n}=t,r=t.getTileUrl("".concat(t.url,"/nodes/").concat(e)),i={...t.loadOptions,i3s:{...t.loadOptions.i3s,isTileHeader:!0}};return await(0,M.z)(r,n,i)}_onTileLoad(e,t,n){const r=new ee(t.tileset,e,t,n);t.children.push(r);const i=this._tileManager.find(r.id).frameState;this.updateTile(r,i),this._frameNumber===i.frameNumber&&(this.traversalFinished(i)||(new Date).getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(r,i)}}const le={description:"",ellipsoid:o.H.WGS84,modelMatrix:new i.Z,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:e=>e,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},ce="Tiles In Tileset(s)",ue="Tiles In Memory",de="Tiles In View",he="Tiles To Render",pe="Tiles Loaded",me="Tiles Loading",fe="Tiles Unloaded",Ae="Failed Tile Loads",ge="Points/Vertices",Be="Tile Memory Use";class Ce{constructor(e,t){(0,r.Z)(this,"options",void 0),(0,r.Z)(this,"loadOptions",void 0),(0,r.Z)(this,"type",void 0),(0,r.Z)(this,"tileset",void 0),(0,r.Z)(this,"loader",void 0),(0,r.Z)(this,"url",void 0),(0,r.Z)(this,"basePath",void 0),(0,r.Z)(this,"modelMatrix",void 0),(0,r.Z)(this,"ellipsoid",void 0),(0,r.Z)(this,"lodMetricType",void 0),(0,r.Z)(this,"lodMetricValue",void 0),(0,r.Z)(this,"refine",void 0),(0,r.Z)(this,"root",void 0),(0,r.Z)(this,"roots",void 0),(0,r.Z)(this,"asset",void 0),(0,r.Z)(this,"description",void 0),(0,r.Z)(this,"properties",void 0),(0,r.Z)(this,"extras",void 0),(0,r.Z)(this,"attributions",void 0),(0,r.Z)(this,"credits",void 0),(0,r.Z)(this,"stats",void 0),(0,r.Z)(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),(0,r.Z)(this,"traverseCounter",void 0),(0,r.Z)(this,"geometricError",void 0),(0,r.Z)(this,"selectedTiles",void 0),(0,r.Z)(this,"updatePromise",null),(0,r.Z)(this,"tilesetInitializationPromise",void 0),(0,r.Z)(this,"cartographicCenter",void 0),(0,r.Z)(this,"cartesianCenter",void 0),(0,r.Z)(this,"zoom",void 0),(0,r.Z)(this,"boundingVolume",void 0),(0,r.Z)(this,"gpuMemoryUsageInBytes",void 0),(0,r.Z)(this,"dynamicScreenSpaceErrorComputedDensity",void 0),(0,r.Z)(this,"_traverser",void 0),(0,r.Z)(this,"_cache",void 0),(0,r.Z)(this,"_requestScheduler",void 0),(0,r.Z)(this,"_frameNumber",void 0),(0,r.Z)(this,"_queryParamsString",void 0),(0,r.Z)(this,"_queryParams",void 0),(0,r.Z)(this,"_extensionsUsed",void 0),(0,r.Z)(this,"_tiles",void 0),(0,r.Z)(this,"_pendingCount",void 0),(0,r.Z)(this,"lastUpdatedVieports",void 0),(0,r.Z)(this,"_requestedTiles",void 0),(0,r.Z)(this,"_emptyTiles",void 0),(0,r.Z)(this,"frameStateData",void 0),(0,r.Z)(this,"maximumMemoryUsage",void 0),(0,l.h)(e),this.options={...le,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||c.XX(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this.root=null,this.roots={},this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this.traverseCounter=0,this.geometricError=0,this._traverser=this._initializeTraverser(),this._cache=new m,this._requestScheduler=new u.Z({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this._frameNumber=0,this._pendingCount=0,this._tiles={},this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this.frameStateData={},this.lastUpdatedVieports=null,this._queryParams={},this._queryParamsString="",this.maximumMemoryUsage=this.options.maximumMemoryUsage||32,this.gpuMemoryUsageInBytes=0,this.stats=new a.Z({id:this.url}),this._initializeStats(),this._extensionsUsed=void 0,this.dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description||"",this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return 0===this._pendingCount&&0!==this._frameNumber&&0===this._requestedTiles.length}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return this._queryParamsString||(this._queryParamsString=function(e){const t=[];for(const n of Object.keys(e))t.push("".concat(n,"=").concat(e[n]));switch(t.length){case 0:return"";case 1:return"?".concat(t[0]);default:return"?".concat(t.join("&"))}}(this._queryParams)),this._queryParamsString}setProps(e){this.options={...this.options,...e}}setOptions(e){this.options={...this.options,...e}}getTileUrl(e){return e.startsWith("data:")?e:"".concat(e).concat(this.queryParams)}hasExtension(e){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(e)>-1)}update(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.tilesetInitializationPromise.then((()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)}))}async selectTiles(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise((e=>{setTimeout((()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),e(this._frameNumber),this.updatePromise=null}),this.options.debounceTime)}))),this.updatePromise}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles)return;if(this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const n=[];for(const r of t){const e=r.id;this._needTraverse(e)?n.push(e):this.traverseCounter--}for(const r of t){const e=r.id;if(this.roots[e]||(this.roots[e]=this._initializeTileHeaders(this.tileset,null)),!n.includes(e))continue;const t=C(r,this._frameNumber);this._traverser.traverse(this.roots[e],t,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[t],r=Object.values(this._traverser.selectedTiles),[i,s]=function(e,t,n){if(0===n||e.length<=n)return[e,[]];const r=[],{longitude:i,latitude:s}=t.viewport;for(const[c,u]of e.entries()){const[e,t]=u.header.mbs,n=Math.abs(i-e),o=Math.abs(s-t),a=Math.sqrt(o*o+n*n);r.push([c,a])}const o=r.sort(((e,t)=>e[1]-t[1])),a=[];for(let c=0;c<n;c++)a.push(e[o[c][0]]);const l=[];for(let c=n;c<o.length;c++)l.push(e[o[c][0]]);return[a,l]}(r,e,this.options.maximumTilesSelected);n.selectedTiles=i;for(const o of s)o.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,this.traverseCounter>0||this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const n=new Set(e.map((e=>e.id))),r=new Set(t.map((e=>e.id)));let i=e.filter((e=>!r.has(e.id))).length>0;return i=i||t.filter((e=>!n.has(e.id))).length>0,i}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,((e,t)=>e._unloadTile(t)))}_updateStats(){let e=0,t=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(e++,n.content.pointCount?t+=n.content.pointCount:t+=n.content.vertexCount);this.stats.get(de).count=this.selectedTiles.length,this.stats.get(he).count=e,this.stats.get(ge).count=t}async _initializeTileSet(e){this.type===D.i3.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===D.i3.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===D.i3.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var e;const t=this.tileset.fullExtent;if(t){const{xmin:e,xmax:n,ymin:r,ymax:i,zmin:a,zmax:l}=t;return this.cartographicCenter=new s.Z(e+(n-e)/2,r+(i-r)/2,a+(l-a)/2),this.cartesianCenter=o.H.WGS84.cartographicToCartesian(this.cartographicCenter,new s.Z),void(this.zoom=S(t,this.cartographicCenter,this.cartesianCenter))}const n=null===(e=this.tileset.store)||void 0===e?void 0:e.extent;if(n){const[e,t,r,i]=n;return this.cartographicCenter=new s.Z(e+(r-e)/2,t+(i-t)/2,0),this.cartesianCenter=o.H.WGS84.cartographicToCartesian(this.cartographicCenter,new s.Z),void(this.zoom=function(e,t,n){const[r,i,s,o]=e;return S({xmin:r,xmax:s,ymin:i,ymax:o,zmin:0,zmax:0},t,n)}(n,this.cartographicCenter,this.cartesianCenter))}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new s.Z,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root;(0,l.h)(e);const{center:t}=e.boundingVolume;if(!t)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new s.Z,void(this.zoom=1);0!==t[0]||0!==t[1]||0!==t[2]?this.cartographicCenter=o.H.WGS84.cartesianToCartographic(t,new s.Z):this.cartographicCenter=new s.Z(0,0,-o.H.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=T(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(ce),this.stats.get(me),this.stats.get(ue),this.stats.get(de),this.stats.get(he),this.stats.get(pe),this.stats.get(fe),this.stats.get(Ae),this.stats.get(ge),this.stats.get(Be,"memory")}_initializeTileHeaders(e,t){const n=new ee(this,e.root,t);if(t&&(t.children.push(n),n.depth=t.depth+1),this.type===D.i3.TILES3D){const e=[];for(e.push(n);e.length>0;){const t=e.pop();this.stats.get(ce).incrementCount();const n=t.header.children||[];for(const r of n){const n=new ee(this,r,t);t.children.push(n),n.depth=t.depth+1,e.push(n)}}}return n}_initializeTraverser(){let e;switch(this.type){case D.i3.TILES3D:e=te;break;case D.i3.I3S:e=ae;break;default:e=q}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(n){this._onTileLoadError(e,n)}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(Ae).incrementCount();const n=t.message||t.toString(),r=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(n)),this.options.onTileError(e,n,r)}_onTileLoad(e,t){if(t){if(this.type===D.i3.I3S){var n,r;const e=(null===(n=this.tileset)||void 0===n||null===(r=n.nodePagesTile)||void 0===r?void 0:r.nodesInNodePages)||0;this.stats.get(ce).reset(),this.stats.get(ce).addCount(e)}e&&e.content&&function(e,t){(0,l.h)(e),(0,l.h)(t);const{rtcCenter:n,gltfUpAxis:r}=t,{computedTransform:a,boundingVolume:{center:c}}=e;let u=new i.Z(a);switch(n&&u.translate(n),r){case"Z":default:break;case"Y":const e=(new i.Z).rotateX(Math.PI/2);u=u.multiplyRight(e);break;case"X":const t=(new i.Z).rotateY(-Math.PI/2);u=u.multiplyRight(t)}t.isQuantized&&u.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const d=new s.Z(c);t.cartesianModelMatrix=u,t.cartesianOrigin=d;const h=o.H.WGS84.cartesianToCartographic(d,new s.Z),p=o.H.WGS84.eastNorthUpToFixedFrame(d).invert();t.cartographicModelMatrix=p.multiplyRight(u),t.cartographicOrigin=h,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===D.i3.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0}else if(this.type===D.i3.TILES3D){var t;const{extensionsRemoved:n=[]}=(null===(t=e.content)||void 0===t?void 0:t.gltf)||{};n.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),n.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),n.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(me).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(me).decrementCount()}_addTileToCache(e){this._cache.add(this,e,(t=>t._updateCacheStats(e)))}_updateCacheStats(e){this.stats.get(pe).incrementCount(),this.stats.get(ue).incrementCount(),this.gpuMemoryUsageInBytes+=e.content.byteLength||0,this.stats.get(Be).count=this.gpuMemoryUsageInBytes}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.content&&e.content.byteLength||0,this.stats.get(ue).decrementCount(),this.stats.get(fe).incrementCount(),this.stats.get(Be).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const n of t.children)e.push(n);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,n=[];for(n.push(t);n.length>0;){e=n.pop();for(const t of e.children)n.push(t);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed,this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}},49125:()=>{}}]);