"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[8424],{77045:(t,e,n)=>{n.d(e,{Z:()=>l});var i=n(4942),s=n(66507),r=n(14034),o=n(78866);const a=["bearing","pitch"],c={speed:1.2,curve:1.414};class l extends s.Z{constructor(t={}){super({compare:["longitude","latitude","zoom","bearing","pitch"],extract:["width","height","longitude","latitude","zoom","bearing","pitch"],required:["width","height","latitude","longitude","zoom"]}),(0,i.Z)(this,"opts",void 0),this.opts={...c,...t}}interpolateProps(t,e,n){const i=(0,o.if)(t,e,n,this.opts);for(const s of a)i[s]=(0,r.t7)(t[s]||0,e[s]||0,n);return i}getDuration(t,e){let{transitionDuration:n}=e;return"auto"===n&&(n=(0,o.up)(t,e,this.opts)),n}}},81547:(t,e,n)=>{n.d(e,{Z:()=>I});var i=n(4942),s=n(53982),r=n(78918),o=n(80744),a=n(24088),c=n(33648),l=n(27458),u=n(93844),h=n(59965),d=n(1418),p=n(49764),m=n(44522),f=n(66610),y=n(5016);async function g(t){const e=[];return t.scenes.forEach((t=>{t.traverse((t=>{Object.values(t.model.getUniforms()).forEach((t=>{!1===t.loaded&&e.push(t)}))}))})),await async function(t){for(;t();)await new Promise((t=>requestAnimationFrame(t)))}((()=>e.some((t=>!t.loaded))))}var _=n(17805);const b=[255,255,255,255],v={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?"object"==typeof t.scene?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:b},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[y.E]};class T extends l.Z{constructor(...t){super(...t),(0,i.Z)(this,"state",void 0)}getShaders(){const t=[u.Z,h.Z];return"pbr"===this.props._lighting&&t.push(p.b),{vs:"#version 300 es\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nin vec3 instanceTranslation;\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform mat4 sceneModelMatrix;\nuniform bool composeModelMatrix;\nin vec4 POSITION;\n\n#ifdef HAS_UV\n  in vec2 TEXCOORD_0;\n#endif\n\n#ifdef MODULE_PBR\n  #ifdef HAS_NORMALS\n    in vec4 NORMAL;\n  #endif\n#endif\nout vec4 vColor;\n#ifndef MODULE_PBR\n  #ifdef HAS_UV\n    out vec2 vTEXCOORD_0;\n  #endif\n#endif\nvoid main(void) {\n  #if defined(HAS_UV) && !defined(MODULE_PBR)\n    vTEXCOORD_0 = TEXCOORD_0;\n    geometry.uv = vTEXCOORD_0;\n  #endif\n\n  geometry.worldPosition = instancePositions;\n  geometry.pickingColor = instancePickingColors;\n\n  vec3 normal = vec3(0.0, 0.0, 1.0);\n  #ifdef MODULE_PBR\n    #ifdef HAS_NORMALS\n      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;\n    #endif\n  #endif\n\n  float originalSize = project_size_to_pixel(sizeScale);\n  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);\n\n  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;\n  if(composeModelMatrix) {\n    DECKGL_FILTER_SIZE(pos, geometry);\n    geometry.normal = project_normal(normal);\n    geometry.worldPosition += pos;\n    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n  }\n  else {\n    pos = project_size(pos);\n    DECKGL_FILTER_SIZE(pos, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);\n    geometry.normal = project_normal(normal);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  #ifdef MODULE_PBR\n    pbr_vPosition = geometry.position.xyz;\n    #ifdef HAS_NORMALS\n      pbr_vNormal = geometry.normal;\n    #endif\n\n    #ifdef HAS_UV\n      pbr_vUV = TEXCOORD_0;\n    #else\n      pbr_vUV = vec2(0., 0.);\n    #endif\n    geometry.uv = pbr_vUV;\n  #endif\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\nuniform float opacity;\nin vec4 vColor;\n\nout vec4 fragmentColor;\n#ifndef MODULE_PBR\n  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)\n    in vec2 vTEXCOORD_0;\n    uniform sampler2D u_BaseColorSampler;\n  #endif\n#endif\n\nvoid main(void) {\n  #ifdef MODULE_PBR\n    fragmentColor = vColor * pbr_filterColor(vec4(0));\n    geometry.uv = pbr_vUV;\n  #else\n    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)\n      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);\n      geometry.uv = vTEXCOORD_0;\n    #else\n      fragmentColor = vColor;\n    #endif\n  #endif\n\n  fragmentColor.a *= opacity;\n  DECKGL_FILTER_COLOR(fragmentColor, geometry);\n}\n",modules:t}}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:b,transition:!0},instanceModelMatrix:_.P})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;e.scenegraph!==n.scenegraph?this._updateScenegraph():e._animations!==n._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,e._animations)}finalizeState(t){super.finalizeState(t),this._deleteScenegraph()}_updateScenegraph(){const t=this.props,{gl:e}=this.context;let n=null;if(t.scenegraph instanceof m.Z)n={scenes:[t.scenegraph]};else if(t.scenegraph&&!t.scenegraph.gltf){const i=t.scenegraph,s=(0,f.Z)(e,i,this._getModelOptions());n={gltf:i,...s},g(s).then((()=>this.setNeedsRedraw()))}else t.scenegraph&&(o.Z.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),n=t.scenegraph);const i={layer:this,gl:e},s=t.getScene(n,i),r=t.getAnimator(n,i);s instanceof m.Z?(this._deleteScenegraph(),this._applyAllAttributes(s),this._applyAnimationsProp(s,r,t._animations),this.setState({scenegraph:s,animator:r})):null!==s&&o.Z.warn("invalid scenegraph:",s)()}_applyAllAttributes(t){if(this.state.attributesAvailable){const e=this.getAttributeManager().getAttributes();t.traverse((t=>{this._setModelAttributes(t.model,e)}))}}_applyAnimationsProp(t,e,n){if(!t||!e||!n)return;const i=e.getAnimations();Object.keys(n).sort().forEach((t=>{const e=n[t];if("*"===t)i.forEach((t=>{Object.assign(t,e)}));else if(Number.isFinite(Number(t))){const n=Number(t);n>=0&&n<i.length?Object.assign(i[n],e):o.Z.warn("animation ".concat(t," not found"))()}else{const n=i.find((({name:e})=>e===t));n?Object.assign(n,e):o.Z.warn("animation ".concat(t," not found"))()}}))}_deleteScenegraph(){const{scenegraph:t}=this.state;t instanceof m.Z&&t.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:t}=this.props;let e=null;return t&&(e="function"==typeof t?t({gl:this.context.gl,layer:this}):t),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:e,modelOptions:{isInstanced:!0,transpileToGLSL100:!(0,d.D0)(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(t){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse((e=>{this._setModelAttributes(e.model,t)}))}draw({moduleParameters:t=null,parameters:e={},context:n}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(n.timeline.getTime()),this.setNeedsRedraw());const{viewport:i}=this.context,{sizeScale:s,sizeMinPixels:r,sizeMaxPixels:o,opacity:a,coordinateSystem:c}=this.props,l=this.getNumInstances();this.state.scenegraph.traverse(((n,{worldMatrix:u})=>{n.model.setInstanceCount(l),n.updateModuleSettings(t),n.draw({parameters:e,uniforms:{sizeScale:s,opacity:a,sizeMinPixels:r,sizeMaxPixels:o,composeModelMatrix:(0,_.X)(i,c),sceneModelMatrix:u,u_Camera:n.model.getUniforms().project_uCameraPosition}})}))}}(0,i.Z)(T,"defaultProps",v),(0,i.Z)(T,"layerName","ScenegraphLayer");var S=n(61307),O=n(15462),w=n(65217);class C extends w.Z{getShaders(){const t=super.getShaders();return t.modules.push(p.b),{...t,vs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nuniform float sizeScale;\nuniform bool composeModelMatrix;\nuniform bool pickFeatureIds;\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec4 uvRegions;\nin vec3 featureIdsPickingColors;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\n\nvec2 applyUVRegion(vec2 uv) {\n  #ifdef HAS_UV_REGIONS\n    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;\n  #else\n    return uv;\n  #endif\n}\n\nvoid main(void) {\n  vec2 uv = applyUVRegion(texCoords);\n  geometry.uv = uv;\n\n  if (pickFeatureIds) {\n    geometry.pickingColor = featureIdsPickingColors;\n  } else {\n    geometry.pickingColor = instancePickingColors;\n  }\n\n  vTexCoord = uv;\n  cameraPosition = project_uCameraPosition;\n  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);\n\n  vec3 pos = (instanceModelMatrix * positions) * sizeScale;\n  vec3 projectedPosition = project_position(positions);\n  position_commonspace = vec4(projectedPosition, 1.0);\n  gl_Position = project_common_position_to_clipspace(position_commonspace);\n\n  geometry.position = position_commonspace;\n  normals_commonspace = project_normal(instanceModelMatrix * normals);\n  geometry.normal = normals_commonspace;\n\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  #ifdef MODULE_PBR\n    pbr_vPosition = geometry.position.xyz;\n    #ifdef HAS_NORMALS\n      pbr_vNormal = geometry.normal;\n    #endif\n\n    #ifdef HAS_UV\n      pbr_vUV = uv;\n    #else\n      pbr_vUV = vec2(0., 0.);\n    #endif\n    geometry.uv = pbr_vUV;\n  #endif\n\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\n\nprecision highp float;\n\nuniform bool hasTexture;\nuniform sampler2D sampler;\nuniform bool flatShading;\nuniform float opacity;\n\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  \n#ifdef MODULE_PBR\n\n  fragColor = vColor * pbr_filterColor(vec4(0));\n  geometry.uv = pbr_vUV;\n  fragColor.a *= opacity;\n\n#else\n\n  geometry.uv = vTexCoord;\n\n  vec3 normal;\n  if (flatShading) {\n#ifdef DERIVATIVES_AVAILABLE\n    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n  } else {\n    normal = normals_commonspace;\n  }\n\n  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;\n  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\n  fragColor = vec4(lightColor, color.a * opacity);\n\n#endif\n\n  DECKGL_FILTER_COLOR(fragColor, geometry);\n}\n"}}initializeState(){const{featureIds:t}=this.props;super.initializeState();const e=this.getAttributeManager();t&&e.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;e.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(e.pbrMaterial)}draw(t){const{featureIds:e}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:Boolean(e)}),super.draw(t))}getModel(t){const{id:e,pbrMaterial:n}=this.props,i=this.parseMaterial(n,t);this.setState({materialParser:i});const s=this.getShaders();var r;(r=t.attributes).COLOR_0||r.colors||(r.colors={constant:!0,value:new Float32Array([1,1,1])});return new O.Z(this.context.gl,{...this.getShaders(),id:e,geometry:t,defines:{...s.defines,...null==i?void 0:i.defines,HAS_UV_REGIONS:t.attributes.uvRegions},parameters:null==i?void 0:i.parameters,isInstanced:!0})}updatePbrMaterialUniforms(t){const{model:e}=this.state;if(e){const{mesh:n}=this.props,i=this.parseMaterial(t,n);this.setState({materialParser:i}),e.setUniforms(i.uniforms)}}parseMaterial(t,e){var n;const i=Boolean(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture);return null===(n=this.state.materialParser)||void 0===n||n.delete(),new S.Z(this.context.gl,{attributes:{NORMAL:e.attributes.normals,TEXCOORD_0:e.attributes.texCoords},material:{unlit:i,...t},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(t){const e=this.props.featureIds,n=new Uint8ClampedArray(e.length*t.size),i=[];for(let s=0;s<e.length;s++)this.encodePickingColor(e[s],i),n[3*s]=i[0],n[3*s+1]=i[1],n[3*s+2]=i[2];t.value=n}finalizeState(t){var e;super.finalizeState(t),null===(e=this.state.materialParser)||void 0===e||e.delete(),this.setState({materialParser:null})}}(0,i.Z)(C,"layerName","MeshLayer"),(0,i.Z)(C,"defaultProps",{pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}});var E=n(37258),A=n(53280),P=n(33406),x=n(5976);const M=[0],L={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:x.u,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,n)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}};class I extends r.Z{constructor(...t){super(...t),(0,i.Z)(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&o.Z.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){const{tileset3d:t}=this.state;return null!==t&&t.isLoaded()}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({props:t,oldProps:e,changeFlags:n}){if(t.data&&t.data!==e.data&&this._loadTileset(t.data),n.viewportChanged){const{activeViewports:t}=this.state;Object.keys(t).length&&(this._updateTileset(t),this.state.lastUpdatedViewports=t,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:t}=this.state;for(const e in t)t[e].needsUpdate=!0}}activateViewport(t){const{activeViewports:e,lastUpdatedViewports:n}=this.state;this.internalState.viewport=t,e[t.id]=t;const i=null==n?void 0:n[t.id];i&&t.equals(i)||(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:t,sourceLayer:e}){const n=e&&e.props.tile;return t.picked&&(t.object=n),t.sourceTile=n,t}filterSubLayer({layer:t,viewport:e}){const{tile:n}=t.props,{id:i}=e;return n.selected&&n.viewportIds.includes(i)}_updateAutoHighlight(t){const e=t.sourceTile,n=this.state.layerMap[null==e?void 0:e.id];n&&n.layer&&n.layer.updateAutoHighlight(t)}async _loadTileset(t){const{loadOptions:e={}}=this.props;let n=this.props.loader||this.props.loaders;Array.isArray(n)&&(n=n[0]);const i={loadOptions:{...e}};if(n.preload){const s=await n.preload(t,e);s.headers&&(i.loadOptions.fetch={...i.loadOptions.fetch,headers:s.headers}),Object.assign(i,s)}const s=await(0,E.z)(t,n,i.loadOptions),r=new A.u(s,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...i});this.setState({tileset3d:r,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(r)}_onTileLoad(t){const{lastUpdatedViewports:e}=this.state;this.props.onTileLoad(t),this._updateTileset(e),this.setNeedsUpdate()}_onTileUnload(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}_updateTileset(t){if(!t)return;const{tileset3d:e}=this.state,{timeline:n}=this.context,i=Object.keys(t).length;n&&i&&e&&e.selectTiles(Object.values(t)).then((t=>{this.state.frameNumber!==t&&this.setState({frameNumber:t})}))}_getSubLayer(t,e){if(!t.content)return null;switch(t.type){case P.R7.POINTCLOUD:return this._makePointCloudLayer(t,e);case P.R7.SCENEGRAPH:return this._make3DModelLayer(t);case P.R7.MESH:return this._makeSimpleMeshLayer(t,e);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(t.content.type))}}_makePointCloudLayer(t,e){const{attributes:n,pointCount:i,constantRGBA:s,cartographicOrigin:r,modelMatrix:o}=t.content,{positions:l,normals:u,colors:h}=n;if(!l)return null;const d=e&&e.props.data||{header:{vertexCount:i},attributes:{POSITION:l,NORMAL:u,COLOR_0:h}},{pointSize:p,getPointColor:m}=this.props;return new(this.getSubLayerClass("pointcloud",c.Z))({pointSize:p},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(t.id),tile:t,data:d,coordinateSystem:a.Df.METER_OFFSETS,coordinateOrigin:r,modelMatrix:o,getColor:s||m,_offset:0})}_make3DModelLayer(t){const{gltf:e,instances:n,cartographicOrigin:i,modelMatrix:s}=t.content;return new(this.getSubLayerClass("scenegraph",T))({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(t.id),tile:t,data:n||M,scenegraph:e,coordinateSystem:a.Df.METER_OFFSETS,coordinateOrigin:i,modelMatrix:s,getTransformMatrix:t=>t.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(t,e){const n=t.content,{attributes:i,indices:r,modelMatrix:o,cartographicOrigin:c,coordinateSystem:l=a.Df.METER_OFFSETS,material:u,featureIds:h}=n,{_getMeshColor:d}=this.props,p=e&&e.props.mesh||new s.Z({drawMode:4,attributes:N(i),indices:r});return new(this.getSubLayerClass("mesh",C))(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(t.id),tile:t,mesh:p,data:M,getColor:d(t),pbrMaterial:u,modelMatrix:o,coordinateOrigin:c,coordinateSystem:l,featureIds:h,_offset:0})}renderLayers(){const{tileset3d:t,layerMap:e}=this.state;return t?t.tiles.map((t=>{const n=e[t.id]=e[t.id]||{tile:t};let{layer:i}=n;return t.selected&&(i?n.needsUpdate&&(i=this._getSubLayer(t,i),n.needsUpdate=!1):i=this._getSubLayer(t)),n.layer=i,i})).filter(Boolean):null}}function N(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}(0,i.Z)(I,"defaultProps",L),(0,i.Z)(I,"layerName","Tile3DLayer")},33648:(t,e,n)=>{n.d(e,{Z:()=>m});var i=n(4942),s=n(27458),r=n(93844),o=n(8674),a=n(59965),c=n(24088),l=n(15462),u=n(53982);const h=[0,0,0,255],d=[0,0,1],p={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:d},getColor:{type:"accessor",value:h},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};class m extends s.Z{getShaders(){return super.getShaders({vs:"#define SHADER_NAME point-cloud-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceNormals;\nattribute vec4 instanceColors;\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusPixels;\nuniform int sizeUnits;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.normal = project_normal(instanceNormals);\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n  vColor = vec4(lightColor, instanceColors.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME point-cloud-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[r.Z,o.N,a.Z]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:d},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:h}})}updateState(t){const{changeFlags:e,props:n}=t;if(super.updateState(t),e.extensionsChanged){var i;const{gl:t}=this.context;null===(i=this.state.model)||void 0===i||i.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll()}e.dataChanged&&function(t){const{header:e,attributes:n}=t;e&&n&&(t.length=e.vertexCount,n.POSITION&&(n.instancePositions=n.POSITION),n.NORMAL&&(n.instanceNormals=n.NORMAL),n.COLOR_0&&(n.instanceColors=n.COLOR_0))}(n.data)}draw({uniforms:t}){const{pointSize:e,sizeUnits:n}=this.props;this.state.model.setUniforms(t).setUniforms({sizeUnits:c.iI[n],radiusPixels:e}).draw()}_getModel(t){const e=[];for(let n=0;n<3;n++){const t=n/3*Math.PI*2;e.push(2*Math.cos(t),2*Math.sin(t),0)}return new l.Z(t,{...this.getShaders(),id:this.props.id,geometry:new u.Z({drawMode:4,attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}(0,i.Z)(m,"layerName","PointCloudLayer"),(0,i.Z)(m,"defaultProps",p)},65217:(t,e,n)=>{n.d(e,{Z:()=>v});var i=n(4942),s=n(80744),r=n(27458),o=n(93844),a=n(8674),c=n(59965),l=n(53982),u=n(1418),h=n(51621),d=n(15462),p=n(44211),m=n(6948),f=n(17805);var y=n(61569);function g(t,e){(t.COLOR_0||t.colors)&&e||(t.colors={constant:!0,value:new Float32Array([1,1,1])}),s.Z.assert(t.positions||t.POSITION,'no "postions" or "POSITION" attribute in mesh')}function _(t,e){if(t.attributes)return g(t.attributes,e),t instanceof l.Z?t:new l.Z(t);if(t.positions||t.POSITION)return g(t,e),new l.Z({attributes:t});throw Error("Invalid mesh")}const b={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class v extends r.Z{constructor(...t){super(...t),(0,i.Z)(this,"state",void 0)}getShaders(){const t=!(0,u.D0)(this.context.gl),e={};return(0,p.U6)(this.context.gl,m.h.GLSL_DERIVATIVES)&&(e.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nuniform float sizeScale;\nuniform bool composeModelMatrix;\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nin vec3 instanceTranslation;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = instancePickingColors;\n\n  vTexCoord = texCoords;\n  cameraPosition = project_uCameraPosition;\n  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);\n\n  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;\n\n  if (composeModelMatrix) {\n    DECKGL_FILTER_SIZE(pos, geometry);\n    normals_commonspace = project_normal(instanceModelMatrix * normals);\n    geometry.worldPosition += pos;\n    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);\n    geometry.position = position_commonspace;\n  }\n  else {\n    pos = project_size(pos);\n    DECKGL_FILTER_SIZE(pos, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);\n    geometry.position = position_commonspace;\n    normals_commonspace = project_normal(instanceModelMatrix * normals);\n  }\n\n  geometry.normal = normals_commonspace;\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\n\nprecision highp float;\n\nuniform bool hasTexture;\nuniform sampler2D sampler;\nuniform bool flatShading;\nuniform float opacity;\n\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  geometry.uv = vTexCoord;\n\n  vec3 normal;\n  if (flatShading) {\n#ifdef DERIVATIVES_AVAILABLE\n    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n  } else {\n    normal = normals_commonspace;\n  }\n\n  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;\n  DECKGL_FILTER_COLOR(color, geometry);\n\n  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\n  fragColor = vec4(lightColor, color.a * opacity);\n}\n",modules:[o.Z,a.s,c.Z],transpileToGLSL100:t,defines:e})}getBounds(){var t;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:n}=this.props;if(!n)return null;if(e=null===(t=n.header)||void 0===t?void 0:t.boundingBox,!e){const{attributes:t}=_(n,this.props._useMeshColors);t.POSITION=t.POSITION||t.positions,e=(0,y.v)(t)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:f.P}),this.setState({emptyTexture:new h.Z(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(t){super.updateState(t);const{props:e,oldProps:n,changeFlags:i}=t;if(e.mesh!==n.mesh||i.extensionsChanged){var s;if(this.state.positionBounds=null,null===(s=this.state.model)||void 0===s||s.delete(),e.mesh){this.state.model=this.getModel(e.mesh);const t=e.mesh.attributes||e.mesh;this.setState({hasNormals:Boolean(t.NORMAL||t.normals)})}this.getAttributeManager().invalidateAll()}e.texture!==n.texture&&this.setTexture(e.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw({uniforms:t}){if(!this.state.model)return;const{viewport:e}=this.context,{sizeScale:n,coordinateSystem:i,_instanced:s}=this.props;this.state.model.setUniforms(t).setUniforms({sizeScale:n,composeModelMatrix:!s||(0,f.X)(e,i),flatShading:!this.state.hasNormals}).draw()}getModel(t){const e=new d.Z(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:_(t,this.props._useMeshColors),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:i}=this.state;return e.setUniforms({sampler:n||i,hasTexture:Boolean(n)}),e}setTexture(t){const{emptyTexture:e,model:n}=this.state;n&&n.setUniforms({sampler:t||e,hasTexture:Boolean(t)})}}(0,i.Z)(v,"defaultProps",b),(0,i.Z)(v,"layerName","SimpleMeshLayer")},17805:(t,e,n)=>{n.d(e,{P:()=>u,X:()=>h});var i=n(38550),s=n(24088);const r=Math.PI/180,o=new Float32Array(16),a=new Float32Array(12);function c(t,e,n){const i=e[0]*r,s=e[1]*r,o=e[2]*r,a=Math.sin(o),c=Math.sin(i),l=Math.sin(s),u=Math.cos(o),h=Math.cos(i),d=Math.cos(s),p=n[0],m=n[1],f=n[2];t[0]=p*d*h,t[1]=p*l*h,t[2]=p*-c,t[3]=m*(-l*u+d*c*a),t[4]=m*(d*u+l*c*a),t[5]=m*h*a,t[6]=f*(l*a+d*c*u),t[7]=f*(-d*a+l*c*u),t[8]=f*h*u}function l(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const u={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:n}){const{data:s,getOrientation:r,getScale:u,getTranslation:h,getTransformMatrix:d}=this.props,p=Array.isArray(d),m=p&&16===d.length,f=Array.isArray(u),y=Array.isArray(r),g=Array.isArray(h),_=m||!p&&Boolean(d(s[0]));t.constant=_?m:y&&f&&g;const b=t.value;if(t.constant){let e;if(_)o.set(d),e=l(o);else{e=a;c(e,r,u),e.set(h,9)}t.value=new Float32Array(e)}else{let p=e*t.size;const{iterable:v,objectInfo:T}=(0,i.jB)(s,e,n);for(const t of v){let e;if(T.index++,_)o.set(m?d:d(t,T)),e=l(o);else{e=a;c(e,y?r:r(t,T),f?u:u(t,T)),e.set(g?h:h(t,T),9)}b[p++]=e[0],b[p++]=e[1],b[p++]=e[2],b[p++]=e[3],b[p++]=e[4],b[p++]=e[5],b[p++]=e[6],b[p++]=e[7],b[p++]=e[8],b[p++]=e[9],b[p++]=e[10],b[p++]=e[11]}}}};function h(t,e){return e===s.Df.CARTESIAN||e===s.Df.METER_OFFSETS||e===s.Df.DEFAULT&&!t.isGeospatial}},5976:(t,e,n)=>{n.d(e,{u:()=>mt});var i=n(59645),s=n(33406);const r="3.3.2",o={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};Object.keys(o);var a=n(73613);function c(t,e,n){(0,a.h)(t instanceof ArrayBuffer);const i=new TextDecoder("utf8"),s=new Uint8Array(t,e,n);return i.decode(s)}var l=n(64995),u=n(18101),h=n(43855),d=n(4942),p=n(48710);class m{constructor(t,e){(0,d.Z)(this,"json",void 0),(0,d.Z)(this,"buffer",void 0),(0,d.Z)(this,"featuresLength",0),(0,d.Z)(this,"_cachedTypedArrays",{}),this.json=t,this.buffer=e}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return Boolean(this.json[t])}getGlobalProperty(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.GL.UNSIGNED_INT,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=this.json[t];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(t,e,n,1,i.byteOffset):i}getPropertyArray(t,e,n){const i=this.json[t];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(e=p.Z.fromName(i.componentType)),this._getTypedArrayFromBinary(t,e,n,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(t,e,i)}getProperty(t,e,n,i,s){const r=this.json[t];if(!r)return r;const o=this.getPropertyArray(t,e,n);if(1===n)return o[i];for(let a=0;a<n;++a)s[a]=o[n*i+a];return s}_getTypedArrayFromBinary(t,e,n,i,s){const r=this._cachedTypedArrays;let o=r[t];return o||(o=p.Z.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+s,i*n),r[t]=o),o}_getTypedArrayFromArray(t,e,n){const i=this._cachedTypedArrays;let s=i[t];return s||(s=p.Z.createTypedArray(e,n),i[t]=s),s}}const f={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},y={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},g={SCALAR:(t,e,n)=>{e[n]=t},VEC2:(t,e,n)=>{e[2*n+0]=t[0],e[2*n+1]=t[1]},VEC3:(t,e,n)=>{e[3*n+0]=t[0],e[3*n+1]=t[1],e[3*n+2]=t[2]},VEC4:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT2:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT3:(t,e,n)=>{e[9*n+0]=t[0],e[9*n+1]=t[1],e[9*n+2]=t[2],e[9*n+3]=t[3],e[9*n+4]=t[4],e[9*n+5]=t[5],e[9*n+6]=t[6],e[9*n+7]=t[7],e[9*n+8]=t[8],e[9*n+9]=t[9]},MAT4:(t,e,n)=>{e[16*n+0]=t[0],e[16*n+1]=t[1],e[16*n+2]=t[2],e[16*n+3]=t[3],e[16*n+4]=t[4],e[16*n+5]=t[5],e[16*n+6]=t[6],e[16*n+7]=t[7],e[16*n+8]=t[8],e[16*n+9]=t[9],e[16*n+10]=t[10],e[16*n+11]=t[11],e[16*n+12]=t[12],e[16*n+13]=t[13],e[16*n+14]=t[14],e[16*n+15]=t[15]}};const _=t=>void 0!==t;function b(t,e,n){if(!e)return null;let i=t.getExtension("3DTILES_batch_table_hierarchy");const s=e.HIERARCHY;return s&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=s,i=s),i?function(t,e){let n,i,s;const r=t.instancesLength,o=t.classes;let a,c=t.classIds,l=t.parentCounts,u=t.parentIds,h=r;_(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,s=getBinaryAccessor(c),c=s.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,r));if(_(l))for(_(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,s=getBinaryAccessor(l),l=s.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,r)),a=new Uint16Array(r),h=0,n=0;n<r;++n)a[n]=h,h+=l[n];_(u)&&_(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,s=getBinaryAccessor(u),u=s.createArrayBufferView(e.buffer,e.byteOffset+u.byteOffset,h));const d=o.length;for(n=0;n<d;++n){const t=o[n].length,i=o[n].instances,s=getBinaryProperties(t,i,e);o[n].instances=combine(s,i)}const p=new Array(d).fill(0),m=new Uint16Array(r);for(n=0;n<r;++n)i=c[n],m[n]=p[i],++p[i];const f={classes:o,classIds:c,classIndexes:m,parentCounts:l,parentIndexes:a,parentIds:u};return function(t){const e=t.classIds,n=e.length;for(let i=0;i<n;++i)T(t,i,stack)}(f),f}(i,n):null}function v(t,e,n){if(!t)return;const i=t.parentCounts;return t.parentIds?n(t,e):i>0?function(t,e,n){const i=t.classIds,s=t.parentCounts,r=t.parentIds,o=t.parentIndexes,a=i.length,c=scratchVisited;c.length=Math.max(c.length,a);const l=++marker,u=scratchStack;u.length=0,u.push(e);for(;u.length>0;){if(c[e=u.pop()]===l)continue;c[e]=l;const i=n(t,e);if(_(i))return i;const a=s[e],h=o[e];for(let t=0;t<a;++t){const n=r[h+t];n!==e&&u.push(n)}}return null}(t,e,n):function(t,e,n){let i=!0;for(;i;){const s=n(t,e);if(_(s))return s;const r=t.parentIds[e];i=r!==e,e=r}throw new Error("traverseHierarchySingleParent")}(t,e,n)}function T(t,e,n){const i=t.parentCounts,s=t.parentIds,r=t.parentIndexes,o=t.classIds.length;if(!_(s))return;assert(e<o,"Parent index ".concat(e," exceeds the total number of instances: ").concat(o)),assert(-1===n.indexOf(e),"Circular dependency detected in the batch table hierarchy."),n.push(e);const a=_(i)?i[e]:1,c=_(i)?r[e]:e;for(let l=0;l<a;++l){const i=s[c+l];i!==e&&T(t,i,n)}n.pop(e)}function S(t){return null!=t}const O=(t,e)=>t,w={HIERARCHY:!0,extensions:!0,extras:!0};class C{constructor(t,e,n){var i;let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(0,d.Z)(this,"json",void 0),(0,d.Z)(this,"binary",void 0),(0,d.Z)(this,"featureCount",void 0),(0,d.Z)(this,"_extensions",void 0),(0,d.Z)(this,"_properties",void 0),(0,d.Z)(this,"_binaryProperties",void 0),(0,d.Z)(this,"_hierarchy",void 0),(0,a.h)(n>=0),this.json=t||{},this.binary=e,this.featureCount=n,this._extensions=(null===(i=this.json)||void 0===i?void 0:i.extensions)||{},this._properties={};for(const r in this.json)w[r]||(this._properties[r]=this.json[r]);this._binaryProperties=this._initializeBinaryProperties(),s["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=b(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){if(this._checkBatchId(t),(0,a.h)("string"==typeof e,e),this._hierarchy){return S(v(this._hierarchy,t,((t,n)=>{const i=t.classIds[n];return t.classes[i].name===e})))}return!1}isExactClass(t,e){return(0,a.h)("string"==typeof e,e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),(0,a.h)("string"==typeof e,e),S(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),(e=S(e)?e:[]).length=0;const n=Object.keys(this._properties);return e.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),(0,a.h)("string"==typeof e,e),this._binaryProperties){const n=this._binaryProperties[e];if(S(n))return this._getBinaryProperty(n,t)}const n=this._properties[e];if(S(n))return O(n[t]);if(this._hierarchy){const n=this._getHierarchyProperty(t,e);if(S(n))return n}}setProperty(t,e,n){const i=this.featureCount;if(this._checkBatchId(t),(0,a.h)("string"==typeof e,e),this._binaryProperties){const i=this._binaryProperties[e];if(i)return void this._setBinaryProperty(i,t,n)}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,n))return;let s=this._properties[e];S(s)||(this._properties[e]=new Array(i),s=this._properties[e]),s[t]=O(n)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,n){t.pack(n,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const n=this._properties[e],i=this._initializeBinaryProperty(e,n);i&&(t=t||{},t[e]=i)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const n=e;(0,a.h)(this.binary,"Property ".concat(t," requires a batch table binary.")),(0,a.h)(n.type,"Property ".concat(t," requires a type."));const i=function(t,e,n,i){const{componentType:s}=t;(0,a.h)(t.componentType);const r="string"==typeof s?p.Z.fromName(s):s,o=f[t.type],c=y[t.type],l=g[t.type];return n+=t.byteOffset,{values:p.Z.createTypedArray(r,e,n,o*i),type:r,size:o,unpacker:c,packer:l}}(n,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const n=v(this._hierarchy,t,((t,n)=>{const i=t.classIds[n];return S(t.classes[i].instances[e])}));return S(n)}_getPropertyNamesInHierarchy(t,e){v(this._hierarchy,t,((t,n)=>{const i=t.classIds[n],s=t.classes[i].instances;for(const r in s)s.hasOwnProperty(r)&&-1===e.indexOf(r)&&e.push(r)}))}_getHierarchyProperty(t,e){return v(this._hierarchy,t,((t,n)=>{const i=t.classIds[n],s=t.classes[i],r=t.classIndexes[n],o=s.instances[e];return S(o)?S(o.typedArray)?this._getBinaryProperty(o,r):O(o[r]):null}))}_setHierarchyProperty(t,e,n,i){const s=v(this._hierarchy,e,((t,s)=>{const r=t.classIds[s],o=t.classes[r],c=t.classIndexes[s],l=o.instances[n];return!!S(l)&&((0,a.h)(s===e,'Inherited property "'.concat(n,'" is read-only.')),S(l.typedArray)?this._setBinaryProperty(l,c,i):l[c]=O(i),!0)}));return S(s)}}const E=4;function A(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=new DataView(e);if(t.magic=i.getUint32(n,!0),n+=E,t.version=i.getUint32(n,!0),n+=E,t.byteLength=i.getUint32(n,!0),n+=E,1!==t.version)throw new Error("3D Tile Version ".concat(t.version," not supported"));return n}const P=4,x="b3dm tile in legacy format.";function M(t,e,n){const i=new DataView(e);let s;t.header=t.header||{};let r=i.getUint32(n,!0);n+=P;let o=i.getUint32(n,!0);n+=P;let a=i.getUint32(n,!0);n+=P;let c=i.getUint32(n,!0);return n+=P,a>=570425344?(n-=2*P,s=r,a=o,c=0,r=0,o=0,console.warn(x)):c>=570425344&&(n-=P,s=a,a=r,c=o,r=0,o=0,console.warn(x)),t.header.featureTableJsonByteLength=r,t.header.featureTableBinaryByteLength=o,t.header.batchTableJsonByteLength=a,t.header.batchTableBinaryByteLength=c,t.header.batchLength=s,n}function L(t,e,n,i){return n=function(t,e,n,i){const{featureTableJsonByteLength:s,featureTableBinaryByteLength:r,batchLength:o}=t.header;if(t.featureTableJson={BATCH_LENGTH:o||0},s>0){const i=c(e,n,s);t.featureTableJson=JSON.parse(i)}return n+=s,t.featureTableBinary=new Uint8Array(e,n,r),n+=r,n}(t,e,n),n=function(t,e,n,i){const{batchTableJsonByteLength:s,batchTableBinaryByteLength:r}=t.header;if(s>0){const i=c(e,n,s);t.batchTableJson=JSON.parse(i),n+=s,r>0&&(t.batchTableBinary=new Uint8Array(e,n,r),t.batchTableBinary=new Uint8Array(t.batchTableBinary),n+=r)}return n}(t,e,n),n}var I=n(57175);function N(t,e,n){if(!(e||t&&t.batchIds&&n))return null;const{batchIds:i,isRGB565:s,pointCount:r}=t;if(i&&n){const t=new Uint8ClampedArray(3*r);for(let e=0;e<r;e++){const s=i[e],r=n.getProperty(s,"dimensions").map((t=>255*t));t[3*e]=r[0],t[3*e+1]=r[1],t[3*e+2]=r[2]}return{type:u.GL.UNSIGNED_BYTE,value:t,size:3,normalized:!0}}if(s){const t=new Uint8ClampedArray(3*r);for(let n=0;n<r;n++){const i=(0,I.m)(e[n]);t[3*n]=i[0],t[3*n+1]=i[1],t[3*n+2]=i[2]}return{type:u.GL.UNSIGNED_BYTE,value:t,size:3,normalized:!0}}return e&&e.length===3*r?{type:u.GL.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:u.GL.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}var Z=n(86430);const R=new h.Z;function z(t,e,n){return t.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,function(t,e){const n=new h.Z,i=new Float32Array(3*t.pointCount);for(let s=0;s<t.pointCount;s++)n.set(e[3*s],e[3*s+1],e[3*s+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(i,3*s);return i}(t,e)):{type:u.GL.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}async function U(t,e,n,i,s){n=L(t,e,n=M(t,e,n=A(t,e,n))),function(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}(t);const{featureTable:r,batchTable:o}=function(t){const e=new m(t.featureTableJson,t.featureTableBinary),n=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=n,t.featuresLength=n,t.pointsLength=n,t.pointCount=n,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",u.GL.FLOAT,3);const i=function(t,e){let n=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",u.GL.UNSIGNED_SHORT,1),t.batchIds)){const i=e.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:s,batchTableBinary:r}=t;n=new C(s,r,i)}return n}(t,e);return{featureTable:e,batchTable:i}}(t);return await async function(t,e,n,i,s){let r,o,a;const c=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];c&&(a=c.properties);const u=e.getExtension("3DTILES_draco_point_compression");if(u){o=u.properties;const e=u.byteOffset,n=u.byteLength;if(!o||!Number.isFinite(e)||!n)throw new Error("Draco properties, byteOffset, and byteLength must be defined");r=t.featureTableBinary.slice(e,e+n),t.hasPositions=Number.isFinite(o.POSITION),t.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),t.hasNormals=Number.isFinite(o.NORMAL),t.hasBatchIds=Number.isFinite(o.BATCH_ID),t.isTranslucent=Number.isFinite(o.RGBA)}if(!r)return!0;const d={buffer:r,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await async function(t,e,n,i){const{parse:s}=i,r={...n,draco:{...n.draco,extraAttributes:e.batchTableProperties||{}}};delete r["3d-tiles"];const o=await s(e.buffer,l.VJ,r),a=o.attributes.POSITION&&o.attributes.POSITION.value,c=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,u=o.attributes.NORMAL&&o.attributes.NORMAL.value,d=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,p=a&&o.attributes.POSITION.value.quantization,m=u&&o.attributes.NORMAL.value.quantization;if(p){const e=o.POSITION.data.quantization,n=e.range;t.quantizedVolumeScale=new h.Z(n,n,n),t.quantizedVolumeOffset=new h.Z(e.minValues),t.quantizedRange=(1<<e.quantizationBits)-1,t.isQuantizedDraco=!0}m&&(t.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const f={};if(e.batchTableProperties)for(const l of Object.keys(e.batchTableProperties))o.attributes[l]&&o.attributes[l].value&&(f[l.toLowerCase()]=o.attributes[l].value);t.attributes={positions:a,colors:N(t,c,void 0),normals:u,batchIds:d,...f}}(t,d,i,s)}(t,r,0,i,s),function(t,e,n){if(!t.attributes.positions)if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",u.GL.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const i=e.getPropertyArray("POSITION_QUANTIZED",u.GL.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",u.GL.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",u.GL.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=z(t,i,n)}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}(t,r,i),function(t,e,n){if(!t.attributes.colors){let i=null;e.hasProperty("RGBA")?(i=e.getPropertyArray("RGBA",u.GL.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?i=e.getPropertyArray("RGB",u.GL.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(i=e.getPropertyArray("RGB565",u.GL.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=N(t,i,n)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",u.GL.UNSIGNED_BYTE,4))}(t,r,o),function(t,e){if(!t.attributes.normals){let n=null;e.hasProperty("NORMAL")?n=e.getPropertyArray("NORMAL",u.GL.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(n=e.getPropertyArray("NORMAL_OCT16P",u.GL.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=function(t,e){if(!e)return null;if(t.isOctEncoded16P){const n=new Float32Array(3*t.pointsLength);for(let i=0;i<t.pointsLength;i++)(0,Z.hP)(e[2*i],e[2*i+1],R),R.toArray(n,3*i);return{type:u.GL.FLOAT,size:2,value:n}}return{type:u.GL.FLOAT,size:2,value:e}}(t,n)}}(t,r),n}var D=n(5016),B=n(2482);const G={URI:0,EMBEDDED:1};function F(t,e,n,i){t.rotateYtoZ=!0;const s=t.byteOffset+t.byteLength-n;if(0===s)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=i["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=(0,B.qv)(e,n,s),t.gltfByteOffset=0,t.gltfByteLength=s,n%4==0||console.warn("".concat(t.type,": embedded glb is not aligned to a 4-byte boundary.")),t.byteOffset+t.byteLength}async function V(t,e,n,i){const s=n["3d-tiles"]||{};if(function(t,e,n){switch(e){case G.URI:const e=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),n=(new TextDecoder).decode(e);t.gltfUrl=n.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case G.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}(t,e),s.loadGLTF){const{parse:e,fetch:s}=i;t.gltfUrl&&(t.gltfArrayBuffer=await s(t.gltfUrl,n),t.gltfByteOffset=0),t.gltfArrayBuffer&&(t.gltf=await e(t.gltfArrayBuffer,D.E,n,i),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength)}}async function H(t,e,n,i,s){var r;n=function(t,e,n,i,s){n=A(t,e,n),n=M(t,e,n),n=L(t,e,n),n=F(t,e,n,i);const r=new m(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=r.getGlobalProperty("RTC_CENTER",u.GL.FLOAT,3),n}(t,e,n,i),await V(t,G.EMBEDDED,i,s);const o=null==t||null===(r=t.gltf)||void 0===r?void 0:r.extensions;return o&&o.CESIUM_RTC&&(t.rtcCenter=o.CESIUM_RTC.center),n}var q=n(80540),k=n(79108),j=n(85451),X=n(98759);async function K(t,e,n,i,s){return n=function(t,e,n,i,s){if(n=A(t,e,n),1!==t.version)throw new Error("Instanced 3D Model version ".concat(t.version," is not supported"));n=M(t,e,n);const r=new DataView(e);if(t.gltfFormat=r.getUint32(n,!0),n+=4,n=L(t,e,n),n=F(t,e,n,i),0===t.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new m(t.featureTableJson,t.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",u.GL.FLOAT,3);new C(t.batchTableJson,t.batchTableBinary,a);return function(t,e,n,i){const s={instances:new Array(i),batchTable:t._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]},r=s.instances,o=new h.Z,a=new h.Z,c=new h.Z,l=new h.Z,d=new q.Z,p=new k.Z,m=new h.Z,f={},y=new j.Z,g=[],_=[],b=new h.Z,v=new h.Z;for(let h=0;h<i;h++){let n;if(e.hasProperty("POSITION"))n=e.getProperty("POSITION",u.GL.FLOAT,3,h,o);else if(e.hasProperty("POSITION_QUANTIZED")){n=e.getProperty("POSITION_QUANTIZED",u.GL.UNSIGNED_SHORT,3,h,o);const t=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",u.GL.FLOAT,3,b);if(!t)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const i=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",u.GL.FLOAT,3,v);if(!i)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const s=65535;for(let e=0;e<3;e++)n[e]=n[e]/s*i[e]+t[e]}if(!n)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");o.copy(n),f.translation=o,t.normalUp=e.getProperty("NORMAL_UP",u.GL.FLOAT,3,h,g),t.normalRight=e.getProperty("NORMAL_RIGHT",u.GL.FLOAT,3,h,_);const i=!1;if(t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",u.GL.UNSIGNED_SHORT,2,g),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",u.GL.UNSIGNED_SHORT,2,_),t.octNormalUp){if(!t.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}t.eastNorthUp?(X.H.WGS84.eastNorthUpToFixedFrame(o,y),y.getRotationMatrix3(d)):d.identity()}i&&(l.copy(a).cross(c).normalize(),d.setColumn(0,a),d.setColumn(1,c),d.setColumn(2,l)),p.fromMatrix3(d),f.rotation=p,m.set(1,1,1);const s=e.getProperty("SCALE",u.GL.FLOAT,1,h);Number.isFinite(s)&&m.multiplyByScalar(s);const T=e.getProperty("SCALE_NON_UNIFORM",u.GL.FLOAT,3,h,g);T&&m.scale(T),f.scale=m;let S=e.getProperty("BATCH_ID",u.GL.UNSIGNED_SHORT,1,h);void 0===S&&(S=h);const O=(new j.Z).fromQuaternion(f.rotation);y.identity(),y.translate(f.translation),y.multiplyRight(O),y.scale(f.scale);const w=y.clone();r[h]={modelMatrix:w,batchId:S}}t.instances=r}(t,o,0,a),n}(t,e,n,i),await V(t,t.gltfFormat,i,s),n}async function Q(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};switch(s.byteOffset=e,s.type=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=new DataView(t);return"".concat(String.fromCharCode(n.getUint8(e+0))).concat(String.fromCharCode(n.getUint8(e+1))).concat(String.fromCharCode(n.getUint8(e+2))).concat(String.fromCharCode(n.getUint8(e+3)))}(t,e),s.type){case o.COMPOSITE:return await async function(t,e,n,i,s,r){n=A(t,e,n);const o=new DataView(e);for(t.tilesLength=o.getUint32(n,!0),n+=4,t.tiles=[];t.tiles.length<t.tilesLength&&t.byteLength-n>12;){const o={};t.tiles.push(o),n=await r(e,n,i,s,o)}return n}(s,t,e,n,i,Q);case o.BATCHED_3D_MODEL:return await H(s,t,e,n,i);case o.GLTF:return await async function(t,e,n,i){t.rotateYtoZ=!0,t.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y";const{parse:s}=i;t.gltf=await s(e,D.E,n,i)}(s,t,n,i);case o.INSTANCED_3D_MODEL:return await K(s,t,e,n,i);case o.POINT_CLOUD:return await U(s,t,e,n,i);default:throw new Error("3DTileLoader: unknown type ".concat(s.type))}}const J=1952609651,Y=1;async function W(t,e,n,i){const s=t[e].bufferView,r=t.bufferViews[s],o=t.buffers[r.buffer];if(null==i||!i.url||!i.fetch)throw new Error("Url is not provided");if(!i.fetch)throw new Error("fetch is not provided");if(o.uri){const t=function(t,e){if(e.startsWith("http")){const n=new URL(t,e);return decodeURI(n.toString())}const n="http://".concat(e),i=new URL(t,n);return"/".concat(i.host).concat(i.pathname)}(o.uri,null==i?void 0:i.url),e=await i.fetch(t),n=await e.arrayBuffer();return new Uint8Array(n,r.byteOffset,r.byteLength)}return new Uint8Array(n,r.byteOffset,r.byteLength)}function $(t){const e=new DataView(t);return e.getUint32(0,!0)+2**32*e.getUint32(4,!0)}const tt={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:r,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:async function(t,e,n){if(new Uint32Array(t.slice(0,4))[0]!==J)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==Y)throw new Error("Wrong subtree file verson, must be 1");const i=$(t.slice(8,16)),s=new Uint8Array(t,24,i),r=new TextDecoder("utf8").decode(s),o=JSON.parse(r),a=$(t.slice(16,24));let c=new ArrayBuffer(0);return a&&(c=t.slice(24+i)),"bufferView"in o.tileAvailability&&(o.tileAvailability.explicitBitstream=await W(o,"tileAvailability",c,n)),"bufferView"in o.contentAvailability&&(o.contentAvailability.explicitBitstream=await W(o,"contentAvailability",c,n)),"bufferView"in o.childSubtreeAvailability&&(o.childSubtreeAvailability.explicitBitstream=await W(o,"childSubtreeAvailability",c,n)),o},options:{}};var et=n(37258);const nt={QUADTREE:4,OCTREE:8};async function it(t){const{options:e,parentData:n={mortonIndex:0,x:0,y:0,z:0},childIndex:i=0,globalData:s={level:0,mortonIndex:0,x:0,y:0,z:0}}=t;let{subtree:r,level:o=0}=t;const{subdivisionScheme:a,subtreeLevels:c,maximumLevel:l,contentUrlTemplate:u,subtreesUriTemplate:h,basePath:d}=e,p={children:[],lodMetricValue:0,contentUrl:""},m=nt[a],f=1&i,y=i>>1&1,g=i>>2&1,_=(m**o-1)/(m-1);let b=ot(n.mortonIndex,i),v=_+b,T=ot(n.x,f),S=ot(n.y,y),O=ot(n.z,g),w=!1;o+1>c&&(w=st(r.childSubtreeAvailability,b));const C=ot(s.x,T),E=ot(s.y,S),A=ot(s.z,O),P=o+s.level;if(w){const t=at("".concat(d,"/").concat(h),P,C,E,A);r=await(0,et.z)(t,tt),s.mortonIndex=b,s.x=T,s.y=S,s.z=O,s.level=o,b=0,v=0,T=0,S=0,O=0,o=0}if(!st(r.tileAvailability,v)||o>l)return p;st(r.contentAvailability,v)&&(p.contentUrl=at(u,P,C,E,A));const x=o+1,M={mortonIndex:b,x:T,y:S,z:O};for(let L=0;L<m;L++){const t=await it({subtree:r,options:e,parentData:M,childIndex:L,level:x,globalData:s});if(t.contentUrl||t.children.length){const n=rt(t,P+1,{childTileX:T,childTileY:S,childTileZ:O},e);p.children.push(n)}}return p}function st(t,e){return"constant"in t?Boolean(t.constant):!!t.explicitBitstream&&function(t,e){const n=Math.floor(t/8),i=t%8;return 1==(e[n]>>i&1)}(e,t.explicitBitstream)}function rt(t,e,n,i){const{basePath:s,refine:r,getRefine:o,lodMetricType:a,getTileType:c,rootLodMetricValue:l,rootBoundingVolume:u}=i,h=t.contentUrl&&t.contentUrl.replace("".concat(s,"/"),""),d=l/2**e,p=function(t,e,n){if(e.region){const{childTileX:i,childTileY:s,childTileZ:r}=n,[o,a,c,l,u,h]=e.region,d=2**t,p=(c-o)/d,m=(l-a)/d,f=(h-u)/d,[y,g]=[o+p*i,o+p*(i+1)],[_,b]=[a+m*s,a+m*(s+1)],[v,T]=[u+f*r,u+f*(r+1)];return{region:[y,_,g,b,v,T]}}return console.warn("Unsupported bounding volume type: ",e),null}(e,u,n);return{children:t.children,contentUrl:t.contentUrl,content:{uri:h},id:t.contentUrl,refine:o(r),type:c(t),lodMetricType:a,lodMetricValue:d,geometricError:d,transform:t.transform,boundingVolume:p}}function ot(t,e){return parseInt(t.toString(2)+e.toString(2),2)}function at(t,e,n,i,s){const r=function(t){const e={};for(const n in t)e["{".concat(n,"}")]=t[n];return e}({level:e,x:n,y:i,z:s});return t.replace(/{level}|{x}|{y}|{z}/gi,(t=>r[t]))}function ct(t){if(!t.contentUrl)return s.R7.EMPTY;const e=t.contentUrl.split(".").pop();switch(e){case"pnts":return s.R7.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return s.R7.SCENEGRAPH;default:return e}}function lt(t){switch(t){case"REPLACE":case"replace":return s.F$.REPLACE;case"ADD":case"add":return s.F$.ADD;default:return t}}function ut(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const n=new URL(t,"".concat(e,"/"));return decodeURI(n.toString())}return t.startsWith("/")?t:"".concat(e,"/").concat(t)}function ht(t,e){if(!t)return null;if(t.content){const n=t.content.uri||t.content.url;t.contentUrl=ut(n,e.basePath)}return t.id=t.contentUrl,t.lodMetricType=s.ci.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,t.type=ct(t),t.refine=lt(t.refine),t}async function dt(t,e,n,i){var r;const o=e.basePath,{subdivisionScheme:a,maximumLevel:c,subtreeLevels:l,subtrees:{uri:u}}=n,h=ut(at(u,0,0,0,0),o),d=await(0,et.z)(h,tt,i),p=ut(t.content.uri,o),m=null==e||null===(r=e.root)||void 0===r?void 0:r.refine,f=t.geometricError,y=t.boundingVolume,g={contentUrlTemplate:p,subtreesUriTemplate:u,subdivisionScheme:a,subtreeLevels:l,maximumLevel:c,refine:m,basePath:o,lodMetricType:s.ci.GEOMETRIC_ERROR,rootLodMetricValue:f,rootBoundingVolume:y,getTileType:ct,getRefine:lt};return await async function(t,e,n){if(!t)return null;t.lodMetricType=s.ci.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform;const{children:i,contentUrl:r}=await it({subtree:e,options:n});r&&(t.contentUrl=r,t.content={uri:r.replace("".concat(n.basePath,"/"),"")});return t.refine=lt(t.refine),t.type=ct(t),t.children=i,t.id=t.contentUrl,t}(t,d,g)}function pt(t){var e;return(null==t||null===(e=t.extensions)||void 0===e?void 0:e["3DTILES_implicit_tiling"])||(null==t?void 0:t.implicitTiling)}const mt={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:r,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:async function(t,e,n){const r=e["3d-tiles"]||{};let o;o="auto"===r.isTileset?n.url&&-1!==n.url.indexOf(".json"):r.isTileset;t=o?await async function(t,e,n){var r;const o=JSON.parse((new TextDecoder).decode(t));return o.loader=e.loader||mt,o.url=n.url,o.basePath=function(t){return i.XX(t.url)}(o),o.root=await async function(t,e){const n=t.basePath;let i;const s=pt(null==t?void 0:t.root);i=s&&t.root?await dt(t.root,t,s,e):ht(t.root,t);const r=[];for(r.push(i);r.length>0;){const i=(r.pop()||{}).children||[];for(let s of i){const i=pt(s);i?s=await dt(s,t,i,e):ht(s,{basePath:n}),r.push(s)}}return i}(o,e),o.type=s.i3.TILES3D,o.lodMetricType=s.ci.GEOMETRIC_ERROR,o.lodMetricValue=(null===(r=o.root)||void 0===r?void 0:r.lodMetricValue)||0,o}(t,e,n):await async function(t,e,n){const i={content:{featureIds:null}},s=0;return await Q(t,s,e,n,i.content),i.content}(t,e,n);return t},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}}},37069:(t,e,n)=>{n.d(e,{Z:()=>c});var i=n(89521),s=n(14034),r=n(86281),o=n(31437),a=n(1031);class c extends i.Z{constructor(t=0,e=0){super(2),(0,s.kJ)(t)&&1===arguments.length?this.copy(t):(s.vc.debug&&((0,r.u5)(t),(0,r.u5)(e)),this[0]=t,this[1]=e)}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return s.vc.debug&&((0,r.u5)(t.x),(0,r.u5)(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return o.fF(this,this,t),this.check()}transformAsVector(t){return(0,a.pb)(this,this,t),this.check()}transformByMatrix3(t){return o.kK(this,this,t),this.check()}transformByMatrix2x3(t){return o.iu(this,this,t),this.check()}transformByMatrix2(t){return o.c(this,this,t),this.check()}}},79057:(t,e,n)=>{n.d(e,{Z:()=>i});const i={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:2*Math.PI}},36625:(t,e,n)=>{n.d(e,{Xx:()=>u,KM:()=>m,Mh:()=>V,F7:()=>N,JO:()=>D,tF:()=>et,du:()=>vt});const i=-1,s=0,r=1;var o=n(4942),a=n(43855);const c=new a.Z,l=new a.Z;class u{constructor(t=[0,0,0],e=[0,0,0],n){(0,o.Z)(this,"center",void 0),(0,o.Z)(this,"halfDiagonal",void 0),(0,o.Z)(this,"minimum",void 0),(0,o.Z)(this,"maximum",void 0),n=n||c.copy(t).add(e).scale(.5),this.center=new a.Z(n),this.halfDiagonal=new a.Z(e).subtract(this.center),this.minimum=new a.Z(t),this.maximum=new a.Z(e)}clone(){return new u(this.minimum,this.maximum,this.center)}equals(t){return this===t||Boolean(t)&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}transform(t){return this.center.transformAsPoint(t),this.halfDiagonal.transform(t),this.minimum.transform(t),this.maximum.transform(t),this}intersectPlane(t){const{halfDiagonal:e}=this,n=l.from(t.normal),o=e.x*Math.abs(n.x)+e.y*Math.abs(n.y)+e.z*Math.abs(n.z),a=this.center.dot(n)+t.distance;return a-o>0?r:a+o<0?i:s}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=c.from(t).subtract(this.center),{halfDiagonal:n}=this;let i,s=0;return i=Math.abs(e.x)-n.x,i>0&&(s+=i*i),i=Math.abs(e.y)-n.y,i>0&&(s+=i*i),i=Math.abs(e.z)-n.z,i>0&&(s+=i*i),s}}var h=n(85975);const d=new a.Z,p=new a.Z;class m{constructor(t=[0,0,0],e=0){(0,o.Z)(this,"center",void 0),(0,o.Z)(this,"radius",void 0),this.radius=-0,this.center=new a.Z,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=d.from(e),this.center=(new a.Z).from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new m(this.center,this.radius)}union(t){const e=this.center,n=this.radius,i=t.center,s=t.radius,r=d.copy(i).subtract(e),o=r.magnitude();if(n>=o+s)return this.clone();if(s>=o+n)return t.clone();const a=.5*(n+o+s);return p.copy(r).scale((-n+a)/o).add(e),this.center.copy(p),this.radius=a,this}expand(t){const e=d.from(t).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}transform(t){this.center.transform(t);const e=h.Q$(d,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const e=d.from(t).subtract(this.center);return Math.max(0,e.len()-this.radius)}intersectPlane(t){const e=this.center,n=this.radius,o=t.normal.dot(e)+t.distance;return o<-n?i:o<n?s:r}}var f=n(80540),y=n(79108);const g=new a.Z,_=new a.Z,b=new a.Z,v=new a.Z,T=new a.Z,S=new a.Z,O=new a.Z,w=0,C=1,E=2,A=3,P=4,x=5,M=6,L=7,I=8;class N{constructor(t=[0,0,0],e=[0,0,0,0,0,0,0,0,0]){(0,o.Z)(this,"center",void 0),(0,o.Z)(this,"halfAxes",void 0),this.center=(new a.Z).from(t),this.halfAxes=new f.Z(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new a.Z(t).len(),new a.Z(e).len(),new a.Z(n).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new a.Z(t).normalize(),s=new a.Z(e).normalize(),r=new a.Z(n).normalize();return(new y.Z).fromMatrix3(new f.Z([...i,...s,...r]))}fromCenterHalfSizeQuaternion(t,e,n){const i=new y.Z(n),s=(new f.Z).fromQuaternion(i);return s[0]=s[0]*e[0],s[1]=s[1]*e[0],s[2]=s[2]*e[0],s[3]=s[3]*e[1],s[4]=s[4]*e[1],s[5]=s[5]*e[1],s[6]=s[6]*e[2],s[7]=s[7]*e[2],s[8]=s[8]*e[2],this.center=(new a.Z).from(t),this.halfAxes=s,this}clone(){return new N(this.center,this.halfAxes)}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new m){const e=this.halfAxes,n=e.getColumn(0,b),i=e.getColumn(1,v),s=e.getColumn(2,T),r=g.copy(n).add(i).add(s);return t.center.copy(this.center),t.radius=r.magnitude(),t}intersectPlane(t){const e=this.center,n=t.normal,o=this.halfAxes,a=n.x,c=n.y,l=n.z,u=Math.abs(a*o[w]+c*o[C]+l*o[E])+Math.abs(a*o[A]+c*o[P]+l*o[x])+Math.abs(a*o[M]+c*o[L]+l*o[I]),h=n.dot(e)+t.distance;return h<=-u?i:h>=u?r:s}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=_.from(t).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,b),s=n.getColumn(1,v),r=n.getColumn(2,T),o=i.magnitude(),a=s.magnitude(),c=r.magnitude();i.normalize(),s.normalize(),r.normalize();let l,u=0;return l=Math.abs(e.dot(i))-o,l>0&&(u+=l*l),l=Math.abs(e.dot(s))-a,l>0&&(u+=l*l),l=Math.abs(e.dot(r))-c,l>0&&(u+=l*l),u}computePlaneDistances(t,e,n=[-0,-0]){let i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const r=this.center,o=this.halfAxes,a=o.getColumn(0,b),c=o.getColumn(1,v),l=o.getColumn(2,T),u=S.copy(a).add(c).add(l).add(r),h=O.copy(u).subtract(t);let d=e.dot(h);return i=Math.min(d,i),s=Math.max(d,s),u.copy(r).add(a).add(c).subtract(l),h.copy(u).subtract(t),d=e.dot(h),i=Math.min(d,i),s=Math.max(d,s),u.copy(r).add(a).subtract(c).add(l),h.copy(u).subtract(t),d=e.dot(h),i=Math.min(d,i),s=Math.max(d,s),u.copy(r).add(a).subtract(c).subtract(l),h.copy(u).subtract(t),d=e.dot(h),i=Math.min(d,i),s=Math.max(d,s),r.copy(u).subtract(a).add(c).add(l),h.copy(u).subtract(t),d=e.dot(h),i=Math.min(d,i),s=Math.max(d,s),r.copy(u).subtract(a).add(c).subtract(l),h.copy(u).subtract(t),d=e.dot(h),i=Math.min(d,i),s=Math.max(d,s),r.copy(u).subtract(a).subtract(c).add(l),h.copy(u).subtract(t),d=e.dot(h),i=Math.min(d,i),s=Math.max(d,s),r.copy(u).subtract(a).subtract(c).subtract(l),h.copy(u).subtract(t),d=e.dot(h),i=Math.min(d,i),s=Math.max(d,s),n[0]=i,n[1]=s,n}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,b);e.transformAsPoint(t);const n=this.halfAxes.getColumn(1,v);n.transformAsPoint(t);const i=this.halfAxes.getColumn(2,T);return i.transformAsPoint(t),this.halfAxes=new f.Z([...e,...n,...i]),this}getTransform(){throw new Error("not implemented")}}var Z=n(50394),R=n(14034);const z=new a.Z,U=new a.Z;class D{constructor(t=[0,0,1],e=0){(0,o.Z)(this,"normal",void 0),(0,o.Z)(this,"distance",void 0),this.normal=new a.Z,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return(0,Z.Z)(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=z.from(t),this.normal.from(e).normalize();const n=-this.normal.dot(t);return this.distance=n,this}fromCoefficients(t,e,n,i){return this.normal.set(t,e,n),(0,Z.Z)((0,R.fS)(this.normal.len(),1)),this.distance=i,this}clone(){return new D(this.normal,this.distance)}equals(t){return(0,R.fS)(this.distance,t.distance)&&(0,R.fS)(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=U.copy(this.normal).transformAsVector(t).normalize(),n=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(n,e)}projectPointOntoPlane(t,e=[0,0,0]){t=z.from(t);const n=this.getPointDistance(t),i=U.copy(this.normal).scale(n);return t.subtract(i).to(e)}}const B=[new a.Z([1,0,0]),new a.Z([0,1,0]),new a.Z([0,0,1])],G=new a.Z,F=new a.Z;new D(new a.Z(1,0,0),0);class V{constructor(t=[]){(0,o.Z)(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*B.length;const e=t.center,n=t.radius;let i=0;for(const s of B){let t=this.planes[i],r=this.planes[i+1];t||(t=this.planes[i]=new D),r||(r=this.planes[i+1]=new D);const o=G.copy(s).scale(-n).add(e);s.dot(o);t.fromPointNormal(o,s);const a=G.copy(s).scale(n).add(e),c=F.copy(s).negate();c.dot(a);r.fromPointNormal(a,c),i+=2}return this}computeVisibility(t){let e=r;for(const n of this.planes){switch(t.intersectPlane(n)){case i:return i;case s:e=s}}return e}computeVisibilityWithPlaneMask(t,e){if((0,Z.Z)(Number.isFinite(e),"parentPlaneMask is required."),e===V.MASK_OUTSIDE||e===V.MASK_INSIDE)return e;let n=V.MASK_INSIDE;const r=this.planes;for(let o=0;o<this.planes.length;++o){const a=o<31?1<<o:0;if(o<31&&0==(e&a))continue;const c=r[o],l=t.intersectPlane(c);if(l===i)return V.MASK_OUTSIDE;l===s&&(n|=a)}return n}}(0,o.Z)(V,"MASK_OUTSIDE",4294967295),(0,o.Z)(V,"MASK_INSIDE",0),(0,o.Z)(V,"MASK_INDETERMINATE",2147483647);new a.Z,new a.Z,new a.Z,new a.Z,new a.Z;const H=new a.Z,q=new a.Z,k=new a.Z,j=new a.Z,X=new a.Z,K=new a.Z,Q=new a.Z,J=new a.Z,Y=new a.Z,W=new a.Z,$=new a.Z,tt=new a.Z;Math.PI;function et(t,e=new m){if(!t||0===t.length)return e.fromCenterRadius([0,0,0],0);const n=Q.copy(t[0]),i=H.copy(n),s=q.copy(n),r=k.copy(n),o=j.copy(n),a=X.copy(n),c=K.copy(n);for(const m of t){n.copy(m);const t=n.x,e=n.y,l=n.z;t<i.x&&i.copy(n),t>o.x&&o.copy(n),e<s.y&&s.copy(n),e>a.y&&a.copy(n),l<r.z&&r.copy(n),l>c.z&&c.copy(n)}const l=J.copy(o).subtract(i).magnitudeSquared(),u=J.copy(a).subtract(s).magnitudeSquared(),h=J.copy(c).subtract(r).magnitudeSquared();let d=i,p=o,f=l;u>f&&(f=u,d=s,p=a),h>f&&(f=h,d=r,p=c);const y=Y;y.x=.5*(d.x+p.x),y.y=.5*(d.y+p.y),y.z=.5*(d.z+p.z);let g=J.copy(p).subtract(y).magnitudeSquared(),_=Math.sqrt(g);const b=W;b.x=i.x,b.y=s.y,b.z=r.z;const v=$;v.x=o.x,v.y=a.y,v.z=c.z;const T=tt.copy(b).add(v).multiplyByScalar(.5);let S=0;for(const m of t){n.copy(m);const t=J.copy(n).subtract(T).magnitude();t>S&&(S=t);const e=J.copy(n).subtract(y).magnitudeSquared();if(e>g){const t=Math.sqrt(e);_=.5*(_+t),g=_*_;const i=t-_;y.x=(_*y.x+i*n.x)/t,y.y=(_*y.y+i*n.y)/t,y.z=(_*y.z+i*n.z)/t}}return _<S?(y.to(e.center),e.radius=_):(T.to(e.center),e.radius=S),e}var nt=n(79057);const it=new f.Z,st=new f.Z,rt=new f.Z,ot=new f.Z,at=new f.Z;function ct(t,e={}){const n=nt.Z.EPSILON20;let i=0,s=0;const r=st,o=rt;r.identity(),o.copy(t);const a=n*function(t){let e=0;for(let n=0;n<9;++n){const i=t[n];e+=i*i}return Math.sqrt(e)}(o);for(;s<10&&ht(o)>a;)dt(o,ot),at.copy(ot).transpose(),o.multiplyRight(ot),o.multiplyLeft(at),r.multiplyRight(ot),++i>2&&(++s,i=0);return e.unitary=r.toTarget(e.unitary),e.diagonal=o.toTarget(e.diagonal),e}const lt=[1,0,0],ut=[2,2,1];function ht(t){let e=0;for(let n=0;n<3;++n){const i=t[it.getElementIndex(ut[n],lt[n])];e+=2*i*i}return Math.sqrt(e)}function dt(t,e){const n=nt.Z.EPSILON15;let i=0,s=1;for(let l=0;l<3;++l){const e=Math.abs(t[it.getElementIndex(ut[l],lt[l])]);e>i&&(s=l,i=e)}const r=lt[s],o=ut[s];let a=1,c=0;if(Math.abs(t[it.getElementIndex(o,r)])>n){const e=(t[it.getElementIndex(o,o)]-t[it.getElementIndex(r,r)])/2/t[it.getElementIndex(o,r)];let n;n=e<0?-1/(-e+Math.sqrt(1+e*e)):1/(e+Math.sqrt(1+e*e)),a=1/Math.sqrt(1+n*n),c=n*a}return f.Z.IDENTITY.to(e),e[it.getElementIndex(r,r)]=e[it.getElementIndex(o,o)]=a,e[it.getElementIndex(o,r)]=c,e[it.getElementIndex(r,o)]=-c,e}const pt=new a.Z,mt=new a.Z,ft=new a.Z,yt=new a.Z,gt=new a.Z,_t=new f.Z,bt={diagonal:new f.Z,unitary:new f.Z};function vt(t,e=new N){if(!t||0===t.length)return e.halfAxes=new f.Z([0,0,0,0,0,0,0,0,0]),e.center=new a.Z,e;const n=t.length,i=new a.Z(0,0,0);for(const a of t)i.add(a);const s=1/n;i.multiplyByScalar(s);let r=0,o=0,c=0,l=0,u=0,h=0;for(const a of t){const t=pt.copy(a).subtract(i);r+=t.x*t.x,o+=t.x*t.y,c+=t.x*t.z,l+=t.y*t.y,u+=t.y*t.z,h+=t.z*t.z}r*=s,o*=s,c*=s,l*=s,u*=s,h*=s;const d=_t;d[0]=r,d[1]=o,d[2]=c,d[3]=o,d[4]=l,d[5]=u,d[6]=c,d[7]=u,d[8]=h;const{unitary:p}=ct(d,bt),m=e.halfAxes.copy(p);let y=m.getColumn(0,ft),g=m.getColumn(1,yt),_=m.getColumn(2,gt),b=-Number.MAX_VALUE,v=-Number.MAX_VALUE,T=-Number.MAX_VALUE,S=Number.MAX_VALUE,O=Number.MAX_VALUE,w=Number.MAX_VALUE;for(const a of t)pt.copy(a),b=Math.max(pt.dot(y),b),v=Math.max(pt.dot(g),v),T=Math.max(pt.dot(_),T),S=Math.min(pt.dot(y),S),O=Math.min(pt.dot(g),O),w=Math.min(pt.dot(_),w);y=y.multiplyByScalar(.5*(S+b)),g=g.multiplyByScalar(.5*(O+v)),_=_.multiplyByScalar(.5*(w+T)),e.center.copy(y).add(g).add(_);const C=mt.set(b-S,v-O,T-w).multiplyByScalar(.5),E=new f.Z([C[0],0,0,0,C[1],0,0,0,C[2]]);return e.halfAxes.multiplyRight(E),e}},98759:(t,e,n)=>{n.d(e,{H:()=>Z});var i=n(4942),s=n(43855),r=n(79057),o=n(50394),a=n(85451),c=n(14034),l=n(77160);const u=6378137,h=6378137,d=6356752.314245179;Math.max(u,h,d);function p(t){return t}new s.Z;function m(t,e=[],n=p){return"longitude"in t?(e[0]=n(t.longitude),e[1]=n(t.latitude),e[2]=t.height):"x"in t?(e[0]=n(t.x),e[1]=n(t.y),e[2]=t.z):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function f(t,e,n=p){return"longitude"in e?(e.longitude=n(t[0]),e.latitude=n(t[1]),e.height=t[2]):"x"in e?(e.x=n(t[0]),e.y=n(t[1]),e.z=t[2]):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}const y=new s.Z,g=new s.Z,_=new s.Z;const b=1e-14,v=new s.Z,T={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},S={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},O={east:new s.Z,north:new s.Z,up:new s.Z,west:new s.Z,south:new s.Z,down:new s.Z},w=new s.Z,C=new s.Z,E=new s.Z;function A(t,e,n,i,s,r){const a=T[e]&&T[e][n];let l,u,h;(0,o.Z)(a&&(!i||i===a));const d=v.copy(s);if((0,c.fS)(d.x,0,b)&&(0,c.fS)(d.y,0,b)){const t=Math.sign(d.z);l=w.fromArray(S[e]),"east"!==e&&"west"!==e&&l.scale(t),u=C.fromArray(S[n]),"east"!==n&&"west"!==n&&u.scale(t),h=E.fromArray(S[i]),"east"!==i&&"west"!==i&&h.scale(t)}else{const{up:s,east:r,north:o}=O;r.set(-d.y,d.x,0).normalize(),t.geodeticSurfaceNormal(d,s),o.copy(s).cross(r);const{down:a,west:c,south:p}=O;a.copy(s).scale(-1),c.copy(r).scale(-1),p.copy(o).scale(-1),l=O[e],u=O[n],h=O[i]}return r[0]=l.x,r[1]=l.y,r[2]=l.z,r[3]=0,r[4]=u.x,r[5]=u.y,r[6]=u.z,r[7]=0,r[8]=h.x,r[9]=h.y,r[10]=h.z,r[11]=0,r[12]=d.x,r[13]=d.y,r[14]=d.z,r[15]=1,r}const P=new s.Z,x=new s.Z,M=new s.Z,L=new s.Z,I=new s.Z,N=new s.Z;class Z{constructor(t=0,e=0,n=0){(0,i.Z)(this,"radii",void 0),(0,i.Z)(this,"radiiSquared",void 0),(0,i.Z)(this,"radiiToTheFourth",void 0),(0,i.Z)(this,"oneOverRadii",void 0),(0,i.Z)(this,"oneOverRadiiSquared",void 0),(0,i.Z)(this,"minimumRadius",void 0),(0,i.Z)(this,"maximumRadius",void 0),(0,i.Z)(this,"centerToleranceSquared",r.Z.EPSILON1),(0,i.Z)(this,"squaredXOverSquaredZ",void 0),(0,o.Z)(t>=0),(0,o.Z)(e>=0),(0,o.Z)(n>=0),this.radii=new s.Z(t,e,n),this.radiiSquared=new s.Z(t*t,e*e,n*n),this.radiiToTheFourth=new s.Z(t*t*t*t,e*e*e*e,n*n*n*n),this.oneOverRadii=new s.Z(0===t?0:1/t,0===e?0:1/e,0===n?0:1/n),this.oneOverRadiiSquared=new s.Z(0===t?0:1/(t*t),0===e?0:1/(e*e),0===n?0:1/(n*n)),this.minimumRadius=Math.min(t,e,n),this.maximumRadius=Math.max(t,e,n),0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||Boolean(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,e=[0,0,0]){const n=x,i=M,[,,s]=t;this.geodeticSurfaceNormalCartographic(t,n),i.copy(this.radiiSquared).scale(n);const r=Math.sqrt(n.dot(i));return i.scale(1/r),n.scale(s),i.add(n),i.to(e)}cartesianToCartographic(t,e=[0,0,0]){N.from(t);const n=this.scaleToGeodeticSurface(N,L);if(!n)return;const i=this.geodeticSurfaceNormal(n,x),s=I;s.copy(N).subtract(n);const r=Math.atan2(i.y,i.x),o=Math.asin(i.z),a=Math.sign(l.AK(s,N))*l.kE(s);return f([r,o,a],e,c.vc._cartographicRadians?p:c.Ux)}eastNorthUpToFixedFrame(t,e=new a.Z){return A(this,"east","north","up",t,e)}localFrameToFixedFrame(t,e,n,i,s=new a.Z){return A(this,t,e,n,i,s)}geocentricSurfaceNormal(t,e=[0,0,0]){return P.from(t).normalize().to(e)}geodeticSurfaceNormalCartographic(t,e=[0,0,0]){const n=function(t,e=[]){return m(t,e,c.vc._cartographicRadians?p:c.Yr)}(t),i=n[0],s=n[1],r=Math.cos(s);return P.set(r*Math.cos(i),r*Math.sin(i),Math.sin(s)).normalize(),P.to(e)}geodeticSurfaceNormal(t,e=[0,0,0]){return P.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}scaleToGeodeticSurface(t,e){return function(t,e,n=[]){const{oneOverRadii:i,oneOverRadiiSquared:s,centerToleranceSquared:o}=e;y.from(t);const a=y.x,c=y.y,l=y.z,u=i.x,h=i.y,d=i.z,p=a*a*u*u,m=c*c*h*h,f=l*l*d*d,b=p+m+f,v=Math.sqrt(1/b);if(!Number.isFinite(v))return;const T=g;if(T.copy(t).scale(v),b<o)return T.to(n);const S=s.x,O=s.y,w=s.z,C=_;C.set(T.x*S*2,T.y*O*2,T.z*w*2);let E,A,P,x,M=(1-v)*y.len()/(.5*C.len()),L=0;do{M-=L,E=1/(1+M*S),A=1/(1+M*O),P=1/(1+M*w);const t=E*E,e=A*A,n=P*P;x=p*t+m*e+f*n-1,L=x/(-2*(p*(t*E)*S+m*(e*A)*O+f*(n*P)*w))}while(Math.abs(x)>r.Z.EPSILON12);return y.scale([E,A,P]).to(n)}(t,this,e)}scaleToGeocentricSurface(t,e=[0,0,0]){L.from(t);const n=L.x,i=L.y,s=L.z,r=this.oneOverRadiiSquared,o=1/Math.sqrt(n*n*r.x+i*i*r.y+s*s*r.z);return L.multiplyScalar(o).to(e)}transformPositionToScaledSpace(t,e=[0,0,0]){return L.from(t).scale(this.oneOverRadii).to(e)}transformPositionFromScaledSpace(t,e=[0,0,0]){return L.from(t).scale(this.radii).to(e)}getSurfaceNormalIntersectionWithZAxis(t,e=0,n=[0,0,0]){(0,o.Z)((0,c.fS)(this.radii.x,this.radii.y,r.Z.EPSILON15)),(0,o.Z)(this.radii.z>0),L.from(t);const i=L.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-e))return L.set(0,0,i).to(n)}}(0,i.Z)(Z,"WGS84",new Z(u,h,d))},33562:(t,e,n)=>{n.d(e,{Z:()=>m});var i=n(4942);const s=1024,r=1024*s,o=1024*r;function a(t){let e,n,i;return t<1?(e=1e3*t,n="\u03bcs",i=0):t<1e3?(e=t,n="ms",i=2):(e=t/1e3,n="s",i=2),"".concat(e.toFixed(i)).concat(n)}var c=n(23881);const l={position:"fixed",zIndex:1e4,color:"#ccc",background:"#000",fontFamily:"Helvetica,Arial,sans-serif",padding:"8px",fontSize:"12px",lineSpacing:6},u={fontSize:"16px",cursor:"pointer"},h={paddingLeft:"8px"},d=t=>"".concat(t.name,": ").concat(t.count),p={count:d,averageTime:t=>"".concat(t.name,": ").concat(a(t.getAverageTime())),totalTime:t=>"".concat(t.name,": ").concat(a(t.time)),fps:t=>"".concat(t.name,": ").concat(Math.round(t.getHz()),"fps"),memory:t=>"".concat(t.name,": ").concat(function(t){let e,n,i;return t<s?(e=t,n=" bytes",i=0):t<r?(e=t/s,n="kB",i=2):t<o?(e=t/r,n="MB",i=2):(e=t/o,n="GB",i=2),"".concat(e.toFixed(i)).concat(n)}(t.count))};class m{constructor(t,e){(0,i.Z)(this,"stats",void 0),(0,i.Z)(this,"title",void 0),(0,i.Z)(this,"collapsed",!1),(0,i.Z)(this,"_framesPerUpdate",void 0),(0,i.Z)(this,"_formatters",p),(0,i.Z)(this,"_css",void 0),(0,i.Z)(this,"_headerCSS",void 0),(0,i.Z)(this,"_itemCSS",void 0),(0,i.Z)(this,"_container",document.body),(0,i.Z)(this,"_innerContainer",null),(0,i.Z)(this,"_statsContainer",null),(0,i.Z)(this,"_header",null),(0,i.Z)(this,"_resetOnUpdate",{}),(0,i.Z)(this,"_counter",0),(0,i.Z)(this,"_items",{}),(0,i.Z)(this,"_added",!1),this.stats=t,this.title=null==e?void 0:e.title,this._framesPerUpdate=Math.round(Math.max((null==e?void 0:e.framesPerUpdate)||1,1)),this._initializeFormatters(e),this._initializeUpdateConfigs(e),this._css=Object.assign({},l,null==e?void 0:e.css),this._headerCSS=Object.assign({},u,this._css.header),this._itemCSS=Object.assign({},h,this._css.item),delete this._css.header,delete this._css.item,this._createDOM(null==e?void 0:e.container),this._createDOMStats()}setStats(t){this.stats=t,this._createDOMStats(),this._setHeaderContent(),this.update()}update(){const t=this.stats&&this.stats.stats;t&&0!==Object.keys(t).length&&this._counter++%this._framesPerUpdate==0&&this._update()}remove(){this._innerContainer&&this._container.removeChild(this._innerContainer)}setCollapsed(t){this.collapsed=t,this._statsContainer&&(this._statsContainer.style.display=this.collapsed?"none":"block"),this._setHeaderContent()}_update(){this.stats.forEach((t=>{this._createDOMItem(t.name),this._items[t.name].innerHTML=this._getLines(t).join("<BR>"),this._resetOnUpdate[t.name]&&t.reset()}))}_initializeFormatters(t){if(null!=t&&t.formatters)for(const e in t.formatters){let n=t.formatters[e];"string"==typeof n&&(n=p[n]),n&&(this._formatters[e]=n)}}_initializeUpdateConfigs(t){if(null!=t&&t.resetOnUpdate)for(const e in t.resetOnUpdate)this._resetOnUpdate[e]=t.resetOnUpdate[e]||!1}_createDOM(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body;if("undefined"!=typeof document&&document){this._container=t,this._innerContainer=document.createElement("div");for(const t in this._css)this._innerContainer.style[t]=this._css[t];this._container.appendChild(this._innerContainer),this._createDOMHeader(),this._statsContainer=document.createElement("div"),this._statsContainer.style.display="block",this._innerContainer.appendChild(this._statsContainer)}}_createDOMHeader(){if(!this._header){var t;this._header=document.createElement("div");for(const t in this._headerCSS)this._header.style[t]=this._headerCSS[t];this._header.onclick=this._toggleCollapsed.bind(this),null===(t=this._innerContainer)||void 0===t||t.appendChild(this._header)}this._setHeaderContent()}_setHeaderContent(){if(this._header){const t=this.collapsed?"\u25b6":"\u2b07",e=this.title||this.stats&&this.stats.id||"Stats";this._header.innerText="".concat(t," ").concat(e)}}_toggleCollapsed(){this.setCollapsed(!this.collapsed)}_createDOMStats(){this.stats instanceof c.Z&&this.stats.forEach((t=>{this._createDOMItem(t.name)}))}_createDOMItem(t){if(this._statsContainer&&!this._items[t]){this._items[t]=document.createElement("div");for(const e in this._itemCSS)this._items[t].style[e]=this._itemCSS[e];this._statsContainer.appendChild(this._items[t])}}_getLines(t){const e=this._formatters[t.name]||this._formatters[t.type||""]||d;return t?e(t).split("\n"):[]}}}}]);