"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[4864],{78918:(e,t,n)=>{n.d(t,{Z:()=>c});var r=n(81180),o=n(27458),i=n(63803),a=n(61855),s=n(85409);class c extends o.Z{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every((e=>e.isLoaded))}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id?(e.object=t.__source.object,e.index=t.__source.index,e):e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||t}getSubLayerRow(e,t,n){return e.__source={parent:this,object:t,index:n},e}getSubLayerAccessor(e){if("function"==typeof e){const t={index:-1,data:this.props.data,target:[]};return(n,r)=>n&&n.__source?(t.index=n.__source.index,e(n.__source.object,t)):e(n,r)}return e}getSubLayerProps(e={}){var t;const{opacity:n,pickable:r,visible:o,parameters:i,getPolygonOffset:a,highlightedObjectIndex:c,autoHighlight:l,highlightColor:u,coordinateSystem:d,coordinateOrigin:f,wrapLongitude:h,positionFormat:p,modelMatrix:g,extensions:y,fetch:v,operation:m,_subLayerProps:w}=this.props,b={id:"",updateTriggers:{},opacity:n,pickable:r,visible:o,parameters:i,getPolygonOffset:a,highlightedObjectIndex:c,autoHighlight:l,highlightColor:u,coordinateSystem:d,coordinateOrigin:f,wrapLongitude:h,positionFormat:p,modelMatrix:g,extensions:y,fetch:v,operation:m},x=w&&e.id&&w[e.id],C=x&&x.updateTriggers,_=e.id||"sublayer";if(x){const t=this.props[s.Wb],n=e.type?e.type._propTypes:{};for(const e in x){const r=n[e]||t[e];r&&"accessor"===r.type&&(x[e]=this.getSubLayerAccessor(x[e]))}}Object.assign(b,e,x),b.id="".concat(this.props.id,"-").concat(_),b.updateTriggers={all:null===(t=this.props.updateTriggers)||void 0===t?void 0:t.all,...e.updateTriggers,...C};for(const s of y){const e=s.getSubLayerProps.call(this,s);e&&Object.assign(b,e,{updateTriggers:Object.assign(b.updateTriggers,e.updateTriggers)})}return b}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let n=this.internalState.subLayers;const r=!n||this.needsUpdate();if(r){const e=this.renderLayers();n=(0,a.x)(e,Boolean),this.internalState.subLayers=n}(0,i.Z)("compositeLayer.renderLayers",this,r,n);for(const o of n)o.parent=this}}(0,r.Z)(c,"layerName","CompositeLayer")},13863:(e,t,n)=>{n.d(t,{Z:()=>m});var r=n(81180),o=n(24088),i=n(27458),a=n(93844),s=n(59965),c=n(15462),l=n(53982),u=n(78866),d=n(14034);const f=new Uint16Array([0,2,1,0,3,2]),h=new Float32Array([0,1,0,0,1,0,1,1]);function p(e,t){if(!t)return function(e){const t=new Float64Array(12);for(let n=0;n<e.length;n++)t[3*n+0]=e[n][0],t[3*n+1]=e[n][1],t[3*n+2]=e[n][2]||0;return{vertexCount:6,positions:t,indices:f,texCoords:h}}(e);const n=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),r=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),o=Math.ceil(n/t)+1,i=Math.ceil(r/t)+1,a=(o-1)*(i-1)*6,s=new Uint32Array(a),c=new Float32Array(o*i*2),l=new Float64Array(o*i*3);let u=0,d=0;for(let f=0;f<o;f++){const t=f/(o-1);for(let n=0;n<i;n++){const r=n/(i-1),o=g(e,t,r);l[3*u+0]=o[0],l[3*u+1]=o[1],l[3*u+2]=o[2]||0,c[2*u+0]=t,c[2*u+1]=1-r,f>0&&n>0&&(s[d++]=u-i,s[d++]=u-i-1,s[d++]=u-1,s[d++]=u-i,s[d++]=u-1,s[d++]=u),u++}}return{vertexCount:a,positions:l,indices:s,texCoords:c}}function g(e,t,n){return(0,d.t7)((0,d.t7)(e[0],e[1],n),(0,d.t7)(e[3],e[2],n),t)}const y="\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nvarying vec2 vTexCoord;\nvarying vec2 vTexPos;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\n\nuniform float coordinateConversion;\nuniform vec4 bounds;\n\n/* projection utils */\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / PI / 2.0;\n\n// from degrees to Web Mercator\nvec2 lnglat_to_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// from Web Mercator to degrees\nvec2 mercator_to_lnglat(vec2 xy) {\n  xy /= WORLD_SCALE;\n  return degrees(vec2(\n    xy.x - PI,\n    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5\n  ));\n}\n/* End projection utils */\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  if (transparentColor.a == 0.0) {\n    return vec4(color, alpha);\n  }\n  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);\n  float highLightRatio = alpha / blendedAlpha;\n  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);\n  return vec4(blendedRGB, blendedAlpha);\n}\n\nvec2 getUV(vec2 pos) {\n  return vec2(\n    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),\n    (pos.y - bounds[3]) / (bounds[1] - bounds[3])\n  );\n}\n\n".concat("\nvec3 packUVsIntoRGB(vec2 uv) {\n  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction\n  vec2 uv8bit = floor(uv * 256.);\n\n  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits\n  // Scale and clamp to 0-1 range\n  vec2 uvFraction = fract(uv * 256.);\n  vec2 uvFraction4bit = floor(uvFraction * 16.);\n\n  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates\n  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;\n\n  return vec3(uv8bit, fractions) / 255.;\n}\n","\n\nvoid main(void) {\n  vec2 uv = vTexCoord;\n  if (coordinateConversion < -0.5) {\n    vec2 lnglat = mercator_to_lnglat(vTexPos);\n    uv = getUV(lnglat);\n  } else if (coordinateConversion > 0.5) {\n    vec2 commonPos = lnglat_to_mercator(vTexPos);\n    uv = getUV(commonPos);\n  }\n  vec4 bitmapColor = texture2D(bitmapTexture, uv);\n\n  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);\n\n  geometry.uv = uv;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n\n  if (picking_uActive && !picking_uAttribute) {\n    // Since instance information is not used, we can use picking color for pixel index\n    gl_FragColor.rgb = packUVsIntoRGB(uv);\n  }\n}\n"),v={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:o.COORDINATE_SYSTEM.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0}};class m extends i.Z{constructor(...e){super(...e),(0,r.Z)(this,"state",void 0)}getShaders(){return super.getShaders({vs:"\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nattribute vec2 texCoords;\nattribute vec3 positions;\nattribute vec3 positions64Low;\n\nvarying vec2 vTexCoord;\nvarying vec2 vTexPos;\n\nuniform float coordinateConversion;\n\nconst vec3 pickingColor = vec3(1.0, 0.0, 0.0);\n\nvoid main(void) {\n  geometry.worldPosition = positions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = pickingColor;\n\n  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTexCoord = texCoords;\n\n  if (coordinateConversion < -0.5) {\n    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;\n  } else if (coordinateConversion > 0.5) {\n    vTexPos = geometry.worldPosition.xy;\n  }\n\n  vec4 color = vec4(0.0);\n  DECKGL_FILTER_COLOR(color, geometry);\n}\n",fs:y,modules:[a.Z,s.Z]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const t=!0;e.add({indices:{size:1,isIndexed:!0,update:e=>e.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:e=>e.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:e=>e.value=this.state.mesh.texCoords,noAlloc:t}})}updateState({props:e,oldProps:t,changeFlags:n}){const r=this.getAttributeManager();if(n.extensionsChanged){var o;const{gl:e}=this.context;null===(o=this.state.model)||void 0===o||o.delete(),this.state.model=this._getModel(e),r.invalidateAll()}if(e.bounds!==t.bounds){const e=this.state.mesh,t=this._createMesh();this.state.model.setVertexCount(t.vertexCount);for(const n in t)e&&e[n]!==t[n]&&r.invalidate(n);this.setState({mesh:t,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:t}=this.props,n=e.info;if(!n.color||!t)return n.bitmap=null,n;const{width:r,height:o}=t;n.index=0;const i=function(e){const[t,n,r]=e;return[(t+(15&r)/16)/256,(n+(240&r)/256)/256]}(n.color),a=[Math.floor(i[0]*r),Math.floor(i[1]*o)];return n.bitmap={size:{width:r,height:o},uv:i,pixel:a},n}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let t=e;return w(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),p(t,this.context.viewport.resolution)}_getModel(e){return e?new c.Z(e,{...this.getShaders(),id:this.props.id,geometry:new l.Z({drawMode:4,vertexCount:6}),isInstanced:!1}):null}draw(e){const{uniforms:t,moduleParameters:n}=e,{model:r,coordinateConversion:o,bounds:i,disablePicking:a}=this.state,{image:s,desaturate:c,transparentColor:l,tintColor:u}=this.props;n.pickingActive&&a||s&&r&&r.setUniforms(t).setUniforms({bitmapTexture:s,desaturate:c,transparentColor:l.map((e=>e/255)),tintColor:u.slice(0,3).map((e=>e/255)),coordinateConversion:o,bounds:i}).draw()}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:t,DEFAULT:n}=o.COORDINATE_SYSTEM;let{_imageCoordinateSystem:r}=this.props;if(r!==n){const{bounds:n}=this.props;if(!w(n))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const o=this.context.viewport.resolution?e:t;if(r=r===e?e:t,r===e&&o===t)return{coordinateConversion:-1,bounds:n};if(r===t&&o===e){const e=(0,u.w5)([n[0],n[1]]),t=(0,u.w5)([n[2],n[3]]);return{coordinateConversion:1,bounds:[e[0],e[1],t[0],t[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}function w(e){return Number.isFinite(e[0])}(0,r.Z)(m,"layerName","BitmapLayer"),(0,r.Z)(m,"defaultProps",v)},8977:(e,t,n)=>{n.d(t,{Z:()=>y});var r=n(67294),o=n(83043);const i="undefined"!=typeof window?r.useLayoutEffect:r.useEffect;function a(e,t){for(;e;){if(e===t)return!0;e=Object.getPrototypeOf(e)}return!1}var s=n(13087),c=n(27458);const l={position:"absolute",zIndex:-1};function u(e,t){if("function"==typeof e)return e(t);if(Array.isArray(e))return e.map((e=>u(e,t)));if(d(e)){if(null===(n=e.props)||void 0===n?void 0:n.mapStyle)return t.style=l,(0,r.cloneElement)(e,t);if(function(e){const t=e.type;return t&&t.deckGLViewProps}(e))return(0,r.cloneElement)(e,t)}var n;return e}function d(e){return e&&"object"==typeof e&&"type"in e||!1}function f(e){if("function"==typeof e)return(0,r.createElement)(s.Z,{},e);if(Array.isArray(e))return e.map(f);if(d(e)){if(e.type===r.Fragment)return f(e.props.children);if(a(e.type,s.Z))return e}return e}const h={mixBlendMode:null};function p(e){e.redrawReason&&(e.deck._drawLayers(e.redrawReason),e.redrawReason=null)}const g=(0,r.forwardRef)(((e,t)=>{const[n,l]=(0,r.useState)(0),g=(0,r.useRef)({control:null,version:n,forceUpdate:()=>l((e=>e+1))}).current,y=(0,r.useRef)(null),v=(0,r.useRef)(null),m=(0,r.useMemo)((()=>function({children:e,layers:t=[],views:n=null}){const o=[],i=[],l={};return r.Children.forEach(f(e),(e=>{if(d(e)){const t=e.type;if(a(t,c.Z)){const n=function(e,t){const n={},r=e.defaultProps||{};for(const o in t)r[o]!==t[o]&&(n[o]=t[o]);return new e(n)}(t,e.props);i.push(n)}else o.push(e);if(a(t,s.Z)&&t!==s.Z&&e.props.id){const n=new t(e.props);l[n.id]=n}}else e&&o.push(e)})),Object.keys(l).length>0&&(Array.isArray(n)?n.forEach((e=>{l[e.id]=e})):n&&(l[n.id]=n),n=Object.values(l)),{layers:t=i.length>0?[...i,...t]:t,children:o,views:n}}(e)),[e.layers,e.views,e.children]);let w=!0;const b=t=>{var n;return w&&e.viewState?(g.viewStateUpdateRequested=t,null):(g.viewStateUpdateRequested=null,null===(n=e.onViewStateChange)||void 0===n?void 0:n.call(e,t))},x=t=>{var n;w?g.interactionStateUpdateRequested=t:(g.interactionStateUpdateRequested=null,null===(n=e.onInteractionStateChange)||void 0===n||n.call(e,t))},C=(0,r.useMemo)((()=>{const t={...e,style:null,width:"100%",height:"100%",parent:y.current,canvas:v.current,layers:m.layers,views:m.views,onViewStateChange:b,onInteractionStateChange:x};return delete t._customRender,g.deck&&g.deck.setProps(t),t}),[e]);(0,r.useEffect)((()=>{const t=e.Deck||o.Z;return g.deck=function(e,t,n){const r=new t({...n,_customRender:t=>{e.redrawReason=t;const n=r.getViewports();e.lastRenderedViewports!==n?e.forceUpdate():p(e)}});return r}(g,t,{...C,parent:y.current,canvas:v.current}),()=>{var e;return null===(e=g.deck)||void 0===e?void 0:e.finalize()}}),[]),i((()=>{p(g);const{viewStateUpdateRequested:e,interactionStateUpdateRequested:t}=g;e&&b(e),t&&x(t)})),(0,r.useImperativeHandle)(t,(()=>function(e){return{get deck(){return e.deck},pickObject:t=>e.deck.pickObject(t),pickMultipleObjects:t=>e.deck.pickMultipleObjects(t),pickObjects:t=>e.deck.pickObjects(t)}}(g)),[]);const _=g.deck&&g.deck.isInitialized?g.deck.getViewports():void 0,{ContextProvider:L,width:S,height:O,id:E,style:P}=e,{containerStyle:T,canvasStyle:U}=(0,r.useMemo)((()=>function({width:e,height:t,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:e,height:t},o={left:0,top:0};if(n)for(const i in n)i in h?o[i]=n[i]:r[i]=n[i];return{containerStyle:r,canvasStyle:o}}({width:S,height:O,style:P})),[S,O,P]);if(!g.viewStateUpdateRequested&&g.lastRenderedViewports===_||g.version!==n){g.lastRenderedViewports=_,g.version=n;const e=function({children:e,deck:t,ContextProvider:n}){const{viewManager:o}=t||{};if(!o||!o.views.length)return[];const i={},c=o.views[0].id;for(const r of e){let e=c,t=r;d(r)&&a(r.type,s.Z)&&(e=r.props.id||c,t=r.props.children);const n=o.getViewport(e),l=o.getViewState(e);if(n){l.padding=n.padding;const{x:r,y:o,width:a,height:s}=n;t=u(t,{x:r,y:o,width:a,height:s,viewport:n,viewState:l}),i[e]||(i[e]={viewport:n,children:[]}),i[e].children.push(t)}}return Object.keys(i).map((e=>{const{viewport:o,children:a}=i[e],{x:s,y:c,width:l,height:u}=o,d={position:"absolute",left:s,top:c,width:l,height:u},f="view-".concat(e),h=(0,r.createElement)("div",{key:f,id:f,style:d},...a);if(n){const i={viewport:o,container:t.canvas.offsetParent,eventManager:t.eventManager,onViewStateChange:n=>{n.viewId=e,t._onViewStateChange(n)}};return(0,r.createElement)(n,{key:f,value:i},h)}return h}))}({children:m.children,deck:g.deck,ContextProvider:L}),t=(0,r.createElement)("canvas",{key:"canvas",id:E||"deckgl-overlay",ref:v,style:U});g.control=(0,r.createElement)("div",{id:"".concat(E||"deckgl","-wrapper"),ref:y,style:T},[t,e])}return w=!1,g.control}));g.defaultProps=o.Z.defaultProps;const y=g},3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>p});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},d="mdxType",f={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=l(n),h=o,p=d["".concat(c,".").concat(h)]||d[h]||f[h]||i;return n?r.createElement(p,a(a({ref:t},u),{},{components:n})):r.createElement(p,a({ref:t},u))}));function p(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=h;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[d]="string"==typeof e?e:o,a[1]=s;for(var l=2;l<i;l++)a[l]=n[l];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},20745:(e,t,n)=>{var r=n(73935);r.createRoot,r.hydrateRoot},7725:(e,t,n)=>{n.d(t,{JJ:()=>ie});var r=(e,t,n)=>new Promise(((r,o)=>{var i=e=>{try{s(n.next(e))}catch(t){o(t)}},a=e=>{try{s(n.throw(e))}catch(t){o(t)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,a);s((n=n.apply(e,t)).next())})),o=Uint8Array,i=Uint16Array,a=Int32Array,s=new o([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),c=new o([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),l=new o([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=function(e,t){for(var n=new i(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var o=new a(n[30]);for(r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)o[s]=s-n[r]<<5|r;return{b:n,r:o}},d=u(s,2),f=d.b,h=d.r;f[28]=258,h[258]=28;var p,g=u(c,0),y=g.b,v=(g.r,new i(32768));for(b=0;b<32768;++b)p=(61680&(p=(52428&(p=(43690&b)>>1|(21845&b)<<1))>>2|(13107&p)<<2))>>4|(3855&p)<<4,v[b]=((65280&p)>>8|(255&p)<<8)>>1;var m=function(e,t,n){for(var r=e.length,o=0,a=new i(t);o<r;++o)e[o]&&++a[e[o]-1];var s,c=new i(t);for(o=1;o<t;++o)c[o]=c[o-1]+a[o-1]<<1;if(n){s=new i(1<<t);var l=15-t;for(o=0;o<r;++o)if(e[o])for(var u=o<<4|e[o],d=t-e[o],f=c[e[o]-1]++<<d,h=f|(1<<d)-1;f<=h;++f)s[v[f]>>l]=u}else for(s=new i(r),o=0;o<r;++o)e[o]&&(s[o]=v[c[e[o]-1]++]>>15-e[o]);return s},w=new o(288);for(b=0;b<144;++b)w[b]=8;for(b=144;b<256;++b)w[b]=9;for(b=256;b<280;++b)w[b]=7;for(b=280;b<288;++b)w[b]=8;var b,x=new o(32);for(b=0;b<32;++b)x[b]=5;var C=m(w,9,1),_=m(x,5,1),L=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},S=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},O=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},E=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],P=function(e,t,n){var r=new Error(t||E[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,P),!n)throw r;return r},T=function(e,t,n,r){var i=e.length,a=r?r.length:0;if(!i||t.f&&!t.l)return n||new o(0);var u=!n||2!=t.i,d=t.i;n||(n=new o(3*i));var h=function(e){var t=n.length;if(e>t){var r=new o(Math.max(2*t,e));r.set(n),n=r}},p=t.f||0,g=t.p||0,v=t.b||0,w=t.l,b=t.d,x=t.m,E=t.n,T=8*i;do{if(!w){p=S(e,g,1);var U=S(e,g+1,3);if(g+=3,!U){var k=e[(B=4+((g+7)/8|0))-4]|e[B-3]<<8,A=B+k;if(A>i){d&&P(0);break}u&&h(v+k),n.set(e.subarray(B,A),v),t.b=v+=k,t.p=g=8*A,t.f=p;continue}if(1==U)w=C,b=_,x=9,E=5;else if(2==U){var M=S(e,g,31)+257,D=S(e,g+10,15)+4,j=M+S(e,g+5,31)+1;g+=14;for(var R=new o(j),I=new o(19),Z=0;Z<D;++Z)I[l[Z]]=S(e,g+3*Z,7);g+=3*D;var z=L(I),V=(1<<z)-1,F=m(I,z,1);for(Z=0;Z<j;){var B,H=F[S(e,g,V)];if(g+=15&H,(B=H>>4)<16)R[Z++]=B;else{var N=0,G=0;for(16==B?(G=3+S(e,g,3),g+=2,N=R[Z-1]):17==B?(G=3+S(e,g,7),g+=3):18==B&&(G=11+S(e,g,127),g+=7);G--;)R[Z++]=N}}var K=R.subarray(0,M),W=R.subarray(M);x=L(K),E=L(W),w=m(K,x,1),b=m(W,E,1)}else P(1);if(g>T){d&&P(0);break}}u&&h(v+131072);for(var q=(1<<x)-1,J=(1<<E)-1,Y=g;;Y=g){var X=(N=w[O(e,g)&q])>>4;if((g+=15&N)>T){d&&P(0);break}if(N||P(2),X<256)n[v++]=X;else{if(256==X){Y=g,w=null;break}var $=X-254;if(X>264){var Q=s[Z=X-257];$=S(e,g,(1<<Q)-1)+f[Z],g+=Q}var ee=b[O(e,g)&J],te=ee>>4;ee||P(3),g+=15&ee;W=y[te];if(te>3){Q=c[te];W+=O(e,g)&(1<<Q)-1,g+=Q}if(g>T){d&&P(0);break}u&&h(v+131072);var ne=v+$;if(v<W){var re=a-W,oe=Math.min(W,ne);for(re+v<0&&P(3);v<oe;++v)n[v]=r[re+v]}for(;v<ne;v+=4)n[v]=n[v-W],n[v+1]=n[v+1-W],n[v+2]=n[v+2-W],n[v+3]=n[v+3-W];v=ne}}t.l=w,t.p=Y,t.b=v,t.f=p,w&&(p=1,t.m=x,t.d=b,t.n=E)}while(!p);return v==n.length?n:function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new o(n-t);return r.set(e.subarray(t,n)),r}(n,0,v)},U=new o(0),k=function(e){31==e[0]&&139==e[1]&&8==e[2]||P(6,"invalid gzip data");var t=e[3],n=10;4&t&&(n+=2+(e[10]|e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(2&t)},A=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},M=function(e,t){return(8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31)&&P(6,"invalid zlib data"),(e[1]>>5&1)==+!t&&P(6,"invalid zlib data: "+(32&e[1]?"need":"unexpected")+" dictionary"),2+(e[1]>>3&4)};function D(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?function(e,t){var n=k(e);return n+8>e.length&&P(6,"invalid gzip data"),T(e.subarray(n,-8),{i:2},t&&t.out||new o(A(e)),t&&t.dictionary)}(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?function(e,t){return T(e,{i:2},t&&t.out,t&&t.dictionary)}(e,t):function(e,t){return T(e.subarray(M(e,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}(e,t)}var j="undefined"!=typeof TextDecoder&&new TextDecoder;try{j.decode(U,{stream:!0}),1}catch(ae){}var R=(e,t)=>e*Math.pow(2,t),I=(e,t)=>Math.floor(e/Math.pow(2,t)),Z=(e,t)=>R(e.getUint16(t+1,!0),8)+e.getUint8(t),z=(e,t)=>R(e.getUint32(t+2,!0),16)+e.getUint16(t,!0),V=(e,t,n,r,o)=>{if(e!=r.getUint8(o))return e-r.getUint8(o);const i=Z(r,o+1);if(t!=i)return t-i;const a=Z(r,o+4);return n!=a?n-a:0},F=(e,t,n,r)=>{const o=B(e,t,n,r);return o?{z:t,x:n,y:r,offset:o[0],length:o[1],is_dir:!1}:null},B=(e,t,n,r)=>{let o=0,i=e.byteLength/17-1;for(;o<=i;){const a=i+o>>1,s=V(t,n,r,e,17*a);if(s>0)o=a+1;else{if(!(s<0))return[z(e,17*a+7),e.getUint32(17*a+13,!0)];i=a-1}}return null},H=(e,t)=>e.is_dir&&!t.is_dir?1:!e.is_dir&&t.is_dir?-1:e.z!==t.z?e.z-t.z:e.x!==t.x?e.x-t.x:e.y-t.y,N=(e,t)=>{const n=e.getUint8(17*t);return{z:127&n,x:Z(e,17*t+1),y:Z(e,17*t+4),offset:z(e,17*t+7),length:e.getUint32(17*t+13,!0),is_dir:n>>7==1}},G=e=>{const t=[],n=new DataView(e);for(let r=0;r<n.byteLength/17;r++)t.push(N(n,r));return K(t)},K=e=>{e.sort(H);const t=new ArrayBuffer(17*e.length),n=new Uint8Array(t);for(let r=0;r<e.length;r++){const t=e[r];let o=t.z;t.is_dir&&(o|=128),n[17*r]=o,n[17*r+1]=255&t.x,n[17*r+2]=t.x>>8&255,n[17*r+3]=t.x>>16&255,n[17*r+4]=255&t.y,n[17*r+5]=t.y>>8&255,n[17*r+6]=t.y>>16&255,n[17*r+7]=255&t.offset,n[17*r+8]=255&I(t.offset,8),n[17*r+9]=255&I(t.offset,16),n[17*r+10]=255&I(t.offset,24),n[17*r+11]=255&I(t.offset,32),n[17*r+12]=255&I(t.offset,48),n[17*r+13]=255&t.length,n[17*r+14]=t.length>>8&255,n[17*r+15]=t.length>>16&255,n[17*r+16]=t.length>>24&255}return t};var W={getHeader:function(e){return r(this,null,(function*(){const t=yield e.getBytes(0,512e3),n=new DataView(t.data),r=n.getUint32(4,!0),o=n.getUint16(8,!0),i=new TextDecoder("utf-8"),a=JSON.parse(i.decode(new DataView(t.data,10,r)));let s=0;"gzip"===a.compression&&(s=2);let c=0;"minzoom"in a&&(c=+a.minzoom);let l=0;"maxzoom"in a&&(l=+a.maxzoom);let u=0,d=0,f=0,h=-180,p=-85,g=180,y=85;if(a.bounds){const e=a.bounds.split(",");h=+e[0],p=+e[1],g=+e[2],y=+e[3]}if(a.center){const e=a.center.split(",");u=+e[0],d=+e[1],f=+e[2]}return{specVersion:n.getUint16(2,!0),rootDirectoryOffset:10+r,rootDirectoryLength:17*o,jsonMetadataOffset:10,jsonMetadataLength:r,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:s,tileType:1,minZoom:c,maxZoom:l,minLon:h,minLat:p,maxLon:g,maxLat:y,centerZoom:f,centerLon:u,centerLat:d,etag:t.etag}}))},getZxy:function(e,t,n,o,i,a,s){return r(this,null,(function*(){let r=yield n.getArrayBuffer(t,e.rootDirectoryOffset,e.rootDirectoryLength,e);1===e.specVersion&&(r=G(r));const c=F(new DataView(r),o,i,a);if(c){let e=(yield t.getBytes(c.offset,c.length,s)).data;const n=new DataView(e);return 31==n.getUint8(0)&&139==n.getUint8(1)&&(e=D(new Uint8Array(e))),{data:e}}const l=((e,t)=>{if(e.byteLength<17)return null;const n=e.byteLength/17,r=N(e,n-1);if(r.is_dir){const e=r.z,n=t.z-e;return{z:e,x:Math.trunc(t.x/(1<<n)),y:Math.trunc(t.y/(1<<n))}}return null})(new DataView(r),{z:o,x:i,y:a});if(l){const c=((e,t,n,r)=>{const o=B(e,128|t,n,r);return o?{z:t,x:n,y:r,offset:o[0],length:o[1],is_dir:!0}:null})(new DataView(r),l.z,l.x,l.y);if(c){let r=yield n.getArrayBuffer(t,c.offset,c.length,e);1===e.specVersion&&(r=G(r));const l=F(new DataView(r),o,i,a);if(l){let e=(yield t.getBytes(l.offset,l.length,s)).data;const n=new DataView(e);return 31==n.getUint8(0)&&139==n.getUint8(1)&&(e=D(new Uint8Array(e))),{data:e}}}}}))}};function q(e,t){return 4294967296*(t>>>0)+(e>>>0)}function J(e){const t=e.buf;let n,r;return r=t[e.pos++],n=127&r,r<128?n:(r=t[e.pos++],n|=(127&r)<<7,r<128?n:(r=t[e.pos++],n|=(127&r)<<14,r<128?n:(r=t[e.pos++],n|=(127&r)<<21,r<128?n:(r=t[e.pos],n|=(15&r)<<28,function(e,t){const n=t.buf;let r,o;if(o=n[t.pos++],r=(112&o)>>4,o<128)return q(e,r);if(o=n[t.pos++],r|=(127&o)<<3,o<128)return q(e,r);if(o=n[t.pos++],r|=(127&o)<<10,o<128)return q(e,r);if(o=n[t.pos++],r|=(127&o)<<17,o<128)return q(e,r);if(o=n[t.pos++],r|=(127&o)<<24,o<128)return q(e,r);if(o=n[t.pos++],r|=(1&o)<<31,o<128)return q(e,r);throw new Error("Expected varint not more than 10 bytes")}(n,e)))))}function Y(e,t,n,r){if(0==r){1==n&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const r=t[0];t[0]=t[1],t[1]=r}}var X=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function $(e,t){return r(this,null,(function*(){if(1===t||0===t)return e;if(2===t){if(void 0===globalThis.DecompressionStream)return D(new Uint8Array(e));{let t=new Response(e).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(t).arrayBuffer()}}throw Error("Compression method not supported")}))}function Q(e,t){let n=0,r=e.length-1;for(;n<=r;){const o=r+n>>1,i=t-e[o].tileId;if(i>0)n=o+1;else{if(!(i<0))return e[o];r=o-1}}if(r>=0){if(0===e[r].runLength)return e[r];if(t-e[r].tileId<e[r].runLength)return e[r]}return null}function ee(e,t){const n=e.getUint32(t+4,!0),r=e.getUint32(t+0,!0);return n*Math.pow(2,32)+r}function te(e){const t={buf:new Uint8Array(e),pos:0},n=J(t),r=[];let o=0;for(let i=0;i<n;i++){const e=J(t);r.push({tileId:o+e,offset:0,length:0,runLength:1}),o+=e}for(let i=0;i<n;i++)r[i].runLength=J(t);for(let i=0;i<n;i++)r[i].length=J(t);for(let i=0;i<n;i++){const e=J(t);r[i].offset=0===e&&i>0?r[i-1].offset+r[i-1].length:e-1}return r}var ne=class extends Error{};function re(e,t,n,o){return r(this,null,(function*(){const r=yield e.getBytes(0,16384);if(19792!==new DataView(r.data).getUint16(0,!0))throw new Error("Wrong magic number for PMTiles archive");if(function(e){const t=new DataView(e);return 2===t.getUint16(2,!0)?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):1===t.getUint16(2,!0)?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}(r.data)<3)return[yield W.getHeader(e)];const i=r.data.slice(0,127);let a=r.etag;o&&r.etag!=o&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+e.getKey()),a=void 0);const s=function(e,t){const n=new DataView(e),r=n.getUint8(7);if(r>3)throw Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:ee(n,8),rootDirectoryLength:ee(n,16),jsonMetadataOffset:ee(n,24),jsonMetadataLength:ee(n,32),leafDirectoryOffset:ee(n,40),leafDirectoryLength:ee(n,48),tileDataOffset:ee(n,56),tileDataLength:ee(n,64),numAddressedTiles:ee(n,72),numTileEntries:ee(n,80),numTileContents:ee(n,88),clustered:1===n.getUint8(96),internalCompression:n.getUint8(97),tileCompression:n.getUint8(98),tileType:n.getUint8(99),minZoom:n.getUint8(100),maxZoom:n.getUint8(101),minLon:n.getInt32(102,!0)/1e7,minLat:n.getInt32(106,!0)/1e7,maxLon:n.getInt32(110,!0)/1e7,maxLat:n.getInt32(114,!0)/1e7,centerZoom:n.getUint8(118),centerLon:n.getInt32(119,!0)/1e7,centerLat:n.getInt32(123,!0)/1e7,etag:t}}(i,a);if(n){const n=r.data.slice(s.rootDirectoryOffset,s.rootDirectoryOffset+s.rootDirectoryLength),o=e.getKey()+"|"+(s.etag||"")+"|"+s.rootDirectoryOffset+"|"+s.rootDirectoryLength,i=te(yield t(n,s.internalCompression));return[s,[o,i.length,i]]}return[s,void 0]}))}function oe(e,t,n,o,i){return r(this,null,(function*(){const r=yield e.getBytes(n,o);if(i.etag&&i.etag!==r.etag)throw new ne(r.etag);const a=te(yield t(r.data,i.internalCompression));if(0===a.length)throw new Error("Empty directory is invalid");return a}))}var ie=class{constructor(e,t,n){this.source="string"==typeof e?new class{constructor(e){this.url=e}getKey(){return this.url}getBytes(e,t,n){return r(this,null,(function*(){let r;n||(r=new AbortController,n=r.signal);let o=yield fetch(this.url,{signal:n,headers:{Range:"bytes="+e+"-"+(e+t-1)}});if(416===o.status&&0===e){const e=o.headers.get("Content-Range");if(!e||!e.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const t=+e.substr(8);o=yield fetch(this.url,{signal:n,headers:{Range:"bytes=0-"+(t-1)}})}if(o.status>=300)throw Error("Bad response code: "+o.status);const i=o.headers.get("Content-Length");if(200===o.status&&(!i||+i>t))throw r&&r.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield o.arrayBuffer(),etag:o.headers.get("ETag")||void 0,cacheControl:o.headers.get("Cache-Control")||void 0,expires:o.headers.get("Expires")||void 0}}))}}(e):e,this.decompress=n||$,this.cache=t||new class{constructor(e=100,t=!0,n=$){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.prefetch=t,this.decompress=n}getHeader(e,t){return r(this,null,(function*(){const n=e.getKey();if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;const r=new Promise(((n,r)=>{re(e,this.decompress,this.prefetch,t).then((e=>{e[1]&&this.cache.set(e[1][0],{lastUsed:this.counter++,data:Promise.resolve(e[1][2])}),n(e[0]),this.prune()})).catch((e=>{r(e)}))}));return this.cache.set(n,{lastUsed:this.counter++,data:r}),r}))}getDirectory(e,t,n,o){return r(this,null,(function*(){const r=e.getKey()+"|"+(o.etag||"")+"|"+t+"|"+n;if(this.cache.has(r))return this.cache.get(r).lastUsed=this.counter++,yield this.cache.get(r).data;const i=new Promise(((r,i)=>{oe(e,this.decompress,t,n,o).then((e=>{r(e),this.prune()})).catch((e=>{i(e)}))}));return this.cache.set(r,{lastUsed:this.counter++,data:i}),i}))}getArrayBuffer(e,t,n,o){return r(this,null,(function*(){const r=e.getKey()+"|"+(o.etag||"")+"|"+t+"|"+n;if(this.cache.has(r))return this.cache.get(r).lastUsed=this.counter++,yield this.cache.get(r).data;const i=new Promise(((i,a)=>{e.getBytes(t,n).then((e=>{if(o.etag&&o.etag!==e.etag)throw new ne(e.etag);i(e.data),this.cache.has(r),this.prune()})).catch((e=>{a(e)}))}));return this.cache.set(r,{lastUsed:this.counter++,data:i}),i}))}prune(){if(this.cache.size>=this.maxCacheEntries){let e,t=1/0;this.cache.forEach(((n,r)=>{n.lastUsed<t&&(t=n.lastUsed,e=r)})),e&&this.cache.delete(e)}}invalidate(e,t){return r(this,null,(function*(){this.cache.delete(e.getKey()),yield this.getHeader(e,t)}))}}}getHeader(){return r(this,null,(function*(){return yield this.cache.getHeader(this.source)}))}getZxyAttempt(e,t,n,o){return r(this,null,(function*(){const r=function(e,t,n){if(e>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(t>Math.pow(2,e)-1||n>Math.pow(2,e)-1)throw Error("tile x/y outside zoom level bounds");const r=X[e];let o=0,i=0,a=0;const s=[t,n];let c=Math.pow(2,e)/2;for(;c>0;)o=(s[0]&c)>0?1:0,i=(s[1]&c)>0?1:0,a+=c*c*(3*o^i),Y(c,s,o,i),c/=2;return r+a}(e,t,n),i=yield this.cache.getHeader(this.source);if(i.specVersion<3)return W.getZxy(i,this.source,this.cache,e,t,n,o);if(e<i.minZoom||e>i.maxZoom)return;let a=i.rootDirectoryOffset,s=i.rootDirectoryLength;for(let e=0;e<=3;e++){const e=Q(yield this.cache.getDirectory(this.source,a,s,i),r);if(!e)return;if(e.runLength>0){const t=yield this.source.getBytes(i.tileDataOffset+e.offset,e.length,o);if(i.etag&&i.etag!==t.etag)throw new ne(t.etag);return{data:yield this.decompress(t.data,i.tileCompression),cacheControl:t.cacheControl,expires:t.expires}}a=i.leafDirectoryOffset+e.offset,s=e.length}throw Error("Maximum directory depth exceeded")}))}getZxy(e,t,n,o){return r(this,null,(function*(){try{return yield this.getZxyAttempt(e,t,n,o)}catch(ae){if(ae instanceof ne)return this.cache.invalidate(this.source,ae.message),yield this.getZxyAttempt(e,t,n,o);throw ae}}))}getMetadataAttempt(){return r(this,null,(function*(){const e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength);if(e.etag&&e.etag!==t.etag)throw new ne(t.etag);const n=yield this.decompress(t.data,e.internalCompression),r=new TextDecoder("utf-8");return JSON.parse(r.decode(n))}))}getMetadata(){return r(this,null,(function*(){try{return yield this.getMetadataAttempt()}catch(ae){if(ae instanceof ne)return this.cache.invalidate(this.source,ae.message),yield this.getMetadataAttempt();throw ae}}))}}}}]);