/*! For license information please see 6879.046c8344.js.LICENSE.txt */
(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[6879],{13863:(t,e,n)=>{"use strict";n.d(e,{Z:()=>w});var r=n(81180),i=n(24088),o=n(27458),s=n(93844),a=n(59965),c=n(15462),u=n(53982),h=n(78866),l=n(14034);const f=new Uint16Array([0,2,1,0,3,2]),d=new Float32Array([0,1,0,0,1,0,1,1]);function p(t,e){if(!e)return function(t){const e=new Float64Array(12);for(let n=0;n<t.length;n++)e[3*n+0]=t[n][0],e[3*n+1]=t[n][1],e[3*n+2]=t[n][2]||0;return{vertexCount:6,positions:e,indices:f,texCoords:d}}(t);const n=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),r=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),i=Math.ceil(n/e)+1,o=Math.ceil(r/e)+1,s=(i-1)*(o-1)*6,a=new Uint32Array(s),c=new Float32Array(i*o*2),u=new Float64Array(i*o*3);let h=0,l=0;for(let f=0;f<i;f++){const e=f/(i-1);for(let n=0;n<o;n++){const r=n/(o-1),i=g(t,e,r);u[3*h+0]=i[0],u[3*h+1]=i[1],u[3*h+2]=i[2]||0,c[2*h+0]=e,c[2*h+1]=1-r,f>0&&n>0&&(a[l++]=h-o,a[l++]=h-o-1,a[l++]=h-1,a[l++]=h-o,a[l++]=h-1,a[l++]=h),h++}}return{vertexCount:s,positions:u,indices:a,texCoords:c}}function g(t,e,n){return(0,l.t7)((0,l.t7)(t[0],t[1],n),(0,l.t7)(t[3],t[2],n),e)}const v="\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nvarying vec2 vTexCoord;\nvarying vec2 vTexPos;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\n\nuniform float coordinateConversion;\nuniform vec4 bounds;\n\n/* projection utils */\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / PI / 2.0;\n\n// from degrees to Web Mercator\nvec2 lnglat_to_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// from Web Mercator to degrees\nvec2 mercator_to_lnglat(vec2 xy) {\n  xy /= WORLD_SCALE;\n  return degrees(vec2(\n    xy.x - PI,\n    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5\n  ));\n}\n/* End projection utils */\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  if (transparentColor.a == 0.0) {\n    return vec4(color, alpha);\n  }\n  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);\n  float highLightRatio = alpha / blendedAlpha;\n  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);\n  return vec4(blendedRGB, blendedAlpha);\n}\n\nvec2 getUV(vec2 pos) {\n  return vec2(\n    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),\n    (pos.y - bounds[3]) / (bounds[1] - bounds[3])\n  );\n}\n\n".concat("\nvec3 packUVsIntoRGB(vec2 uv) {\n  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction\n  vec2 uv8bit = floor(uv * 256.);\n\n  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits\n  // Scale and clamp to 0-1 range\n  vec2 uvFraction = fract(uv * 256.);\n  vec2 uvFraction4bit = floor(uvFraction * 16.);\n\n  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates\n  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;\n\n  return vec3(uv8bit, fractions) / 255.;\n}\n","\n\nvoid main(void) {\n  vec2 uv = vTexCoord;\n  if (coordinateConversion < -0.5) {\n    vec2 lnglat = mercator_to_lnglat(vTexPos);\n    uv = getUV(lnglat);\n  } else if (coordinateConversion > 0.5) {\n    vec2 commonPos = lnglat_to_mercator(vTexPos);\n    uv = getUV(commonPos);\n  }\n  vec4 bitmapColor = texture2D(bitmapTexture, uv);\n\n  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);\n\n  geometry.uv = uv;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n\n  if (picking_uActive && !picking_uAttribute) {\n    // Since instance information is not used, we can use picking color for pixel index\n    gl_FragColor.rgb = packUVsIntoRGB(uv);\n  }\n}\n"),y={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:i.COORDINATE_SYSTEM.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0}};class w extends o.Z{constructor(...t){super(...t),(0,r.Z)(this,"state",void 0)}getShaders(){return super.getShaders({vs:"\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nattribute vec2 texCoords;\nattribute vec3 positions;\nattribute vec3 positions64Low;\n\nvarying vec2 vTexCoord;\nvarying vec2 vTexPos;\n\nuniform float coordinateConversion;\n\nconst vec3 pickingColor = vec3(1.0, 0.0, 0.0);\n\nvoid main(void) {\n  geometry.worldPosition = positions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = pickingColor;\n\n  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTexCoord = texCoords;\n\n  if (coordinateConversion < -0.5) {\n    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;\n  } else if (coordinateConversion > 0.5) {\n    vTexPos = geometry.worldPosition.xy;\n  }\n\n  vec4 color = vec4(0.0);\n  DECKGL_FILTER_COLOR(color, geometry);\n}\n",fs:v,modules:[s.Z,a.Z]})}initializeState(){const t=this.getAttributeManager();t.remove(["instancePickingColors"]);const e=!0;t.add({indices:{size:1,isIndexed:!0,update:t=>t.value=this.state.mesh.indices,noAlloc:e},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:t=>t.value=this.state.mesh.positions,noAlloc:e},texCoords:{size:2,update:t=>t.value=this.state.mesh.texCoords,noAlloc:e}})}updateState({props:t,oldProps:e,changeFlags:n}){const r=this.getAttributeManager();if(n.extensionsChanged){var i;const{gl:t}=this.context;null===(i=this.state.model)||void 0===i||i.delete(),this.state.model=this._getModel(t),r.invalidateAll()}if(t.bounds!==e.bounds){const t=this.state.mesh,e=this._createMesh();this.state.model.setVertexCount(e.vertexCount);for(const n in e)t&&t[n]!==e[n]&&r.invalidate(n);this.setState({mesh:e,...this._getCoordinateUniforms()})}else t._imageCoordinateSystem!==e._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(t){const{image:e}=this.props,n=t.info;if(!n.color||!e)return n.bitmap=null,n;const{width:r,height:i}=e;n.index=0;const o=function(t){const[e,n,r]=t;return[(e+(15&r)/16)/256,(n+(240&r)/256)/256]}(n.color),s=[Math.floor(o[0]*r),Math.floor(o[1]*i)];return n.bitmap={size:{width:r,height:i},uv:o,pixel:s},n}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(t){super._updateAutoHighlight({...t,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:t}=this.props;let e=t;return m(t)&&(e=[[t[0],t[1]],[t[0],t[3]],[t[2],t[3]],[t[2],t[1]]]),p(e,this.context.viewport.resolution)}_getModel(t){return t?new c.Z(t,{...this.getShaders(),id:this.props.id,geometry:new u.Z({drawMode:4,vertexCount:6}),isInstanced:!1}):null}draw(t){const{uniforms:e,moduleParameters:n}=t,{model:r,coordinateConversion:i,bounds:o,disablePicking:s}=this.state,{image:a,desaturate:c,transparentColor:u,tintColor:h}=this.props;n.pickingActive&&s||a&&r&&r.setUniforms(e).setUniforms({bitmapTexture:a,desaturate:c,transparentColor:u.map((t=>t/255)),tintColor:h.slice(0,3).map((t=>t/255)),coordinateConversion:i,bounds:o}).draw()}_getCoordinateUniforms(){const{LNGLAT:t,CARTESIAN:e,DEFAULT:n}=i.COORDINATE_SYSTEM;let{_imageCoordinateSystem:r}=this.props;if(r!==n){const{bounds:n}=this.props;if(!m(n))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const i=this.context.viewport.resolution?t:e;if(r=r===t?t:e,r===t&&i===e)return{coordinateConversion:-1,bounds:n};if(r===e&&i===t){const t=(0,h.w5)([n[0],n[1]]),e=(0,h.w5)([n[2],n[3]]);return{coordinateConversion:1,bounds:[t[0],t[1],e[0],e[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}function m(t){return Number.isFinite(t[0])}(0,r.Z)(w,"layerName","BitmapLayer"),(0,r.Z)(w,"defaultProps",y)},80645:(t,e)=>{e.read=function(t,e,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,u=c>>1,h=-7,l=n?i-1:0,f=n?-1:1,d=t[e+l];for(l+=f,o=d&(1<<-h)-1,d>>=-h,h+=a;h>0;o=256*o+t[e+l],l+=f,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=r;h>0;s=256*s+t[e+l],l+=f,h-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=u}return(d?-1:1)*s*Math.pow(2,o-r)},e.write=function(t,e,n,r,i,o){var s,a,c,u=8*o-i-1,h=(1<<u)-1,l=h>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,p=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-s))<1&&(s--,c*=2),(e+=s+l>=1?f/c:f*Math.pow(2,1-l))*c>=2&&(s++,c/=2),s+l>=h?(a=0,s=h):s+l>=1?(a=(e*c-1)*Math.pow(2,i),s+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,i),s=0));i>=8;t[n+d]=255&a,d+=p,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;t[n+d]=255&s,d+=p,s/=256,u-=8);t[n+d-p]|=128*g}},3614:(t,e,n)=>{"use strict";t.exports=i;var r=n(80645);function i(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var o=4294967296,s=1/o,a="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function c(t){return t.type===i.Bytes?t.readVarint()+t.pos:t.pos+1}function u(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function h(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=t;i--)n.buf[i+r]=n.buf[i]}function l(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function f(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function d(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function p(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function g(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function v(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function y(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function w(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function m(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function b(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function x(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function C(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}i.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,t(i,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=b(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=C(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=b(this.buf,this.pos)+b(this.buf,this.pos+4)*o;return this.pos+=8,t},readSFixed64:function(){var t=b(this.buf,this.pos)+C(this.buf,this.pos+4)*o;return this.pos+=8,t},readFloat:function(){var t=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,r=this.buf;return e=127&(n=r[this.pos++]),n<128?e:(e|=(127&(n=r[this.pos++]))<<7,n<128?e:(e|=(127&(n=r[this.pos++]))<<14,n<128?e:(e|=(127&(n=r[this.pos++]))<<21,n<128?e:function(t,e,n){var r,i,o=n.buf;if(i=o[n.pos++],r=(112&i)>>4,i<128)return u(t,r,e);if(i=o[n.pos++],r|=(127&i)<<3,i<128)return u(t,r,e);if(i=o[n.pos++],r|=(127&i)<<10,i<128)return u(t,r,e);if(i=o[n.pos++],r|=(127&i)<<17,i<128)return u(t,r,e);if(i=o[n.pos++],r|=(127&i)<<24,i<128)return u(t,r,e);if(i=o[n.pos++],r|=(1&i)<<31,i<128)return u(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&a?function(t,e,n){return a.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){var r="",i=e;for(;i<n;){var o,s,a,c=t[i],u=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h>n)break;1===h?c<128&&(u=c):2===h?128==(192&(o=t[i+1]))&&(u=(31&c)<<6|63&o)<=127&&(u=null):3===h?(o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&((u=(15&c)<<12|(63&o)<<6|63&s)<=2047||u>=55296&&u<=57343)&&(u=null)):4===h&&(o=t[i+1],s=t[i+2],a=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&((u=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,h=1):u>65535&&(u-=65536,r+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),r+=String.fromCharCode(u),i+=h}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==i.Bytes)return t.push(this.readVarint(e));var n=c(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==i.Bytes)return t.push(this.readSVarint());var e=c(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==i.Bytes)return t.push(this.readBoolean());var e=c(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==i.Bytes)return t.push(this.readFloat());var e=c(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==i.Bytes)return t.push(this.readDouble());var e=c(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==i.Bytes)return t.push(this.readFixed32());var e=c(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==i.Bytes)return t.push(this.readSFixed32());var e=c(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==i.Bytes)return t.push(this.readFixed64());var e=c(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==i.Bytes)return t.push(this.readSFixed64());var e=c(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===i.Varint)for(;this.buf[this.pos++]>127;);else if(e===i.Bytes)this.pos=this.readVarint()+this.pos;else if(e===i.Fixed32)this.pos+=4;else{if(e!==i.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),x(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),x(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),x(this.buf,-1&t,this.pos),x(this.buf,Math.floor(t*s),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),x(this.buf,-1&t,this.pos),x(this.buf,Math.floor(t*s),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,r;t>=0?(n=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,r=r+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos]=127&t}(n,0,e),function(t,e){var n=(7&t)<<4;if(e.buf[e.pos++]|=n|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var r,i,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):i=r;continue}if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(t[n++]=239,t[n++]=191,t[n++]=189,i=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&h(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),r.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),r.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&h(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,i.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,l,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,g,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,v,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,y,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,w,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,m,e)},writeBytesField:function(t,e){this.writeTag(t,i.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,i.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,i.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,i.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},7725:(t,e,n)=>{"use strict";n.d(e,{PMTiles:()=>ut,TileType:()=>tt});var r=n(25108),i=(t,e,n)=>new Promise(((r,i)=>{var o=t=>{try{a(n.next(t))}catch(e){i(e)}},s=t=>{try{a(n.throw(t))}catch(e){i(e)}},a=t=>t.done?r(t.value):Promise.resolve(t.value).then(o,s);a((n=n.apply(t,e)).next())})),o=Uint8Array,s=Uint16Array,a=Int32Array,c=new o([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),u=new o([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),h=new o([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),l=function(t,e){for(var n=new s(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];var i=new a(n[30]);for(r=1;r<30;++r)for(var o=n[r];o<n[r+1];++o)i[o]=o-n[r]<<5|r;return{b:n,r:i}},f=l(c,2),d=f.b,p=f.r;d[28]=258,p[258]=28;var g,v=l(u,0),y=v.b,w=(v.r,new s(32768));for(x=0;x<32768;++x)g=(61680&(g=(52428&(g=(43690&x)>>1|(21845&x)<<1))>>2|(13107&g)<<2))>>4|(3855&g)<<4,w[x]=((65280&g)>>8|(255&g)<<8)>>1;var m=function(t,e,n){for(var r=t.length,i=0,o=new s(e);i<r;++i)t[i]&&++o[t[i]-1];var a,c=new s(e);for(i=1;i<e;++i)c[i]=c[i-1]+o[i-1]<<1;if(n){a=new s(1<<e);var u=15-e;for(i=0;i<r;++i)if(t[i])for(var h=i<<4|t[i],l=e-t[i],f=c[t[i]-1]++<<l,d=f|(1<<l)-1;f<=d;++f)a[w[f]>>u]=h}else for(a=new s(r),i=0;i<r;++i)t[i]&&(a[i]=w[c[t[i]-1]++]>>15-t[i]);return a},b=new o(288);for(x=0;x<144;++x)b[x]=8;for(x=144;x<256;++x)b[x]=9;for(x=256;x<280;++x)b[x]=7;for(x=280;x<288;++x)b[x]=8;var x,C=new o(32);for(x=0;x<32;++x)C[x]=5;var F=m(b,9,1),M=m(C,5,1),T=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},S=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(7&e)&n},D=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},P=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],_=function(t,e,n){var r=new Error(e||P[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,_),!n)throw r;return r},U=function(t,e,n,r){var i=t.length,s=r?r.length:0;if(!i||e.f&&!e.l)return n||new o(0);var a=!n||2!=e.i,l=e.i;n||(n=new o(3*i));var f=function(t){var e=n.length;if(t>e){var r=new o(Math.max(2*e,t));r.set(n),n=r}},p=e.f||0,g=e.p||0,v=e.b||0,w=e.l,b=e.d,x=e.m,C=e.n,P=8*i;do{if(!w){p=S(t,g,1);var U=S(t,g+1,3);if(g+=3,!U){var L=t[(N=4+((g+7)/8|0))-4]|t[N-3]<<8,V=N+L;if(V>i){l&&_(0);break}a&&f(v+L),n.set(t.subarray(N,V),v),e.b=v+=L,e.p=g=8*V,e.f=p;continue}if(1==U)w=F,b=M,x=9,C=5;else if(2==U){var A=S(t,g,31)+257,E=S(t,g+10,15)+4,k=A+S(t,g+5,31)+1;g+=14;for(var B=new o(k),I=new o(19),z=0;z<E;++z)I[h[z]]=S(t,g+3*z,7);g+=3*E;var O=T(I),R=(1<<O)-1,Z=m(I,O,1);for(z=0;z<k;){var N,H=Z[S(t,g,R)];if(g+=15&H,(N=H>>4)<16)B[z++]=N;else{var j=0,G=0;for(16==N?(G=3+S(t,g,3),g+=2,j=B[z-1]):17==N?(G=3+S(t,g,7),g+=3):18==N&&(G=11+S(t,g,127),g+=7);G--;)B[z++]=j}}var K=B.subarray(0,A),W=B.subarray(A);x=T(K),C=T(W),w=m(K,x,1),b=m(W,C,1)}else _(1);if(g>P){l&&_(0);break}}a&&f(v+131072);for(var J=(1<<x)-1,Y=(1<<C)-1,q=g;;q=g){var $=(j=w[D(t,g)&J])>>4;if((g+=15&j)>P){l&&_(0);break}if(j||_(2),$<256)n[v++]=$;else{if(256==$){q=g,w=null;break}var Q=$-254;if($>264){var X=c[z=$-257];Q=S(t,g,(1<<X)-1)+d[z],g+=X}var tt=b[D(t,g)&Y],et=tt>>4;tt||_(3),g+=15&tt;W=y[et];if(et>3){X=u[et];W+=D(t,g)&(1<<X)-1,g+=X}if(g>P){l&&_(0);break}a&&f(v+131072);var nt=v+Q;if(v<W){var rt=s-W,it=Math.min(W,nt);for(rt+v<0&&_(3);v<it;++v)n[v]=r[rt+v]}for(;v<nt;v+=4)n[v]=n[v-W],n[v+1]=n[v+1-W],n[v+2]=n[v+2-W],n[v+3]=n[v+3-W];v=nt}}e.l=w,e.p=q,e.b=v,e.f=p,w&&(p=1,e.m=x,e.d=b,e.n=C)}while(!p);return v==n.length?n:function(t,e,n){(null==e||e<0)&&(e=0),(null==n||n>t.length)&&(n=t.length);var r=new o(n-e);return r.set(t.subarray(e,n)),r}(n,0,v)},L=new o(0),V=function(t){31==t[0]&&139==t[1]&&8==t[2]||_(6,"invalid gzip data");var e=t[3],n=10;4&e&&(n+=2+(t[10]|t[11]<<8));for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!t[n++]);return n+(2&e)},A=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},E=function(t,e){return(8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31)&&_(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&_(6,"invalid zlib data: "+(32&t[1]?"need":"unexpected")+" dictionary"),2+(t[1]>>3&4)};function k(t,e){return 31==t[0]&&139==t[1]&&8==t[2]?function(t,e){var n=V(t);return n+8>t.length&&_(6,"invalid gzip data"),U(t.subarray(n,-8),{i:2},e&&e.out||new o(A(t)),e&&e.dictionary)}(t,e):8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31?function(t,e){return U(t,{i:2},e&&e.out,e&&e.dictionary)}(t,e):function(t,e){return U(t.subarray(E(t,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}(t,e)}var B="undefined"!=typeof TextDecoder&&new TextDecoder;try{B.decode(L,{stream:!0}),1}catch(ht){}var I=(t,e)=>t*Math.pow(2,e),z=(t,e)=>Math.floor(t/Math.pow(2,e)),O=(t,e)=>I(t.getUint16(e+1,!0),8)+t.getUint8(e),R=(t,e)=>I(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),Z=(t,e,n,r,i)=>{if(t!=r.getUint8(i))return t-r.getUint8(i);const o=O(r,i+1);if(e!=o)return e-o;const s=O(r,i+4);return n!=s?n-s:0},N=(t,e,n,r)=>{const i=H(t,e,n,r);return i?{z:e,x:n,y:r,offset:i[0],length:i[1],is_dir:!1}:null},H=(t,e,n,r)=>{let i=0,o=t.byteLength/17-1;for(;i<=o;){const s=o+i>>1,a=Z(e,n,r,t,17*s);if(a>0)i=s+1;else{if(!(a<0))return[R(t,17*s+7),t.getUint32(17*s+13,!0)];o=s-1}}return null},j=(t,e)=>t.is_dir&&!e.is_dir?1:!t.is_dir&&e.is_dir?-1:t.z!==e.z?t.z-e.z:t.x!==e.x?t.x-e.x:t.y-e.y,G=(t,e)=>{const n=t.getUint8(17*e);return{z:127&n,x:O(t,17*e+1),y:O(t,17*e+4),offset:R(t,17*e+7),length:t.getUint32(17*e+13,!0),is_dir:n>>7==1}},K=t=>{const e=[],n=new DataView(t);for(let r=0;r<n.byteLength/17;r++)e.push(G(n,r));return W(e)},W=t=>{t.sort(j);const e=new ArrayBuffer(17*t.length),n=new Uint8Array(e);for(let r=0;r<t.length;r++){const e=t[r];let i=e.z;e.is_dir&&(i|=128),n[17*r]=i,n[17*r+1]=255&e.x,n[17*r+2]=e.x>>8&255,n[17*r+3]=e.x>>16&255,n[17*r+4]=255&e.y,n[17*r+5]=e.y>>8&255,n[17*r+6]=e.y>>16&255,n[17*r+7]=255&e.offset,n[17*r+8]=255&z(e.offset,8),n[17*r+9]=255&z(e.offset,16),n[17*r+10]=255&z(e.offset,24),n[17*r+11]=255&z(e.offset,32),n[17*r+12]=255&z(e.offset,48),n[17*r+13]=255&e.length,n[17*r+14]=e.length>>8&255,n[17*r+15]=e.length>>16&255,n[17*r+16]=e.length>>24&255}return e};var J={getHeader:function(t){return i(this,null,(function*(){const e=yield t.getBytes(0,512e3),n=new DataView(e.data),r=n.getUint32(4,!0),i=n.getUint16(8,!0),o=new TextDecoder("utf-8"),s=JSON.parse(o.decode(new DataView(e.data,10,r)));let a=0;"gzip"===s.compression&&(a=2);let c=0;"minzoom"in s&&(c=+s.minzoom);let u=0;"maxzoom"in s&&(u=+s.maxzoom);let h=0,l=0,f=0,d=-180,p=-85,g=180,v=85;if(s.bounds){const t=s.bounds.split(",");d=+t[0],p=+t[1],g=+t[2],v=+t[3]}if(s.center){const t=s.center.split(",");h=+t[0],l=+t[1],f=+t[2]}return{specVersion:n.getUint16(2,!0),rootDirectoryOffset:10+r,rootDirectoryLength:17*i,jsonMetadataOffset:10,jsonMetadataLength:r,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:c,maxZoom:u,minLon:d,minLat:p,maxLon:g,maxLat:v,centerZoom:f,centerLon:h,centerLat:l,etag:e.etag}}))},getZxy:function(t,e,n,r,o,s,a){return i(this,null,(function*(){let i=yield n.getArrayBuffer(e,t.rootDirectoryOffset,t.rootDirectoryLength,t);1===t.specVersion&&(i=K(i));const c=N(new DataView(i),r,o,s);if(c){let t=(yield e.getBytes(c.offset,c.length,a)).data;const n=new DataView(t);return 31==n.getUint8(0)&&139==n.getUint8(1)&&(t=k(new Uint8Array(t))),{data:t}}const u=((t,e)=>{if(t.byteLength<17)return null;const n=t.byteLength/17,r=G(t,n-1);if(r.is_dir){const t=r.z,n=e.z-t;return{z:t,x:Math.trunc(e.x/(1<<n)),y:Math.trunc(e.y/(1<<n))}}return null})(new DataView(i),{z:r,x:o,y:s});if(u){const c=((t,e,n,r)=>{const i=H(t,128|e,n,r);return i?{z:e,x:n,y:r,offset:i[0],length:i[1],is_dir:!0}:null})(new DataView(i),u.z,u.x,u.y);if(c){let i=yield n.getArrayBuffer(e,c.offset,c.length,t);1===t.specVersion&&(i=K(i));const u=N(new DataView(i),r,o,s);if(u){let t=(yield e.getBytes(u.offset,u.length,a)).data;const n=new DataView(t);return 31==n.getUint8(0)&&139==n.getUint8(1)&&(t=k(new Uint8Array(t))),{data:t}}}}}))}};function Y(t,e){return 4294967296*(e>>>0)+(t>>>0)}function q(t){const e=t.buf;let n,r;return r=e[t.pos++],n=127&r,r<128?n:(r=e[t.pos++],n|=(127&r)<<7,r<128?n:(r=e[t.pos++],n|=(127&r)<<14,r<128?n:(r=e[t.pos++],n|=(127&r)<<21,r<128?n:(r=e[t.pos],n|=(15&r)<<28,function(t,e){const n=e.buf;let r,i;if(i=n[e.pos++],r=(112&i)>>4,i<128)return Y(t,r);if(i=n[e.pos++],r|=(127&i)<<3,i<128)return Y(t,r);if(i=n[e.pos++],r|=(127&i)<<10,i<128)return Y(t,r);if(i=n[e.pos++],r|=(127&i)<<17,i<128)return Y(t,r);if(i=n[e.pos++],r|=(127&i)<<24,i<128)return Y(t,r);if(i=n[e.pos++],r|=(1&i)<<31,i<128)return Y(t,r);throw new Error("Expected varint not more than 10 bytes")}(n,t)))))}function $(t,e,n,r){if(0==r){1==n&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const r=e[0];e[0]=e[1],e[1]=r}}var Q=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function X(t,e){return i(this,null,(function*(){if(1===e||0===e)return t;if(2===e){if(void 0===globalThis.DecompressionStream)return k(new Uint8Array(t));{let e=new Response(t).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(e).arrayBuffer()}}throw Error("Compression method not supported")}))}var tt=(t=>(t[t.Unknown=0]="Unknown",t[t.Mvt=1]="Mvt",t[t.Png=2]="Png",t[t.Jpeg=3]="Jpeg",t[t.Webp=4]="Webp",t[t.Avif=5]="Avif",t))(tt||{});function et(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=r+n>>1,o=e-t[i].tileId;if(o>0)n=i+1;else{if(!(o<0))return t[i];r=i-1}}if(r>=0){if(0===t[r].runLength)return t[r];if(e-t[r].tileId<t[r].runLength)return t[r]}return null}var nt=class{constructor(t){this.url=t}getKey(){return this.url}getBytes(t,e,n){return i(this,null,(function*(){let r;n||(r=new AbortController,n=r.signal);let i=yield fetch(this.url,{signal:n,headers:{Range:"bytes="+t+"-"+(t+e-1)}});if(416===i.status&&0===t){const t=i.headers.get("Content-Range");if(!t||!t.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const e=+t.substr(8);i=yield fetch(this.url,{signal:n,headers:{Range:"bytes=0-"+(e-1)}})}if(i.status>=300)throw Error("Bad response code: "+i.status);const o=i.headers.get("Content-Length");if(200===i.status&&(!o||+o>e))throw r&&r.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield i.arrayBuffer(),etag:i.headers.get("ETag")||void 0,cacheControl:i.headers.get("Cache-Control")||void 0,expires:i.headers.get("Expires")||void 0}}))}};function rt(t,e){const n=t.getUint32(e+4,!0),r=t.getUint32(e+0,!0);return n*Math.pow(2,32)+r}function it(t){const e={buf:new Uint8Array(t),pos:0},n=q(e),r=[];let i=0;for(let o=0;o<n;o++){const t=q(e);r.push({tileId:i+t,offset:0,length:0,runLength:1}),i+=t}for(let o=0;o<n;o++)r[o].runLength=q(e);for(let o=0;o<n;o++)r[o].length=q(e);for(let o=0;o<n;o++){const t=q(e);r[o].offset=0===t&&o>0?r[o-1].offset+r[o-1].length:t-1}return r}var ot=class extends Error{};function st(t,e,n,o){return i(this,null,(function*(){const i=yield t.getBytes(0,16384);if(19792!==new DataView(i.data).getUint16(0,!0))throw new Error("Wrong magic number for PMTiles archive");if(function(t){const e=new DataView(t);return 2===e.getUint16(2,!0)?(r.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):1===e.getUint16(2,!0)?(r.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}(i.data)<3)return[yield J.getHeader(t)];const s=i.data.slice(0,127);let a=i.etag;o&&i.etag!=o&&(r.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+t.getKey()),a=void 0);const c=function(t,e){const n=new DataView(t),r=n.getUint8(7);if(r>3)throw Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:rt(n,8),rootDirectoryLength:rt(n,16),jsonMetadataOffset:rt(n,24),jsonMetadataLength:rt(n,32),leafDirectoryOffset:rt(n,40),leafDirectoryLength:rt(n,48),tileDataOffset:rt(n,56),tileDataLength:rt(n,64),numAddressedTiles:rt(n,72),numTileEntries:rt(n,80),numTileContents:rt(n,88),clustered:1===n.getUint8(96),internalCompression:n.getUint8(97),tileCompression:n.getUint8(98),tileType:n.getUint8(99),minZoom:n.getUint8(100),maxZoom:n.getUint8(101),minLon:n.getInt32(102,!0)/1e7,minLat:n.getInt32(106,!0)/1e7,maxLon:n.getInt32(110,!0)/1e7,maxLat:n.getInt32(114,!0)/1e7,centerZoom:n.getUint8(118),centerLon:n.getInt32(119,!0)/1e7,centerLat:n.getInt32(123,!0)/1e7,etag:e}}(s,a);if(n){const n=i.data.slice(c.rootDirectoryOffset,c.rootDirectoryOffset+c.rootDirectoryLength),r=t.getKey()+"|"+(c.etag||"")+"|"+c.rootDirectoryOffset+"|"+c.rootDirectoryLength,o=it(yield e(n,c.internalCompression));return[c,[r,o.length,o]]}return[c,void 0]}))}function at(t,e,n,r,o){return i(this,null,(function*(){const i=yield t.getBytes(n,r);if(o.etag&&o.etag!==i.etag)throw new ot(i.etag);const s=it(yield e(i.data,o.internalCompression));if(0===s.length)throw new Error("Empty directory is invalid");return s}))}var ct=class{constructor(t=100,e=!0,n=X){this.cache=new Map,this.maxCacheEntries=t,this.counter=1,this.prefetch=e,this.decompress=n}getHeader(t,e){return i(this,null,(function*(){const n=t.getKey();if(this.cache.has(n)){this.cache.get(n).lastUsed=this.counter++;return yield this.cache.get(n).data}const r=new Promise(((n,r)=>{st(t,this.decompress,this.prefetch,e).then((t=>{t[1]&&this.cache.set(t[1][0],{lastUsed:this.counter++,data:Promise.resolve(t[1][2])}),n(t[0]),this.prune()})).catch((t=>{r(t)}))}));return this.cache.set(n,{lastUsed:this.counter++,data:r}),r}))}getDirectory(t,e,n,r){return i(this,null,(function*(){const i=t.getKey()+"|"+(r.etag||"")+"|"+e+"|"+n;if(this.cache.has(i)){this.cache.get(i).lastUsed=this.counter++;return yield this.cache.get(i).data}const o=new Promise(((i,o)=>{at(t,this.decompress,e,n,r).then((t=>{i(t),this.prune()})).catch((t=>{o(t)}))}));return this.cache.set(i,{lastUsed:this.counter++,data:o}),o}))}getArrayBuffer(t,e,n,r){return i(this,null,(function*(){const i=t.getKey()+"|"+(r.etag||"")+"|"+e+"|"+n;if(this.cache.has(i)){this.cache.get(i).lastUsed=this.counter++;return yield this.cache.get(i).data}const o=new Promise(((o,s)=>{t.getBytes(e,n).then((t=>{if(r.etag&&r.etag!==t.etag)throw new ot(t.etag);o(t.data),this.cache.has(i),this.prune()})).catch((t=>{s(t)}))}));return this.cache.set(i,{lastUsed:this.counter++,data:o}),o}))}prune(){if(this.cache.size>=this.maxCacheEntries){let t,e=1/0;this.cache.forEach(((n,r)=>{n.lastUsed<e&&(e=n.lastUsed,t=r)})),t&&this.cache.delete(t)}}invalidate(t,e){return i(this,null,(function*(){this.cache.delete(t.getKey()),yield this.getHeader(t,e)}))}},ut=class{constructor(t,e,n){this.source="string"==typeof t?new nt(t):t,this.decompress=n||X,this.cache=e||new ct}getHeader(){return i(this,null,(function*(){return yield this.cache.getHeader(this.source)}))}getZxyAttempt(t,e,n,r){return i(this,null,(function*(){const i=function(t,e,n){if(t>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,t)-1||n>Math.pow(2,t)-1)throw Error("tile x/y outside zoom level bounds");const r=Q[t];let i=0,o=0,s=0;const a=[e,n];let c=Math.pow(2,t)/2;for(;c>0;)i=(a[0]&c)>0?1:0,o=(a[1]&c)>0?1:0,s+=c*c*(3*i^o),$(c,a,i,o),c/=2;return r+s}(t,e,n),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return J.getZxy(o,this.source,this.cache,t,e,n,r);if(t<o.minZoom||t>o.maxZoom)return;let s=o.rootDirectoryOffset,a=o.rootDirectoryLength;for(let t=0;t<=3;t++){const t=et(yield this.cache.getDirectory(this.source,s,a,o),i);if(!t)return;if(t.runLength>0){const e=yield this.source.getBytes(o.tileDataOffset+t.offset,t.length,r);if(o.etag&&o.etag!==e.etag)throw new ot(e.etag);return{data:yield this.decompress(e.data,o.tileCompression),cacheControl:e.cacheControl,expires:e.expires}}s=o.leafDirectoryOffset+t.offset,a=t.length}throw Error("Maximum directory depth exceeded")}))}getZxy(t,e,n,r){return i(this,null,(function*(){try{return yield this.getZxyAttempt(t,e,n,r)}catch(ht){if(ht instanceof ot)return this.cache.invalidate(this.source,ht.message),yield this.getZxyAttempt(t,e,n,r);throw ht}}))}getMetadataAttempt(){return i(this,null,(function*(){const t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength);if(t.etag&&t.etag!==e.etag)throw new ot(e.etag);const n=yield this.decompress(e.data,t.internalCompression),r=new TextDecoder("utf-8");return JSON.parse(r.decode(n))}))}getMetadata(){return i(this,null,(function*(){try{return yield this.getMetadataAttempt()}catch(ht){if(ht instanceof ot)return this.cache.invalidate(this.source,ht.message),yield this.getMetadataAttempt();throw ht}}))}}}}]);