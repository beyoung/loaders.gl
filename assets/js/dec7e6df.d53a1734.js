"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[4318],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>b});var a=r(67294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function n(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,a,o=function(e,t){if(null==e)return{};var r,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):n(n({},t),e)),r},u=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var r=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=c(r),m=o,b=d["".concat(l,".").concat(m)]||d[m]||p[m]||i;return r?a.createElement(b,n(n({ref:t},u),{},{components:r})):a.createElement(b,n({ref:t},u))}));function b(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=r.length,n=new Array(i);n[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:o,n[1]=s;for(var c=2;c<i;c++)n[c]=r[c];return a.createElement.apply(null,n)}return a.createElement.apply(null,r)}m.displayName="MDXCreateElement"},78401:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>n,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var a=r(87462),o=(r(67294),r(3905));const i={},n="Attribute-driven colorization",s={unversionedId:"modules/i3s/recipes/attribute-driven-colorization",id:"modules/i3s/recipes/attribute-driven-colorization",title:"Attribute-driven colorization",description:"In I3S, a feature represents a real-world object within a node. For example, a building within a 3D object scene layer. Node resources such as geometry buffer and attributes can belong to a feature and can be accessed by an object-ID.",source:"@site/../docs/modules/i3s/recipes/attribute-driven-colorization.md",sourceDirName:"modules/i3s/recipes",slug:"/modules/i3s/recipes/attribute-driven-colorization",permalink:"/docs/modules/i3s/recipes/attribute-driven-colorization",draft:!1,editUrl:"https://github.com/visgl/loaders.gl/tree/master/website/../docs/modules/i3s/recipes/attribute-driven-colorization.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"I3S Building Scene Layer (BSL)",permalink:"/docs/modules/i3s/recipes/building-scene-layer"},next:{title:"File Formats",permalink:"/docs/formats/"}},l={},c=[{value:"Find out layer&#39;s attributes",id:"find-out-layers-attributes",level:2},{value:"Setup colorization scale",id:"setup-colorization-scale",level:2},{value:"Use I3SLoader with <code>colorsByAttribute</code> option",id:"use-i3sloader-with-colorsbyattribute-option",level:2},{value:"Colorization mode",id:"colorization-mode",level:2}],u={toc:c},d="wrapper";function p(e){let{components:t,...i}=e;return(0,o.kt)(d,(0,a.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"attribute-driven-colorization"},"Attribute-driven colorization"),(0,o.kt)("p",{class:"badges"},(0,o.kt)("img",{src:"https://img.shields.io/badge/From-v3.4-blue.svg?style=flat-square",alt:"From-v3.4"})),(0,o.kt)("p",null,"In I3S, a feature represents a real-world object within a node. For example, a building within a 3D object scene layer. Node resources such as geometry buffer and attributes can belong to a feature and can be accessed by an object-ID."),(0,o.kt)("p",null,"In terms of geometry, every vertex of a mesh is associated with some feature. At the same time, every feature is associated with feature attribute values. For example, there might be ",(0,o.kt)("inlineCode",{parentName:"p"},"HEIGHT")," attribute that stores roof height information about every building."),(0,o.kt)("p",null,"All that means that it is possible to make some visual effects related to attribute value. It might be text labels, colors, opacity etc."),(0,o.kt)("p",null,"From 3.4 version loaders.gl provides attributes colorization capability that allows colorization of node mesh by some attribute value."),(0,o.kt)("p",null,"The complete case of attributes colorization is done in ",(0,o.kt)("a",{parentName:"p",href:"https://i3s.loaders.gl/viewer?tileset=new-york"},"I3S Explorer"),". It is an open source ReactJS application. See source code on ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/visgl/loaders.gl-showcases"},"GitHub"),"."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"I3S New York dataset colorized by height roof",src:r(89634).Z,width:"1975",height:"740"})),(0,o.kt)("h2",{id:"find-out-layers-attributes"},"Find out layer's attributes"),(0,o.kt)("p",null,"It is necessary to pick some attribute to colorize a layer by. So it is necessary to load the layer JSON:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"import {load} from '@loaders.gl/core';\nimport {I3SLoader} from '@loaders.gl/i3s';\n\nconst i3sLayer = await load(url, I3SBuildingSceneLayerLoader);\n")),(0,o.kt)("p",null,"List and types of attributes might be taken from ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Esri/i3s-spec/blob/master/docs/1.9/field.cmn.md"},(0,o.kt)("inlineCode",{parentName:"a"},"i3sLayer.fields"))," and ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Esri/i3s-spec/blob/master/docs/1.8/attributeStorageInfo.cmn.md"},(0,o.kt)("inlineCode",{parentName:"a"},"i3sLayer.attributeStorageInfo"))," properties."),(0,o.kt)("h2",{id:"setup-colorization-scale"},"Setup colorization scale"),(0,o.kt)("p",null,"Attributes colorization capability applies linear color gradient. To create this gradient attribute values range is required."),(0,o.kt)("p",null,"To get minimum and maximum attribute values ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Esri/i3s-spec/blob/master/docs/1.9/statisticsInfo.cmn.md"},"statistics")," can be used. The ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Esri/i3s-spec/blob/master/docs/1.9/statsInfo.cmn.md"},"statistics info JSON")," has min and max values. Usage of those values allows setting true attribute values range not clamping extremum values."),(0,o.kt)("p",null,"As soon as statistics info is stored in separate resources, it has to be loaded in a separate request. Statistics is just a JSON data and can be loaded with JSONLoader:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"import {load} from '@loaders.gl/core';\nimport {JSONLoader} from '@loaders.gl/loader-utils';\n\nconst attributeStats = await load(`${url}/statistics/f_5/0`, JSONLoader);\n")),(0,o.kt)("h2",{id:"use-i3sloader-with-colorsbyattribute-option"},"Use I3SLoader with ",(0,o.kt)("inlineCode",{parentName:"h2"},"colorsByAttribute")," option"),(0,o.kt)("p",null,"To colorize a dataset I3SLoader has to be used with ",(0,o.kt)("inlineCode",{parentName:"p"},"colorsByAttribute")," option:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'  import { StaticMap } from "react-map-gl";\n  import DeckGL from "@deck.gl/react";\n  import { Tile3DLayer } from "@deck.gl/geo-layers";\n  import { I3SLoader } from "@loaders.gl/i3s";\n\n  function renderLayer() {\n    const loadOptions = {\n      i3s: {\n        colorsByAttribute: {\n          attributeName,\n          minValue: statistics.min,\n          maxValue: statistics.max,\n          minColor: [146, 146, 252, 255], // #9292FC\n          maxColor: [44, 44, 175, 255], // #2C2CAF\n        },\n      },\n    };\n    return new Tile3DLayer({\n      id: `tile3d-layer-${layer.id}`,\n      data: url,\n      loader: I3SLoader,\n      loadOptions,\n    });\n  }\n\n  <DeckGL\n    id={id}\n    layers={renderLayers()}\n    viewState={viewState}\n    onViewStateChange={onViewStateChangeHandler}\n  >\n    <StaticMap reuseMaps mapStyle={mapStyle} />\n  </DeckGL>\n')),(0,o.kt)("h2",{id:"colorization-mode"},"Colorization mode"),(0,o.kt)("p",null,"Attributes colorization capability can work in 2 modes: 'replace' and 'multiply'."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"replace")," mode. Attribute-based colors replace geometry vertex colors. This is the default mode."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"multiply")," mode. Attribute-based colors multiply with geometry vertex colors."),(0,o.kt)("p",null,"Usage example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function renderLayer() {\n  const loadOptions = {\n    i3s: {\n      colorsByAttribute: {\n        attributeName,\n        minValue: statistics.min,\n        maxValue: statistics.max,\n        minColor: [146, 146, 252, 255], // #9292FC\n        maxColor: [44, 44, 175, 255], // #2C2CAF\n        mode: 'multiply' // or 'replace'\n      }\n    }\n  };\n  return new Tile3DLayer({\n    id: `tile3d-layer-${layer.id}`,\n    data: url,\n    loader: I3SLoader,\n    loadOptions\n  });\n}\n")))}p.isMDXComponent=!0},89634:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/i3s-new-york-colorize-by-heightroof-fc2b0f1402a6dce50445432ea713df1c.png"}}]);